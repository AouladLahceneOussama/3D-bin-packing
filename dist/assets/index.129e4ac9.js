var ze=Object.defineProperty,Pe=Object.defineProperties;var be=Object.getOwnPropertyDescriptors;var he=Object.getOwnPropertySymbols;var $e=Object.prototype.hasOwnProperty,ke=Object.prototype.propertyIsEnumerable;var ee=(x,t,e)=>t in x?ze(x,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):x[t]=e,T=(x,t)=>{for(var e in t||(t={}))$e.call(t,e)&&ee(x,e,t[e]);if(he)for(var e of he(t))ke.call(t,e)&&ee(x,e,t[e]);return x},Q=(x,t)=>Pe(x,be(t));var O=(x,t,e)=>(ee(x,typeof t!="symbol"?t+"":t,e),e);import*as y from"https://threejsfundamentals.org/threejs/resources/threejs/r122/build/three.module.js";import{OrbitControls as Ie}from"https://threejsfundamentals.org/threejs/resources/threejs/r122/examples/jsm/controls/OrbitControls.js";import{GLTFLoader as De}from"https://threejsfundamentals.org/threejs/resources/threejs/r122/examples/jsm/loaders/GLTFLoader.js";import{TransformControls as Se}from"https://threejsfundamentals.org/threejs/resources/threejs/r122/examples/jsm/controls/TransformControls.js";const Ce=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))a(i);new MutationObserver(i=>{for(const l of i)if(l.type==="childList")for(const u of l.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&a(u)}).observe(document,{childList:!0,subtree:!0});function e(i){const l={};return i.integrity&&(l.integrity=i.integrity),i.referrerpolicy&&(l.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?l.credentials="include":i.crossorigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function a(i){if(i.ep)return;i.ep=!0;const l=e(i);fetch(i.href,l)}};Ce();const b=100,P=new y.Scene,F=document.getElementById("3D-container"),de=document.getElementById("exampleModalfat");let Me=0;const le=class{constructor(t,e){this.id=Me++,this.action=t,this.executionTime=e,le.allMessages.push(this.getMessageDetail)}get getMessageDetail(){return{id:this.id,action:this.action,executionTime:this.executionTime}}dateTime(){var t=new Date,e=t.getFullYear()+"-"+(t.getMonth()+1)+"-"+t.getDate(),a=t.getHours()+":"+t.getMinutes()+":"+t.getSeconds();return e+" - "+a}dispatchMessage(){let t="<div class='logTime'><p>"+this.dateTime()+"</p><p>Execution Time : "+this.executionTime.toFixed(2)+"s</p></div>",e=" <div class='logDetail'><h3>"+this.action+"</h3>"+t+"</div>";$(".logMsg").append(e),$(".logMsg").animate({scrollTop:$(".logMsg").prop("scrollHeight")},250)}};let B=le;O(B,"allMessages",[]);let Oe=0;const q=class{constructor(t=0,e=[]){this.id=Oe++,this.routeNumber=parseInt(t),console.log(e),this.routes=e,q.allRoutes=this.getRoute}get getRoute(){return{routeNumber:this.routeNumber,routes:this.routes}}get getRouteToLocalStorage(){return{routeNumber:this.routeNumber,routes:this.routes}}static getRouteNumber(t){return q.allRoutes.routes.filter(a=>(console.log(a.type,t),a.type==t)).length}static initialisePriorityFields(){$(".pack_priorities option").remove();for(let t=1;t<=q.getRouteNumber("dechargement");t++)$(".pack_priorities").append('<option value="'+t+'">'+t+"</option>")}static init(){localStorage.getItem("routes")!==null&&(JSON.parse(localStorage.getItem("routes")).forEach(e=>{new q(e.routeNumber,e.from,e.to,e.type)}),q.allRoutes.routes.forEach(e=>{var a=e.from+" - "+e.to+"("+e.type+")",i="p : "+e.id;$("#routesDetails").append('<div class="packInfo"><div>'+a+'</div><div class="packInfo-numbers">'+i+" </div></div>")}),q.initialisePriorityFields())}addOrUpdate(){localStorage.setItem("routes",JSON.stringify(this.getRouteToLocalStorage)),$("#routesDetails div").remove(),q.allRoutes.routes.forEach(e=>{var a=e.from+" - "+e.to+"("+e.type+")",i="p : "+e.id;$("#routesDetails").append('<div class="packInfo"><div>'+a+'</div><div class="packInfo-numbers">'+i+" </div></div>")}),q.initialisePriorityFields(),new B("Adding route",.01).dispatchMessage()}};let U=q;O(U,"allRoutes");let Le=0;const S=class{constructor(t,e,a,i,l,u,r,p,m=[]){this.id=Le++,this.label=t,this.w=parseInt(e*b),this.h=parseInt(a*b),this.l=parseInt(i*b),this.q=parseInt(l),this.v=this.w*this.h*this.l,this.stackingCapacity=parseInt(u),this.rotations=r,this.dimensions=this.setDimensions(r),this.priority=parseInt(p),this.color=Math.random(),this.multiplePrio=m.length>0,this.subQuantities=m,S.allInstances.push(this.getPack)}get getPack(){return{id:this.id,label:this.label,w:this.w,h:this.h,l:this.l,q:this.q,v:this.v,priority:this.priority,stackC:this.stackingCapacity,rotations:this.dimensions,rotateDirections:this.rotations,multiplePrio:this.multiplePrio,subQuantities:this.subQuantities,color:this.color}}get getPackToLocalStorage(){return{label:this.label,w:this.w/b,h:this.h/b,l:this.l/b,q:this.q,priority:this.priority,stackC:this.stackingCapacity,rotations:this.rotations,subQuantities:this.subQuantities}}setDimensions(t){let e=[];for(let i=0;i<t.length;i++){let l=t[i];l=="base"&&e.push({w:this.w,h:this.h,l:this.l,type:[l,0],surface:this.w*this.l},{w:this.l,h:this.h,l:this.w,type:[l,90],surface:this.w*this.l}),l=="right-side"&&e.push({w:this.w,h:this.l,l:this.h,type:[l,0],surface:this.w*this.h},{w:this.h,h:this.l,l:this.w,type:[l,90],surface:this.w*this.h}),l=="front-side"&&e.push({w:this.h,h:this.w,l:this.l,type:[l,0],surface:this.h*this.l},{w:this.l,h:this.w,l:this.h,type:[l,90],surface:this.h*this.l})}e.sort((i,l)=>l.surface-i.surface);for(let i=0;i<e.length;i+=2)if(e[i].l>e[i].w){var a=e[i+1];e[i+1]=e[i],e[i]=a}return e}static init(){localStorage.getItem("packages")!==null&&(JSON.parse(localStorage.getItem("packages")).forEach(e=>{new S(e.label,e.w,e.h,e.l,e.q,e.stackC,e.rotations,e.priority,e.subQuantities)}),S.allInstances.forEach(e=>{var a=e.w/b+" , "+e.h/b+" , "+e.l/b+" ( "+e.q+" ) ";$("#packageDetails").append('<div class="packInfo"><div>'+e.label+'</div><div class="packInfo-numbers">'+a+" </div></div>")}))}add(){var t=[];localStorage.getItem("packages")!==null&&(t=JSON.parse(localStorage.getItem("packages"))),t.push(this.getPackToLocalStorage),localStorage.setItem("packages",JSON.stringify(t)),S.loadPacks(),new B("Adding Pack",.01).dispatchMessage()}static updatePackLocalstorage(){localStorage.removeItem("packages");let t=[];S.allInstances.map(e=>{t.push({label:e.label,w:parseFloat(e.w/b),h:parseFloat(e.h/b),l:parseFloat(e.l/b),q:parseInt(e.q),priority:e.priority,stackC:parseInt(e.stackC),rotations:e.rotateDirections,multiplePrio:e.subQuantities.length>0,subQuantities:e.subQuantities})}),localStorage.setItem("packages",JSON.stringify(t))}static update(t,e){function a(m,d,o,c){let s=[];for(let g=0;g<m.length;g++){let h=m[g];h=="base"&&s.push({w:d,h:o,l:c,type:[h,0],surface:d*c},{w:c,h:o,l:d,type:[h,90],surface:d*c}),h=="right-side"&&s.push({w:d,h:c,l:o,type:[h,0],surface:d*o},{w:o,h:c,l:d,type:[h,90],surface:d*o}),h=="front-side"&&s.push({w:o,h:d,l:c,type:[h,0],surface:o*c},{w:c,h:d,l:o,type:[h,90],surface:o*c})}s.sort((g,h)=>h.surface-g.surface);for(let g=0;g<s.length;g+=2)if(s[g].l>s[g].w){var n=s[g+1];s[g+1]=s[g],s[g]=n}return s}let i=S.allInstances.findIndex(m=>m.id==parseInt(e)),l=S.allInstances[i],u={label:t.label,w:parseInt(t.w),h:parseInt(t.h),l:parseInt(t.l),q:parseInt(t.q),priority:parseInt(t.priority),v:t.w*t.h*t.l,stackC:parseInt(t.stack),rotateDirections:t.r,rotations:a(t.r,parseInt(t.w),parseInt(t.h),parseInt(t.l)),multiplePrio:t.subQuantities.length>0,subQuantities:t.subQuantities},r=T(T({},l),u);S.allInstances[i]=r,S.removePacksFromTheScene(),S.updatePackLocalstorage(),$("#packageDetails").empty(),S.allInstances.forEach(m=>{var d=m.w/b+" , "+m.h/b+" , "+m.l/b+" ( "+m.q+" ) ";$("#packageDetails").append('<div class="packInfo"><div>'+m.label+'</div><div class="packInfo-numbers">'+d+" </div></div>")}),new B("Updating Pack",.01).dispatchMessage()}static remove(t){let e=S.allInstances.findIndex(i=>i.id==parseInt(t));S.allInstances.splice(e,1),S.removePacksFromTheScene(),S.updatePackLocalstorage(),$("#packageDetails").empty(),S.allInstances.forEach(i=>{var l=i.w/b+" , "+i.h/b+" , "+i.l/b+" ( "+i.q+" ) ";$("#packageDetails").append('<div class="packInfo"><div>'+i.label+'</div><div class="packInfo-numbers">'+l+" </div></div>")}),new B("Remove Pack",.01).dispatchMessage()}static loadPacks(){function t(m){var d=m.w/b+" , "+m.h/b+" , "+m.l/b+" ( "+m.q+" ) ";$("#packageDetails").append('<div class="packInfo"><div>'+m.label+'</div><div class="packInfo-numbers">'+d+" </div></div>")}S.removeBoxesFromTheScene(),$("#packageDetails div").remove();let e=S.allInstances,a=new y.Group;a.name="pack_shower",e.sort((m,d)=>d.v-m.v);var i,l,u;let r=-300,p=400;for(let m=0;m<e.length;m++){let d=e[m];l=new y.BoxGeometry(d.w,d.h,d.l),u=new y.MeshLambertMaterial({color:d.color*16715775,side:y.DoubleSide}),i=new y.Mesh(l,u),i.castShadow=!0,i.receiveShadow=!0,i.userData.id=d.id,i.userData.hover=!0,i.userData.dragDrop=!0,i.userData.clickable=!0,i.userData.actif=!1,i.userData.name="Pack",m!=0?i.position.set(r,-110-.1,p):i.position.set(r,-65,p),r+=d.w+20,r>800&&(p+=400,r=-300),l.translate(d.w/2,d.h/2,d.l/2),a.add(i),t(d)}P.add(a)}static loadPacksFromLocalStorage(){S.init(),S.loadPacks()}static removePacksFromTheScene(){P.remove(P.getObjectByName("All_Packs"))}static removeBoxesFromTheScene(){P.remove(P.getObjectByName("pack_shower"))}static reloadShowPacker(){S.removeBoxesFromTheScene(),S.loadPacks()}};let C=S;O(C,"allInstances",[]);let Fe=0;const oe=class{constructor(t,e,a){this.id=Fe++,this.pack=t,this.loaded=e,this.stat=a,oe.allMessages.push(this.getMessageDetail)}get getMessageDetail(){return{id:this.id,pack:this.pack,loaded:this.loaded,stat:this.stat}}dispatchMessage(){$(".logger-content div").remove();let t=`
            <div class="logger-detail">
            <span class="pack-title">Label</span>
            <span>${this.pack.label}</span>
            </div>
            <div class="logger-detail">
            <span class="pack-title">Quantity</span>
            <span>${this.pack.q}</span>
            </div>
            <div class="logger-detail">
            <span class="pack-title">Loaded</span>
            <span>${this.loaded}</span>
            </div>
            <div class="logger-detail">
            <span class="pack-title">Stat</span>
            <span>${this.stat}</span>
            </div>
        `;$(".logger-content").append(t)}};let Z=oe;O(Z,"allMessages",[]);const K=class{constructor(t,e,a){this.width=parseInt(t*b),this.height=parseInt(e*b),this.lenght=parseInt(a*b),K.dragSurface=this.getDragSurface}get getDragSurface(){return{width:this.width,height:this.height,lenght:this.lenght}}static switch(t){t?new B("Manual mode is activated (start dragging...)",.01).dispatchMessage():new B("Manual mode is deactivated",.01).dispatchMessage(),K.draggerStat=t}};let A=K;O(A,"draggerStat",!1),O(A,"dragSurface",{});localStorage.setItem("steps",JSON.stringify([{stepNumber:0,loadedPacks:[],openPoint:[{x:0,y:0,z:0}]}]));function V(x,t){[{rotation:"base",angles:[0,Math.PI/2]},{rotation:"right-side",angles:[0,Math.PI/2]},{rotation:"front-side",angles:[0,Math.PI/2]}].forEach(a=>{$(`#d-${a.rotation} .fa-cube`).toggleClass(x,t),$(`#d-${a.rotation} .fa-arrow-rotate-left`).toggleClass(x,t),$(`#d-${a.rotation} .fa-arrow-rotate-right`).toggleClass(x,t)})}function pe(x){V("d-less-opacity",!0);let t=x.reduce((e,a)=>{let i=a.type[0],l=a.type[1]==0?"fa-arrow-rotate-left":"fa-arrow-rotate-right";return e[i]==null?e[i]=[l]:e[i].push(l),e},{});for(const e in t)$(`#d-${e} .fa-cube`).removeClass("d-less-opacity"),t[e].forEach(a=>{$(`#d-${e} .${a}`).removeClass("d-less-opacity")})}function xe(x,t){V("d-current-rotate ",!1);let e=t==0?"fa-arrow-rotate-left":"fa-arrow-rotate-right";$(`#d-${x} .fa-cube`).addClass("d-current-rotate"),$(`#d-${x} .${e}`).addClass("d-current-rotate")}function ye(){let x=[];P.traverse(t=>{t.userData.name==="Box_border"&&x.push(t)}),D.currentStep=0,D.loadedPack=[],D.openPoints=[{x:0,y:0,z:0}],x.forEach(t=>P.remove(t))}$("#delete-all").click(()=>ye());$("#dragDrop-backward").click(function(){let x=JSON.parse(localStorage.getItem("steps"));if(console.log("backward",D.currentStep),x.length>0&&D.currentStep>0){$("#dragDrop-backward").removeClass("disabled");let t=x.find(i=>i.stepNumber==D.currentStep),e=x.find(i=>i.stepNumber==D.currentStep-1);console.log(t,e),D.loadedPack=D.allLoadedPacks.slice(0,e.loadedPacks.length),D.openPoints=e.openPoint,console.log(D.allLoadedPacks,D.loadedPack,e.loadedPacks.length-1);let a=t.loadedPacks[t.loadedPacks.length-1];P.remove(P.getObjectByName("Box_Border_"+a.id)),D.currentStep=D.currentStep-1}if(D.currentStep==0){$("#dragDrop-backward").addClass("disabled");return}});setInterval(()=>{D.currentStep>0&&$("#dragDrop-backward").removeClass("disabled")},100);$("#openDragger").click(function(){$("#openDragger i").toggleClass("fa-circle-plus fa-circle-minus"),$("#dragDrop").toggleClass("dragDrop-container--close dragDrop-container--open")});$(".guidline-dragdrop-container").click(function(){$($(this)).toggleClass("toggleGuidlines")});$("#dragDrop-shortcuts").click(function(){$(".guidline-dragdrop-container").toggleClass("toggleGuidlines")});const re=class{constructor(t,e){this.object=t,this.parent_id=e,this.packDetails=C.allInstances.find(a=>a.id==e),this.q=this.packDetails.q,this.stat={dimensions:{w:this.packDetails.w,h:this.packDetails.h,l:this.packDetails.l},position:this.object.position},console.log(this.object.position),re.allDraggableItems.push(this.getItem)}get getItem(){return{object:this.object,parent_id:this.parent_id,packDetails:this.packDetails,q:this.q,stat:this.stat}}bestPosition(){return D.specificOpenPoints[0]}createDragItem(t){let e=this.checkQuantityItem(this.parent_id,this.q);if(console.log(e),new Z(this.packDetails,e==-1?this.q:e,e==-1?"All loaded":D.specificOpenPoints.length>0?"On loading":"No left space in the container").dispatchMessage(),e!=-1&&D.specificOpenPoints.length>0){let a=new y.Group;a.name="Box_Border_"+this.parent_id+"-"+e,a.userData.parent_id=this.parent_id,a.userData.id=this.parent_id+"-"+e,a.userData.name="Box_border",console.log(D.specificOpenPoints);let i=D.specificOpenPoints[0].rotations[0],l=new y.MeshLambertMaterial({color:this.packDetails.color*16715775,side:y.DoubleSide}),u=new y.BoxGeometry(i.w,i.h,i.l),r=new y.Mesh(u,l);r.userData.parent_id=this.parent_id,r.userData.id=this.parent_id+"-"+e;let p=new y.EdgesGeometry(u),m=new y.LineSegments(p,new y.LineBasicMaterial({color:16777215}));m.name="Line_"+this.parent_id,m.userData.id=this.parent_id,m.userData.name="Line";let d=this.bestPosition();return this.stat.position=d,a.position.set(d.x,d.y,d.z),u.translate(i.w/2,i.h/2,i.l/2),p.translate(i.w/2,i.h/2,i.l/2),a.add(r),a.add(m),P.add(a),t.attach(a),xe(i.type[0],i.type[1]),r}return!1}checkQuantityItem(t,e){console.log(D.loadedPack);let a=D.loadedPack.filter(i=>i.box.userData.parent_id==t);return D.loadedPack.length==0?0:e-a.length>0?a.length:-1}};let ie=re;O(ie,"allDraggableItems",[]);const f=class{constructor(){this.transformControl}start(t,e){if(this.transformControl=new Se(R,E.domElement),this.transformControl.setSpace("local"),this.transformControl.setRotationSnap(Math.PI/2),P.add(this.transformControl),this.transformControl.addEventListener("dragging-changed",function(a){j.enabled=!a.value}),console.log(f.item),Object.keys(f.item).length==0){let a=new ie(t,e);f.item=a.getItem,f.filterOpenPointByPackage();let i=a.createDragItem(this.transformControl);i!=!1?(f.currentPos=f.item.stat.position,this.dragging(i)):f.item={}}else console.log("Please confirm the position of the current dragged pack [press enter]")}static getNbLoadedPacksById(t,e){console.log(t,e);let a=f.loadedPack.filter(i=>i.box.userData.parent_id==t);return f.loadedPack.length==0?0:e-a.length>=0?a.length:-1}dragging(t){let e=this.transformControl;function a(){if(e!=null){let s=f.item.stat.dimensions,n=f.item.stat.position,g=new y.BoxGeometry(s.w,s.h,s.l),h=new y.EdgesGeometry(g);g.translate(s.w/2,s.h/2,s.l/2),h.translate(s.w/2,s.h/2,s.l/2),e.object.children[0].geometry=g,e.object.children[1].geometry=h,e.object.position.set(n.x,n.y,n.z)}}function i(s){let n=f.loadedPack.filter(h=>(s.y>0?h.y+h.h:h.y)==s.y),g=[];return n.forEach(h=>{g[h.id]==null&&(g[h.id]=[]),g[h.id].push({x:h.x,z:h.z},{x:h.x+h.w,z:h.z},{x:h.x,z:h.z+h.l},{x:h.x+h.w,z:h.z+h.l})}),[n,g]}function l(s,n,g){return g?n.x>s[0].x&&n.x<=s[3].x&&n.z>s[0].z&&n.z<=s[3].z:n.x>=s[0].x&&n.x<=s[3].x&&n.z>=s[0].z&&n.z<=s[3].z}function u(){let s=JSON.parse(localStorage.getItem("steps"));s!=null&&(s.push({stepNumber:++f.currentStep,loadedPacks:f.loadedPack,openPoint:f.openPoints}),localStorage.setItem("steps",JSON.stringify(s)))}function r(){function s(n,g){let h=[{pointOwner:g.id,x:n.x,y:n.y+g.h,z:n.z,type:"T",ignored:!1}],v=[{pointOwner:g.id,x:n.x,y:n.y,z:n.z+g.l,type:"R",ignored:!1},{pointOwner:g.id,x:n.x+g.w,y:n.y,z:n.z,type:"F",ignored:!1}];if(n.x==0&&n.y==0&&n.z==0)return[...h,...v];let z=i(n),w=z[0],M=z[1];if(w.length!=0&&Object.keys(M).length!=0)for(let L=0;L<v.length;L++){let k=v[L],H=0;for(let W=0;W<w.length;W++){let J=w[W],I=M[J.id],ue={x:k.x+1,z:k.z+1};if(k.y==0)l(I,ue,!1)||H++;else if(l(I,ue,!1)){let ve=f.loadedPack.filter(G=>G.x<=k.x+1&&G.x+G.w>k.x+1&&G.z<=k.z+1&&G.z+G.l>k.z+1&&G.y==n.y&&G.id!=k.pointOwner);k.type=="R"&&I[3].z-k.z,k.type=="F"&&I[3].x-k.x,ve.length==0&&(k.type=="R"&&h.push(v[0]),k.type=="F"&&h.push(v[1]))}}H==w.length&&(k.type=="R"&&h.push(v[0]),k.type=="F"&&h.push(v[1]))}return h}if(e!=null){let g=e.object.children[0].geometry.parameters;console.log(e.object),f.loadedPack.push({id:t.userData.id,parent_id:t.userData.parent_id,w:g.width,h:g.height,l:g.depth,x:f.currentPos.x,y:f.currentPos.y,z:f.currentPos.z,color:f.item.packDetails.color,box:t,fullBox:e.object}),f.allLoadedPacks.push({id:t.userData.id,parent_id:t.userData.parent_id,w:g.width,h:g.height,l:g.depth,x:f.currentPos.x,y:f.currentPos.y,z:f.currentPos.z,color:f.item.packDetails.color,box:t,fullBox:e.object});let h=f.getNbLoadedPacksById(f.item.parent_id,f.item.q);new Z(f.item.packDetails,h,f.item.q-h==0?"All loaded":"On loading").dispatchMessage(),f.openPoints.push(...s(f.currentPos,f.loadedPack[f.loadedPack.length-1]));let v=f.openPoints.findIndex(w=>w.x==f.currentPos.x&&w.y==f.currentPos.y&&w.z==f.currentPos.z);c(v),f.openPoints.sort((w,M)=>w.x-M.x||w.z-M.z||w.y-M.y);let z=new y.Group;z.name="sphere",f.openPoints.forEach(w=>{const M=new y.SphereGeometry(3,32,16),L=new y.MeshBasicMaterial({color:16776960}),k=new y.Mesh(M,L);k.position.set(w.x,w.y,w.z),z.add(k)}),u(),P.remove(P.getObjectByName("sphere")),P.add(z),e.detach(),e=null,p(t.userData.parent_id),V("d-less-opacity",!0),V("d-current-rotate",!1)}}function p(s){let n=f.loadedPack.filter(g=>g.box.userData.parent_id==s);if(f.item.q-n.length==0){console.log(n);let h=P.getObjectByName("pack_shower").children.find(v=>v.userData.id==n[0].box.userData.parent_id);h.material.transparent=!0,h.material.opacity=.6}f.item={}}function m(){let s=f.currentPos,n=f.specificOpenPoints.find(h=>h.x==s.x&&h.y==s.y&&h.z==s.z);console.log(n);let g=n.rotations.findIndex(h=>h.type[0]==f.currentRotation.face&&h.type[1]==f.currentRotation.yAxis);if(g!=-1){let h=n.rotations[++g%n.rotations.length],v=new y.BoxGeometry(h.w,h.h,h.l),z=new y.EdgesGeometry(v);v.translate(h.w/2,h.h/2,h.l/2),z.translate(h.w/2,h.h/2,h.l/2),e!=null&&(e.object.children[0].geometry=v,e.object.children[1].geometry=z,f.currentRotation={face:n.rotations[g%n.rotations.length].type[0],yAxis:n.rotations[g%n.rotations.length].type[1]},xe(f.currentRotation.face,f.currentRotation.yAxis))}}function d(s){let n=f.specificOpenPoints.find(z=>z.x==s.x&&z.y==s.y&&z.z==s.z),g=n.rotations[0],h=new y.BoxGeometry(g.w,g.h,g.l),v=new y.EdgesGeometry(h);return h.translate(g.w/2,g.h/2,g.l/2),v.translate(g.w/2,g.h/2,g.l/2),e!=null&&(e.object.children[0].geometry=h,e.object.children[1].geometry=v,f.currentRotation={face:n.rotations[0].type[0],yAxis:n.rotations[0].type[1]}),n.rotations}function o(s){const n=(h,v)=>Math.sqrt((v.x-h.x)**2+(v.y-h.y)**2+(v.z-h.z)**2),g=(h,v,z=1e-5)=>{const w=v.map(L=>n(h,L)),M=Math.min(...w);return v.find((L,k)=>w[k]-M<z)};return f.openPoints.length==1?g(s,f.openPoints):g(s,f.specificOpenPoints)}function c(s){function n(h){return h.filter((v,z,w)=>w.findIndex(M=>M.x===v.x&&M.y===v.y&&M.z===v.z)===z)}function g(){let h=f.loadedPack[f.loadedPack.length-1];for(let z=f.openPoints.length-1;z>=0;z--){let w=f.openPoints[z];(A.width==w.x||A.height==w.y||A.lenght==w.z)&&f.openPoints.splice(z,1)}let v=[];f.openPoints.map((z,w)=>{z.x+1>=h.x&&z.x+1<=h.x+h.w&&z.z+1>=h.z&&z.z+1<=h.z+h.l&&z.y==h.y&&z.pointOwner!=h.id&&v.push(w)}),v.sort((z,w)=>w-z);for(let z=0;z<v.length;z++)console.log(f.openPoints[v[z]]),f.openPoints.splice(v[z],1);for(let z=0;z<f.openPoints.length;z++){let w=f.openPoints[z],M=w.pointOwner.split("-")[0];for(let L=z+1;L<f.openPoints.length;L++){let k=f.openPoints[L],H=k.pointOwner.split("-")[0];if(w.x==k.x&&w.y==k.y&&w.type!="S"&&M==H){let W=f.loadedPack.filter(I=>w.y==0?I.y==w.y&&I.x>w.x&&I.z<=w.z&&I.z+I.l>=w.z:I.y+I.h==w.y&&I.x<=w.x+1&&I.x+I.w>=w.x+1&&I.z<=w.z+1&&I.z+I.l>=w.z+1),J=f.loadedPack.filter(I=>k.y==0?I.y==k.y&&I.x>k.x&&I.z<=k.z&&I.z+I.l>=k.z:I.y+I.h==k.y&&I.x<=k.x+1&&I.x+I.w>=k.x+1&&I.z<=k.z+1&&I.z+I.l>=k.z+1);W.length!=0&&J.length!=0&&Math.abs(W[0].x-w.x)==Math.abs(J[0].x-k.x)&&f.openPoints.splice(L,1),W.length==0&&J.length==0&&f.openPoints.splice(L,1)}w.x==k.x&&w.z==k.z&&M==H&&f.openPoints.splice(L,1),w.y==k.y&&w.z==k.z&&!w.ignored&&M==H&&k.type!="S"&&f.openPoints.splice(L,1)}}}s!=-1&&f.openPoints.splice(s,1),f.openPoints=n(f.openPoints),f.openPoints.sort((h,v)=>h.x-v.x||h.z-v.z||h.y-v.y),g()}e.addEventListener("mouseUp",function(s){let n=e.object,g=s.target.children[1].position,h=o(g);console.log(h),n.position.set(h.x,h.y,h.z);let v=d(h);f.currentPos=h,f.mouseOnAction=!1,pe(v)}),e.addEventListener("mouseDown",function(s){f.mouseOnAction=!0}),document.addEventListener("keydown",function(s){switch(s.key.toUpperCase()){case"DELETE":!f.mouseOnAction&&e!=null&&(f.item={},P.remove(e.object),e.detach(),e=null,V("d-less-opacity",!0),V("d-current-rotate",!1));break;case"SHIFT":e.setTranslationSnap(100),e.setRotationSnap(Math.PI/2),e.setScaleSnap(.25);break;case"W":e.setMode("translate");break;case"+":case"=":e.setSize(e.size+.1);break;case"-":case"_":e.setSize(Math.max(e.size-.1,.1));break;case"X":e.showX=!e.showX;break;case"Y":e.showY=!e.showY;break;case"Z":e.showZ=!e.showZ;break;case" ":e.enabled=!e.enabled;break;case"ESCAPE":f.mouseOnAction||a();break;case"ENTER":f.mouseOnAction||r();break;case"R":f.mouseOnAction||m();break;default:console.log("this key don't support any action")}})}static confirmDragDropSolution(){}static filterOpenPointByPackage(){function t(d){let o=f.loadedPack.filter(s=>(d.y>0?s.y+s.h:s.y)==d.y),c=[];return o.forEach(s=>{c[s.id]==null&&(c[s.id]=[]),c[s.id].push({x:s.x,z:s.z},{x:s.x+s.w,z:s.z},{x:s.x,z:s.z+s.l},{x:s.x+s.w,z:s.z+s.l})}),[o,c]}function e(d,o,c){return c?o.x>d[0].x&&o.x<=d[3].x&&o.z>d[0].z&&o.z<=d[3].z:o.x>=d[0].x&&o.x<=d[3].x&&o.z>=d[0].z&&o.z<=d[3].z}function a(d){d.geometry.computeBoundingBox(),d.updateMatrixWorld();let o=d.geometry.boundingBox.clone();o.applyMatrix4(d.matrixWorld),o.max.x=o.max.x-1,o.max.y=o.max.y-1,o.max.z=o.max.z-1,o.min.x=o.min.x+1,o.min.y=o.min.y+1,o.min.z=o.min.z+1,console.log(f.loadedPack);for(let c=0;c<f.loadedPack.length;c++){let s=f.loadedPack[c].box;s.geometry.computeBoundingBox(),s.updateMatrixWorld();let n=s.geometry.boundingBox.clone();if(n.applyMatrix4(s.matrixWorld),n.max.x=n.max.x-1,n.max.y=n.max.y-1,n.max.z=n.max.z-1,n.min.x=n.min.x+1,n.min.y=n.min.y+1,n.min.z=n.min.z+1,o.intersectsBox(n))return o.intersectsBox(n)}return!1}function i(d,o){let c=new y.MeshLambertMaterial({color:16715775,side:y.DoubleSide}),s=new y.BoxGeometry(d.w,d.h,d.l),n=new y.Mesh(s,c),g=new y.Vector3(o.x,o.y,o.z);return n.position.copy(g),s.translate(d.w/2,d.h/2,d.l/2),n}function l(d,o){let c=[{x:o.x,z:o.z},{x:(3*o.x+(o.x+d.w))/4,z:o.z},{x:(o.x+(o.x+d.w))/2,z:o.z},{x:(o.x+3*(o.x+d.w))/4,z:o.z},{x:o.x+d.w,z:o.z},{x:o.x,z:(o.z+3*(o.z+d.l))/4},{x:o.x,z:(o.z+(o.z+d.l))/2},{x:o.x,z:(3*o.z+(o.z+d.l))/4},{x:o.x,z:o.z+d.l},{x:(o.x+3*(o.x+d.w))/4,z:o.z+d.l},{x:(o.x+(o.x+d.w))/2,z:o.z+d.l},{x:(3*o.x+(o.x+d.w))/4,z:o.z+d.l},{x:o.x+d.w,z:o.z+d.l},{x:o.x+d.w,z:(o.z+3*(o.z+d.l))/4},{x:o.x+d.w,z:(o.z+(o.z+d.l))/2},{x:o.x+d.w,z:(3*o.z+(o.z+d.l))/4}],s=t(o),n=s[0],g=s[1],h=0;for(let v=0;v<c.length;v++)for(let z=0;z<n.length;z++){let w=n[z],M=c[v],L=g[w.id];if(e(L,M,!1)){h++;break}}return h==16}f.specificOpenPoints=[];let u=[],r=A.dragSurface,p;if(f.openPoints.length==1){let d=f.item.packDetails.rotations;p=[];for(let o=0;o<d.length;o++){let c=d[o];c.w<=r.width&&c.h<=r.height&&c.l<=r.lenght&&!a(f.item.object)&&p.push(Q(T({},c),{type:[c.type[0],c.type[1]*(Math.PI/180)]}))}p.length>0&&u.push({id:"c-0",type:"O",x:0,y:0,z:0,rotations:p})}console.log(f.openPoints);for(let d=0;d<f.openPoints.length;d++){let o=f.openPoints[d],c=f.item.packDetails.rotations;p=[];for(let s=0;s<c.length;s++){let n=c[s],g=i(n,o);a(g)||o.y>0&&!l(n,o)||n.w+o.x<=r.width&&n.h+o.y<=r.height&&n.l+o.z<=r.lenght&&p.push(Q(T({},n),{type:[n.type[0],n.type[1]*(Math.PI/180)]}))}p.length>0&&u.push({id:o.pointOwner,type:o.type,x:o.x,y:o.y,z:o.z,rotations:p})}f.specificOpenPoints=u,console.log(f.specificOpenPoints),pe(p);let m=new y.Group;m.name="specificOpenPoints",f.specificOpenPoints.forEach(d=>{const o=new y.SphereGeometry(3,32,16),c=new y.MeshBasicMaterial({color:16777215}),s=new y.Mesh(o,c);s.position.set(d.x,d.y,d.z),m.add(s)}),P.remove(P.getObjectByName("specificOpenPoints")),P.add(m)}};let N=f;O(N,"steps",[{stepNumber:0,loadedPacks:[],openPoint:[{x:0,y:0,z:0}]}]),O(N,"currentStep",0),O(N,"allLoadedPacks",[]),O(N,"loadedPack",[]),O(N,"openPoints",[{x:0,y:0,z:0}]),O(N,"specificOpenPoints",[]),O(N,"currentPos",null),O(N,"currentRotation",{face:"base",yAxis:0}),O(N,"item",{}),O(N,"mouseOnAction",!1);var D=N;const fe=new y.Raycaster,te=new y.Vector2;function se(x){te.x=(x.clientX-F.offsetLeft)/F.offsetWidth*2-1,te.y=-((x.clientY-F.offsetTop)/F.offsetHeight)*2+1,fe.setFromCamera(te,R);var t;return P.getObjectByName("pack_shower")&&(t=fe.intersectObjects(P.getObjectByName("pack_shower").children),t.length>0&&t[0].object.userData.clickable)?t:!1}function Be(x){A.draggerStat?Ne(x):Te(x)}function Te(x){console.log("clicked");let t=se(x);if(t!=!1){let a=t[0].object.userData.id;je(a),qe(a)}}function Ne(x){console.log("mousePressed");let t=se(x);if(t!=!1){let e=t[0].object,a=e.userData.id;e.userData.dragDrop&&new D().start(e,a)}}function Re(x){let t=se(x);t!=!1?t[0].object.userData.hover&&(document.body.style.cursor="pointer"):document.body.style.cursor=""}function je(x){var t;console.log("changing"),P.traverse(e=>{(e.userData.name==="Pack"||e.userData.name=="Line")&&e.userData.id==x&&(t=e.userData.actif)}),P.traverse(e=>{(e.userData.name==="Pack"||e.userData.name=="Line")&&(t?(e.material.transparent=!1,e.material.opacity=1,e.userData.actif=!1,e.castShadow=!0):(e.userData.id==x&&(e.userData.actif=!0,e.material.transparent=!1,e.material.opacity=1,e.castShadow=!0),e.userData.id!=x&&(e.userData.actif=!1,e.material.transparent=!0,e.material.opacity=.2,e.castShadow=!1)))})}function qe(x){["base","right-side","front-side"].forEach(e=>{$(`#pack_Detail_${e}`).prop("checked",!1)});var t=C.allInstances.find(e=>e.id==x);$("#pack_Detail_Id").val(t.id),$("#pack_Detail_Label").val(t.label),$("#pack_Detail_Width").val(t.w/b),$("#pack_Detail_Height").val(t.h/b),$("#pack_Detail_Lenght").val(t.l/b),$("#pack_Detail_Quantity").val(t.q),$("#pack_Detail_StackingCapacity").val(t.stackC),$("#pack_Detail_Priority").val(t.priority).change(),t.rotateDirections.forEach(e=>{$(`#pack_Detail_${e}`).prop("checked",!0)}),$("#multiple-prio div").remove();for(let e=0;e<t.subQuantities.length;e++){let a=t.subQuantities[e];$("#multiple-prio").append('<div class="sub-content" id="advOptionsPrio'+e+'"><div class="sub-content-inputs"><div><p class="inputLabel">Quantity</p><input type="number" min="1" value="'+a.n+'"class="sub-q input"></div><div><p class="inputLabel">Priority</p><input type="number" min="1" value="'+a.p+'" class="sub-prio input"></div></div><div><i class="fa-solid fa-trash removePrioInput" data="'+e+'"></i></div></div>')}t.loaded!=null&&t.unloaded!=null&&$("#packStatut").html(" ("+t.loaded+" / "+(t.loaded+t.unloaded)+") ")}var R,E,j,ne,ae;const Ae=new De;Ee();we();We();function Ee(){const t=F.clientWidth/F.clientHeight,e=1,a=1e4;R=new y.PerspectiveCamera(60,t,e,a),R.position.set(1e3,400,800),P.background=new y.Color(16777215),P.fog=new y.FogExp2(9024235,2e-6),Qe(),He(),Ve();let i=new y.DirectionalLight(16777215,.8);i.position.set(120,1e3,-150),i.castShadow=!0,i.shadow.bias=-.001,i.shadow.mapSize.width=4096,i.shadow.mapSize.height=4096,i.shadow.camera.near=.5,i.shadow.camera.far=3e3,i.shadow.camera.left=3e3,i.shadow.camera.right=-3e3,i.shadow.camera.top=1e3,i.shadow.camera.bottom=-1e3,P.add(i),E=new y.WebGLRenderer({antialias:!0}),E.setPixelRatio(window.devicePixelRatio),E.setSize(F.clientWidth,F.clientHeight),E.shadowMap.enabled=!0,F.appendChild(E.domElement),j=new Ie(R,E.domElement),j.enableDamping=!0,j.minDistance=100,j.maxDistance=3e3,j.enablePan=!1,j.maxPolarAngle=Math.PI/2,j.minPolarAngle=-Math.PI/2,j.update(),window.addEventListener("resize",ge),F.addEventListener("mousemove",Re),F.addEventListener("pointerdown",Be),de!=null&&de.addEventListener("mouseenter",ge)}function ge(){R.aspect=F.clientWidth/F.clientHeight,R.updateProjectionMatrix(),E.setSize(F.clientWidth,F.clientHeight)}function we(){requestAnimationFrame(we),j.update(),Ge()}function Ge(){E.render(P,R)}function X(x){return new Promise((t,e)=>{Ae.load(x,a=>t(a),null,e)})}async function We(){const x=new Date().getTime(),t=await X("models/lift_truck/scene.gltf"),e=await X("models/pallet_truck/scene.gltf"),a=await X("models/truck/truck-wheels.gltf"),i=await X("models/truck/truck-support.gltf");Y(t.scene,{x:300,y:300,z:300},{x:-250,y:-90,z:450},-Math.PI,!0),Y(e.scene,{x:1/2,y:1/2,z:1/2},{x:-450,y:-25,z:700},-Math.PI,!0),Y(a.scene,{x:3/2,y:2,z:3/2},{},Math.PI/2,!1),Y(i.scene,{x:2,y:2.4,z:2},{},Math.PI/2,!1),ne=a.scene,ae=i.scene;const l=new Date().getTime();new B("Chargement des models, styles, ...",(l-x)*Math.pow(10,-3)).dispatchMessage(),$(".threeD-container-loader").toggleClass("threeD-container-loader--show threeD-container-loader--hide")}function Y(x,t,e,a,i){let l=x.getObjectByName("holders");(l!=null||l!=null)&&l.translateZ(10),x.scale.set(t.x,t.y,t.z),x.rotation.y=a,x.traverse(function(u){u.isMesh&&(u.castShadow=!0,u.receiveShadow=!0)}),i&&(x.position.set(e.x,e.y,e.z),P.add(x))}function Qe(){const x=new y.TextureLoader,t=x.load("textures/ground/Concrete_019_BaseColor.jpg"),e=x.load("textures/ground/Concrete_019_Normal.jpg"),a=x.load("textures/ground/Concrete_019_Height.png"),i=x.load("textures/ground/Concrete_019_Roughness.jpg"),l=x.load("textures/ground/Concrete_019_AmbientOcclusion.jpg"),u=1800,r=1800,p=6,m=6,d=new y.PlaneGeometry(u,r,10,10),o=new y.MeshStandardMaterial({map:t,normalMap:e,displacementMap:a,displacementScale:.3,roughnessMap:i,roughness:1,aoMap:l});for(let c=0;c<p;c++)for(let s=0;s<m;s++){const n=new y.Mesh(d,o);n.castShadow=!1,n.receiveShadow=!0,n.rotation.x=-Math.PI/2,n.position.y=-110,n.position.x=c*u-p/2*u,n.position.z=s*r-m/2*r,P.add(n)}}function He(){const x=`
  varying vec3 vWorldPosition;
  void main() {
    vec4 worldPosition = modelMatrix * vec4( position, 1.0 );
    vWorldPosition = worldPosition.xyz;
    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
  }`,t=`
  uniform vec3 topColor;
  uniform vec3 bottomColor;
  uniform float offset;
  uniform float exponent;
  varying vec3 vWorldPosition;
  void main() {
    float h = normalize( vWorldPosition + offset ).y;
    gl_FragColor = vec4( mix( bottomColor, topColor, max( pow( max( h , 0.0), exponent ), 0.0 ) ), 1.0 );
  }`,e=new y.HemisphereLight(16777215,268435455,.6);e.color.setHSL(.6,1,.6),e.groundColor.setHSL(.095,1,.75),P.add(e);const a={topColor:{value:new y.Color(30719)},bottomColor:{value:new y.Color(16777215)},offset:{value:33},exponent:{value:.6}};a.topColor.value.copy(e.color),P.fog.color.copy(a.bottomColor.value);const i=new y.SphereBufferGeometry(4e3,32,15),l=new y.ShaderMaterial({uniforms:a,vertexShader:x,fragmentShader:t,side:y.BackSide}),u=new y.Mesh(i,l);P.add(u)}function Ve(){$(".cube__face").click(function(){let x=$(this).attr("role");x=="front"&&gsap.to(R.position,{duration:1,x:2e3,y:100,z:0,ease:"power3.inOut"}),x=="left"&&gsap.to(R.position,{duration:1,x:0,y:200,z:2e3,ease:"power3.inOut"}),x=="top"&&gsap.to(R.position,{duration:1,x:2e3,y:1e3,z:1200,ease:"power3.inOut"})})}function me(x){x=="loadedPacks"&&P.remove(P.getObjectByName("All_Packs")),x=="all"&&(P.remove(P.getObjectByName("All_Packs")),P.remove(P.getObjectByName("Full_Container"))),$("#result").empty(),$("#result").append(`
  <div class="empty-result">
    Not solved yet
  </div>`)}$(document).ready(function(){$(".menuIcon").click(function(){$(".menu").toggleClass("openMenu closeMenu"),$(".menuIcon").toggleClass("openMenuIcon closeMenu")}),$("#closeMenuIcon").click(function(){$(".menu").toggleClass("openMenu closeMenu"),$(".menuIcon").toggleClass("openMenuIcon closeMenu")}),$("#reset").click(function(){localStorage.removeItem("container"),localStorage.removeItem("packages"),localStorage.removeItem("routes"),location.reload()}),$("#openCSV").click(function(){$("#openCSV").toggleClass("fa-circle-plus fa-circle-minus"),$("#csv").toggleClass("formContainerContentOpen formContainerContentClose")}),$("#openApi").click(function(){$("#openApi").toggleClass("fa-circle-plus fa-circle-minus"),$("#api").toggleClass("formContainerContentOpen formContainerContentClose")}),$("#openRoutes").click(function(){$("#openRoutes").toggleClass("fa-circle-plus fa-circle-minus"),$("#routes").toggleClass("formContainerContentOpen formContainerContentClose")}),$("#openPackages").click(function(){$("#openPackages").toggleClass("fa-circle-plus fa-circle-minus"),$("#packages").toggleClass("formContainerContentOpen formContainerContentClose")}),$("#openVehicule").click(function(){$("#openVehicule").toggleClass("fa-circle-plus fa-circle-minus"),$("#vehicule").toggleClass("formContainerContentOpen formContainerContentClose")}),$("#openResult").click(function(){$("#openResult").toggleClass("fa-circle-plus fa-circle-minus"),$("#result").toggleClass("formContainerContentOpen formContainerContentClose")}),$("#openPackDetail").click(function(){$("#openPackDetail").toggleClass("fa-circle-plus fa-circle-minus"),$("#packDetail").toggleClass("pack-detail-close pack-detail-open")});var x=JSON.parse(localStorage.getItem("container"));if(x!==null){var t=x.w+" , "+x.h+" , "+x.l;$("#containerDetails").append("<span>"+t+"</span>")}$("#toggleAdvParam").click(function(){$(".sub-container").toggleClass("sub-container--close sub-container--open"),$("#toggleAdvParam").toggleClass("toggleAdvParam--close toggleAdvParam--open")});let e=0;$("#addPrioInputs").click(function(){let l=$("#pack_Detail_Quantity").val();if(l!=""&&l>1){let r=a(".sub-q").reduce((m,d)=>m=m+d,0),p=l-r;p>0?($("#pack_Detail_Priority").addClass("disabled"),i(".sub-q"),$("#multiple-prio").append(`
                        <div class="sub-content" id="advOptionsPrio${e}">
                            <div class="sub-content-inputs">
                                <div>
                                    <p class="inputLabel">Quantity</p>
                                    <input type="number" min="1" max="${p}" value="${p}" class="sub-q input">
                                </div>
                                <div>
                                    <p class="inputLabel">Priority</p>
                                    <select class="pack_priorities sub-prio input" required></select>
                                </div>
                            </div>
                            <div>
                                <i class="fa-solid fa-trash removePrioInput" data="${e++}"></i>
                            </div>
                        </div>`),$(".sub-container").animate({scrollTop:$(".sub-container").prop("scrollHeight")},500),U.initialisePriorityFields()):alert("the somme is bigger than initial quantity")}else alert("the initial quantity is empty or less than 1 Or the somme is bigger than initial quantity")}),$(document).on("click",".removePrioInput",function(){$("#advOptionsPrio"+$(this).attr("data")).remove(),$(".sub-content").length==0&&$("#pack_Detail_Priority").removeClass("disabled")});function a(l){let u=$(l),r=[];for(let p=0;p<u.length;p++){let m=u[p];r.push(parseInt(m.value))}return r}function i(l){let u=$(l);u.length>=1&&(console.log(u[u.length-1],u[u.length-1].disabled),u[u.length-1].disabled="disabled")}});const ce=class{constructor(t,e,a,i){this.w=parseInt(t*b),this.h=parseInt(e*b),this.l=parseInt(a*b),this.capacity=parseInt(i),this.loadContainer(),ce.instances=this.getContainer}get getContainer(){return{w:this.w,h:this.h,l:this.l,capacity:this.capacity}}get getContainerLocalStorage(){return{w:this.w/b,h:this.h/b,l:this.l/b,capacity:this.capacity}}loadContainer(){var t=new y.MeshLambertMaterial({color:9737364,side:y.DoubleSide}),e=new y.MeshLambertMaterial({color:9737364,side:y.DoubleSide,transparent:!0,opacity:.5}),a,i=new y.Group;i.name="Full_Container";const l=new y.BoxGeometry(this.w+5,5,this.l+5),u=new y.BoxGeometry(this.w+5,this.h,5),r=new y.BoxGeometry(5,this.h,this.l);l.translate(this.w/2-5/2,-5/2-.1,this.l/2-5/2),u.translate(this.w/2-5/2,this.h/2,-5/2-.1),r.translate(-5/2-.1,this.h/2,this.l/2),a=new y.Mesh(l,t),i.add(a),a.castShadow=!0,a.receiveShadow=!0,a=new y.Mesh(u,e),i.add(a),a=new y.Mesh(r,e),i.add(a),this.loadTruck(this.w,this.l,i);var p=this.w/b+" , "+this.h/b+" , "+this.l/b;$("#containerDetails").html("<span>"+p+"</span>"),$("#containerWidth").val(this.w/b),$("#containerHeight").val(this.h/b),$("#containerLenght").val(this.l/b),$("#containerUnloading").val(this.unloading),localStorage.setItem("container",JSON.stringify(this.getContainerLocalStorage)),new B("Loading container",.01).dispatchMessage()}loadTruck(t,e,a){ne.position.set(t-440,-110,e/2),ae.position.set(400,-110,e/2),a.add(ne),a.add(ae),P.add(a)}};let _=ce;O(_,"instances");class _e{constructor(t){O(this,"isPointContainedInSpace",(t,e,a)=>a?e.x>t[0].x&&e.x<=t[3].x&&e.z>t[0].z&&e.z<=t[3].z:e.x>=t[0].x&&e.x<=t[3].x&&e.z>=t[0].z&&e.z<=t[3].z);this.algorithm=t,this.packagesLoaded=[],this.openPoints=[{x:0,y:0,z:0}],this.boxes={}}initialisePackagesToLoad(){var t,e=[],a=[];C.allInstances.map(l=>{if(l.multiplePrio){let r=0;for(let p=0;p<l.subQuantities.length;p++){let m=l.subQuantities[p];console.log(m);for(let d=0;d<m.n;d++)t=Q(T({},l),{priority:m.p,w:l.rotations[0].w,h:l.rotations[0].h,l:l.rotations[0].l,id:l.id+"-"+r++,parent_id:l.id}),delete t.q,e.push(t)}}else for(var u=0;u<l.q;u++)t=Q(T({},l),{w:l.rotations[0].w,h:l.rotations[0].h,l:l.rotations[0].l,id:l.id+"-"+u,parent_id:l.id}),delete t.q,e.push(t)});let i=e.reduce((l,u)=>{const r=u.priority;return l[r]==null&&(l[r]=[]),l[r].push(u),l},{});return Object.entries(i).forEach(([l,u])=>{a.push(parseInt(l)),u.sort((r,p)=>p.v-r.v)}),a.sort((l,u)=>u-l),[i,a]}getDownPack(t,e,a){return t==-1||t.parent_id!=a?e:(t=this.getPackByTopCoords({x:t.x,y:t.y,z:t.z}),e++,this.getDownPack(t,e,a))}getPackByTopCoords(t){for(let e=this.packagesLoaded.length-1;e>0;e--){let a=this.packagesLoaded[e];if(a.openPoint.T.x==t.x&&a.openPoint.T.y==t.y&&a.openPoint.T.z==t.z)return a}return-1}canBeStacked(t,e){let a=this.getPackByOpenPoint(e);return a.parent_id==t.parent_id?this.getDownPack(a,0,t.parent_id)<=t.stackC:!0}create2dSpace(t,e,a="down"){let i=[];if(a=="top")for(let u=0;u<this.packagesLoaded.length;u++){let r=this.packagesLoaded[u],p=r.y;p==t.y&&r.x<t.x&&r.x+r.w>t.x&&r.z<t.z&&r.z+r.l>t.z&&i.push(r),p==t.y&&r.x<t.x+e.w&&r.x+r.w>t.x+e.w&&r.z<t.z&&r.z+r.l>t.z&&i.push(r),p==t.y&&r.x<t.x&&r.x+r.w>t.x&&r.z<t.z+e.l&&r.z+r.l>t.z+e.l&&i.push(r),p==t.y&&r.x<t.x+e.w&&r.x+r.w>t.x+e.w&&r.z<t.z+e.l&&r.z+r.l>t.z+e.l&&i.push(r)}else for(let u=0;u<this.packagesLoaded.length;u++){let r=this.packagesLoaded[u],p=t.y>0?r.y+r.h:r.y;p==t.y&&r.x<=t.x&&r.x+r.w>t.x&&r.z<=t.z&&r.z+r.l>t.z&&i.push(r),p==t.y&&r.x<=t.x+e.w&&r.x+r.w>t.x+e.w&&r.z<=t.z&&r.z+r.l>t.z&&i.push(r),p==t.y&&r.x<=t.x&&r.x+r.w>t.x&&r.z<=t.z+e.l&&r.z+r.l>t.z+e.l&&i.push(r),p==t.y&&r.x<=t.x+e.w&&r.x+r.w>t.x+e.w&&r.z<=t.z+e.l&&r.z+r.l>t.z+e.l&&i.push(r)}let l=[];for(let u=0;u<i.length;u++){let r=i[u];l[r.id]==null&&(l[r.id]=[]),l[r.id].push({x:r.x,z:r.z},{x:r.x+r.w,z:r.z},{x:r.x,z:r.z+r.l},{x:r.x+r.w,z:r.z+r.l})}return[i,l]}canFitAboveTheBoxNewVersion(t,e){let a=[{x:e.x,z:e.z},{x:(3*e.x+(e.x+t.w))/4,z:e.z},{x:(e.x+(e.x+t.w))/2,z:e.z},{x:(e.x+3*(e.x+t.w))/4,z:e.z},{x:e.x+t.w,z:e.z},{x:e.x,z:(e.z+3*(e.z+t.l))/4},{x:e.x,z:(e.z+(e.z+t.l))/2},{x:e.x,z:(3*e.z+(e.z+t.l))/4},{x:e.x,z:e.z+t.l},{x:(e.x+3*(e.x+t.w))/4,z:e.z+t.l},{x:(e.x+(e.x+t.w))/2,z:e.z+t.l},{x:(3*e.x+(e.x+t.w))/4,z:e.z+t.l},{x:e.x+t.w,z:e.z+t.l},{x:e.x+t.w,z:(e.z+3*(e.z+t.l))/4},{x:e.x+t.w,z:(e.z+(e.z+t.l))/2},{x:e.x+t.w,z:(3*e.z+(e.z+t.l))/4}],i=this.create2dSpace(e,t),l=i[0],u=i[1],r=0;for(let p=0;p<a.length;p++)for(let m=0;m<l.length;m++){let d=l[m],o=a[p],c=u[d.id];if(this.isPointContainedInSpace(c,o,!1)){r++;break}}return r==16}okRotation(t,e){for(let a=0;a<this.openPoints.length;a++){let i=this.openPoints[a],l=T({},e);if(!(i.y>0&&i.type=="T"&&e.stackC!=-1&&!this.canBeStacked(e,i))){for(let u=0;u<e.rotations.length;u++){let r=e.rotations[u];if(r.l+i.z<=t.l&&r.h+i.y<=t.h&&r.w+i.x<=t.w){if(this.checkCollisionNewVersion(i,e)||i.y>0&&!this.canFitAboveTheBoxNewVersion(r,i))continue;return l.w=r.w,l.l=r.l,l.h=r.h,l.validRotation=r.type,[i,a,l]}}if(a==this.openPoints.length-1)return!1}}return!1}removeNonWorkingOpenPoints(t){let e=this.packagesLoaded[this.packagesLoaded.length-1];for(let i=this.openPoints.length-1;i>=0;i--){let l=this.openPoints[i];(t.w==l.x||t.h==l.y||t.l==l.z)&&this.openPoints.splice(i,1)}let a=[];for(let i=0;i<this.openPoints.length;i++){let l=this.openPoints[i];l.x+1>=e.x&&l.x+1<=e.x+e.w&&l.z+1>=e.z&&l.z+1<=e.z+e.l&&l.y==e.y&&l.pointOwner!=e.id&&a.push(i)}a.sort((i,l)=>l-i);for(let i=0;i<a.length;i++)this.openPoints.splice(a[i],1);for(let i=0;i<this.openPoints.length;i++){let l=this.openPoints[i],u=l.pointOwner.split("-")[0];for(let r=i+1;r<this.openPoints.length;r++){let p=this.openPoints[r],m=p.pointOwner.split("-")[0];if(l.x==p.x&&l.y==p.y&&l.type!="S"&&u==m){let d=[],o=[];for(let c=0;c<this.packagesLoaded.length;c++){let s=this.packagesLoaded[c];l.y==0?s.y==l.y&&s.x>l.x&&s.z<=l.z&&s.z+s.l>=l.z&&d.push(s):s.y+s.h==l.y&&s.x<=l.x+1&&s.x+s.w>=l.x+1&&s.z<=l.z+1&&s.z+s.l>=l.z+1&&d.push(s),p.y==0?s.y==p.y&&s.x>p.x&&s.z<=p.z&&s.z+s.l>=p.z&&o.push(s):s.y+s.h==p.y&&s.x<=p.x+1&&s.x+s.w>=p.x+1&&s.z<=p.z+1&&s.z+s.l>=p.z+1&&o.push(s)}d.length!=0&&o.length!=0&&Math.abs(d[0].x-l.x)==Math.abs(o[0].x-p.x)&&this.openPoints.splice(r,1),d.length==0&&o.length==0&&this.openPoints.splice(r,1)}l.x==p.x&&l.z==p.z&&u==m&&this.openPoints.splice(r,1),l.y==p.y&&l.z==p.z&&!l.ignored&&u==m&&p.type!="S"&&this.openPoints.splice(r,1)}}}refreshOpenPoints(t,e){this.openPoints.splice(t,1),this.openPoints=this.removeDuplicatesObjectFromArray(this.openPoints),this.sortOpenPoints(),this.removeNonWorkingOpenPoints(e)}removeDuplicatesObjectFromArray(t){return t.filter((e,a,i)=>i.findIndex(l=>l.x===e.x&&l.y===e.y&&l.z===e.z)===a)}removePointsNextPriority(){this.openPoints=this.openPoints.filter(t=>t.y==0)}getIndexes(t){let e=[];return this.openPoints.map((a,i)=>{parseInt(a.type!=null&&a.type=="T"&&a.pointOwner.split("-")[0])==t.parent_id&&e.push({index:i,data:a})}),e}removeDiagonalPoints(t){let e=this.getIndexes(t),a=[];if(e.length>=2){for(let l=0;l<e.length;l++){let u=e[l];for(let r=l+1;r<e.length;r++){let p=e[r];Math.abs(p.data.z-u.data.z)%t.l==0&&Math.abs(p.data.x-u.data.x)%t.w==0&&u.data.y==p.data.y&&p.data.z>u.data.z&&p.data.x>u.data.x&&a.push(p.index)}}let i=[...new Set(a)];i.sort((l,u)=>u-l),i.map(l=>{this.openPoints.splice(l,1)})}}sortOpenPoints(){this.openPoints.sort((t,e)=>t.x-e.x||t.z-e.z||t.y-e.y)}solve(t,e,a){for(let i=0;i<a.length;i++){let l=e[a[i]];for(let u=0;u<l.length;u++){let r=l[u],p=this.okRotation(t,r);p!==!1&&(this.createPack(p[2],p[0]),this.refreshOpenPoints(p[1],t),this.openPoints.push(...this.createSidePoints()),this.sortOpenPoints(),this.packagesLoaded.length>=2&&this.packagesLoaded[this.packagesLoaded.length-1].parent_id!=this.packagesLoaded[this.packagesLoaded.length-2].parent_id&&this.removeDiagonalPoints(this.packagesLoaded[this.packagesLoaded.length-2]))}this.removePointsNextPriority()}return console.log("packagesLoaded => "),console.log(this.packagesLoaded),console.log("openPoints => "),console.log(this.openPoints),[this.openPoints,this.packagesLoaded]}checkCollisionNewVersion(t,e){let a=this.create2dSpace(t,e,"top"),i=a[0];return a[1],i.length>0}getPackByOpenPoint(t){return this.packagesLoaded.filter(a=>a.id===t.pointOwner)[0]}createSidePoints(){let t=this.packagesLoaded[this.packagesLoaded.length-1],e=[],a=this.openPoints.filter(l=>l.y==t.y&&l.x<t.x+t.w&&l.pointOwner!=t.id&&l.type!="S"&&!l.ignored);a.sort((l,u)=>l.z-u.z);var i=null;if(a.length>0){let l=t.openPoint.F,u=a[0],r=[],p=[],m=[],d=[],o=[],c=[];for(let s=0;s<this.packagesLoaded.length;s++){let n=this.packagesLoaded[s];n.x>l.x&&n.x<=u.x&&n.z>l.z&&n.z<=u.z&&n.y==l.y&&r.push(n),t.y>0&&n.y+n.h==t.y&&n.x<=t.x+t.w+1&&n.x+n.w>=t.x+t.w+1&&n.z<=a[0].z+1&&n.z+n.l>=a[0].z+1&&p.push(n),n.x<=t.x&&n.x+n.w>=t.x&&n.z<=a[0].z&&n.z+n.l>=a[0].z&&m.push(n),n.x>=u.x&&n.x<=l.x&&n.z+1>l.z&&n.z+1<=u.z&&n.y==l.y&&d.push(n),t.y>0&&n.y+n.h==t.y&&n.x<=a[0].x+1&&n.x+n.w>=a[0].x+1&&n.z<=t.z+1&&n.z+n.l>=t.z+1&&o.push(n),n.x<=a[0].x&&n.x+n.w>=a[0].x&&n.z<=t.z&&n.z+n.l>=t.z&&c.push(n)}if(t.z+t.l-a[0].z>0&&r.length==0){let s={pointOwner:t.id,x:t.x+t.w,y:t.y,z:a[0].z,type:"S",ignored:!1,prio:t.priority};t.y==0?(s.z==0||m.length!=0)&&(e.push(s),i=this.openPoints.findIndex(n=>n.x==a[0].x&&n.y==t.y&&n.z==a[0].z)):p.length>0&&(e.push(s),i=this.openPoints.findIndex(n=>n.x==a[0].x&&n.y==t.y&&n.z==a[0].z))}if(t.z+t.l-a[0].z<0&&d.length==0){let s={pointOwner:t.id,x:a[0].x,y:t.y,z:t.z+t.l,type:"S",ignored:!1,prio:t.priority};t.y==0?(s.z==0||c.length!=0)&&(e.push(s),i=this.openPoints.findIndex(n=>n.x==t.x&&n.y==t.y&&n.z==t.z+t.l)):o.length>0&&(e.push(s),i=this.openPoints.findIndex(n=>n.x==t.x&&n.y==t.y&&n.z==t.z+t.l))}i!=-1&&i!=null&&(this.openPoints[i].ignored=!0)}return e}createOpenPoints(t,e){let a=[{pointOwner:e.id,x:t.x,y:t.y+e.h,z:t.z,type:"T",ignored:!1,prio:e.priority}],i=[{pointOwner:e.id,x:t.x,y:t.y,z:t.z+e.l,type:"R",ignored:!1,prio:e.priority},{pointOwner:e.id,x:t.x+e.w,y:t.y,z:t.z,type:"F",ignored:!1,prio:e.priority}];if(t.x==0&&t.y==0&&t.z==0)return[...a,...i];let l=this.create2dSpace(t,e),u=l[0],r=l[1];if(u.length!=0&&Object.keys(r).length!=0)for(let p=0;p<i.length;p++){let m=i[p],d=0;for(let o=0;o<u.length;o++){let c=u[o],s=r[c.id],n={x:m.x+1,z:m.z+1};if(m.y==0)this.isPointContainedInSpace(s,n,!1)||d++;else if(this.isPointContainedInSpace(s,n,!1)){let g=this.packagesLoaded.filter(h=>h.x<=m.x+1&&h.x+h.w>m.x+1&&h.z<=m.z+1&&h.z+h.l>m.z+1&&h.y==t.y&&h.id!=m.pointOwner);m.type=="R"&&s[3].z-m.z,m.type=="F"&&s[3].x-m.x,g.length==0&&(m.type=="R"&&a.push(i[0]),m.type=="F"&&a.push(i[1]))}}d==u.length&&(m.type=="R"&&a.push(i[0]),m.type=="F"&&a.push(i[1]))}return a}createPack(t,e){this.packagesLoaded.push(Q(T(T({},t),e),{openPoint:{R:{x:e.x,y:e.y,z:e.z+t.l},T:{x:e.x,y:e.y+t.h,z:e.z},F:{x:e.x+t.w,y:e.y,z:e.z}}})),this.openPoints.push(...this.createOpenPoints(e,t))}}function Ue(x,t){let e=new y.Group;e.name="All_Packs",t.forEach(i=>{let l=new y.BoxGeometry(i.w,i.h,i.l),u=new y.MeshLambertMaterial({color:i.color*16715775,side:y.DoubleSide}),r=new y.Vector3(i.x,i.y,i.z),p=new y.Group;p.name="Box_Border_"+i.parent_id;let m=new y.Mesh(l,u);m.castShadow=!0,m.receiveShadow=!0,m.name="Pack",m.userData.id=i.parent_id,m.userData.clickable=!1,m.userData.actif=!1,m.userData.name="Pack";let d=new y.EdgesGeometry(l),o=new y.LineSegments(d,new y.LineBasicMaterial({color:16777215}));o.name="Line_"+i.id,o.position.copy(r),o.userData.id=i.parent_id,o.userData.name="Line",o.translateX(i.w/2),o.translateY(i.h/2),o.translateZ(i.l/2),m.position.copy(r),l.translate(i.w/2,i.h/2,i.l/2),p.add(m),p.add(o),e.add(p)}),gsap.timeline();let a=new y.Group;a.name="sphere",x.forEach(i=>{const l=new y.SphereGeometry(3,32,16),u=new y.MeshBasicMaterial({color:16776960}),r=new y.Mesh(l,u);r.position.set(i.x,i.y,i.z),a.add(r)}),P.add(a),P.add(e)}function Je(x,t){return x.filter(e=>!t.some(a=>e.id===a.parent_id))}function Xe(x,t){$("#result").empty(),Ye(t);let e=t.reduce((u,r)=>{let p=r.parent_id,m=x.filter(d=>d.id==p)[0].q;return u[p]==null&&(u[p]={id:r.parent_id,label:r.label,loaded:0,unloaded:0}),u[p].loaded=u[p].loaded+1,u[p].unloaded=m-u[p].loaded,u},{}),i=Je(x,t).reduce((u,r)=>(u[r.id]==null&&(u[r.id]={id:r.id,label:r.label,loaded:0,unloaded:r.q}),u),{}),l=T(T({},e),i);for(let u=0;u<C.allInstances.length;u++){let r=C.allInstances[u].id;C.allInstances[u]=Q(T({},C.allInstances[u]),{loaded:l[r].loaded,unloaded:l[r].unloaded})}for(const u in l){let r="<span class='result-text'><b>Id</b><span>"+l[u].id+"</span></span>",p="<span class='result-text'><b>Label</b><span>"+l[u].label+"</span></span>",m="<span class='result-text'><b>Loaded</b><span>"+l[u].loaded+"</span></span>",d="<span class='result-text'><b>Unloaded</b><span>"+l[u].unloaded+"</span></span>";$("#result").append("<div class='result-detail'>"+r+p+m+d+"</div>")}}function Ye(x){const t="data:text/csv;charset=utf-8,"+[["Id","Label","Width","Height","Lenght","priority","X","Y","Z","RotationFace","RotationAngle"],...x.map(i=>[` ${i.id}`,i.label,i.w,i.h,i.l,i.priority,i.x,i.y,i.z,i.validRotation])].map(i=>i.join(",")).join(`
`);var e=encodeURI(t);let a="result_"+new Date().getTime()+".csv";$("#result").append("<a class='download-result' href="+e+" download="+a+"> Download <b>"+a+"</b> </div>")}$(document).ready(function(){const x=new Worker("src/worker.js",{type:"module"});var t=!1,e=JSON.parse(localStorage.getItem("container"));e!==null&&($("#containerWidth").val(e.w),$("#containerHeight").val(e.h),$("#containerLenght").val(e.l),$("#containerUnloading").val(e.unloading));var a=!1;function i(o=[],c){let s=JSON.parse(localStorage.getItem("routes")),n;if(c=="api"||c=="csv")n=o.length,o=o;else{if(s==null)return;n=s.routeNumber,o=s.routes}if(n>0){$("#routesNumber").val(n);for(let g=0;g<n-1;g++)l();$(".routeFrom").each(function(g){$(this).val(o[g].from)}),$(".routeTo").each(function(g){$(this).val(o[g].to)}),$(".routeType").each(function(g){$(this).val(o[g].type)})}}i([],"localStorage"),$("#routeIncrement").click(function(){let o=parseInt($("#routesNumber").val());$("#routesNumber").val(o+1),l()}),$("#routeDecrement").click(function(){let o=parseInt($("#routesNumber").val());o>1&&($("#routesNumber").val(o-1),$("#routeInputs .inputs").last().remove())});function l(){$("#routeInputs").append(`
            <div class="inputs">
                <div>
                    <p class="inputLabel">From</p>
                    <input type="text" class="input routeFrom" required>
                </div>
                <div>
                    <p class="inputLabel">To</p>
                    <input type="text" class="input routeTo" required>
                </div>
                <div>
                    <p class="inputLabel">Type</p>
                    <select class="input routeType" required>
                        <option value="dechargement">D</option>
                        <option value="chargement">C</option>
                        <option value="dechargement">D et C</option>
                    </select>
                </div>
            </div>`)}$("#routesForm").submit(function(o){o.preventDefault();var c={},s;c.routesNumber=$("#routesNumber").val(),c.from=$(".routeFrom").map(function(){return $(this).val()}).get(),c.to=$(".routeTo").map(function(){return $(this).val()}).get(),c.type=$(".routeType").map(function(){return $(this).val()}).get(),c.routes=[];for(let n=0;n<c.routesNumber;n++){let g={id:n+1,from:c.from[n],to:c.to[n],type:c.type[n]};c.routes.push(g)}s=new U(c.routesNumber,c.routes),s.addOrUpdate(),a=!0}),$("#containerForm").submit(function(o){o.preventDefault();var c={};c.w=$("#containerWidth").val(),c.h=$("#containerHeight").val(),c.l=$("#containerLenght").val(),c.capacity=0,me("all"),new _(c.w,c.h,c.l,c.capacity),new A(c.w,c.h,c.l),t=!0}),$("#packForm").submit(function(o){if(o.preventDefault(),!t){u("please create the container");return}var c={},s;c.label=$("#packLabel").val(),c.w=$("#packWidth").val(),c.h=$("#packHeight").val(),c.l=$("#packLenght").val(),c.q=$("#packQuantity").val(),c.stack=$("#packStackingCapacity").val(),c.priority=$("#packPriority").val(),c.r=["base"],$("#rightSide").is(":checked")&&c.r.push("right-side"),$("#frontSide").is(":checked")&&c.r.push("front-side"),s=new C(c.label,c.w,c.h,c.l,c.q,c.stack,c.r,c.priority,[]),s.add();var n=c.w+" , "+c.h+" , "+c.l+" ( "+c.q+" ) ";$("#packageDetails").append('<div class="packInfo"><div>'+c.label+'</div><div class="packInfo-numbers">'+n+" </div></div>")}),$("#solve").click(function(){if(!a){u("please add a route");return}if(!t){u("please create the container");return}$(".menu").toggleClass("openMenu closeMenu"),$(".menuIcon").toggleClass("openMenuIcon closeMenu"),ye(),C.removePacksFromTheScene(),P.remove(P.getObjectByName("sphere"));var o=new _e("cub"),c=o.initialisePackagesToLoad();new B("Loading",.01).dispatchMessage(),x.postMessage([_.instances,c]),$(".packer-loader").toggleClass("packer-loader--hide packer-loader--show"),x.onmessage=s=>{new B("Loaded (Algorithme)",s.data.executionTime).dispatchMessage(),$(".packer-loader").toggleClass("packer-loader--hide packer-loader--show"),$("#loadBoxes").is(":checked")&&Ue(s.data.packer[0],s.data.packer[1]),Xe(C.allInstances,s.data.packer[1]),$("#numberBox").val(s.data.packer[1].length),new B("Loaded (3D models)",s.data.executionTime).dispatchMessage()}});function u(o){$(".error-container").toggleClass("error-container--hidden"),$("#errorMsg").html(o),setTimeout(()=>{$(".error-container").toggleClass("error-container--hidden")},1500)}let r=!1;$("#switchManuelleMode").click(function(){if(!t){u("please create the container");return}me("loadedPacks"),$(".menu").toggleClass("openMenu closeMenu"),$(".menuIcon").toggleClass("openMenuIcon closeMenu"),$(".dragDrop-container").toggleClass("hidden"),C.reloadShowPacker(),r=!r,$("#solve").toggleClass("disabled"),A.switch(r)}),C.loadPacksFromLocalStorage(),$("#updatePack").click(function(o){o.preventDefault();var c={};c.id=$("#pack_Detail_Id").val(),c.label=$("#pack_Detail_Label").val(),c.w=$("#pack_Detail_Width").val()*b,c.h=$("#pack_Detail_Height").val()*b,c.l=$("#pack_Detail_Lenght").val()*b,c.q=$("#pack_Detail_Quantity").val(),c.stack=$("#pack_Detail_StackingCapacity").val(),c.priority=$("#pack_Detail_Priority").val(),c.r=["base"],$("#pack_Detail_right-side").is(":checked")&&c.r.push("right-side"),$("#pack_Detail_front-side").is(":checked")&&c.r.push("front-side");let s=p(".sub-q"),n=p(".sub-prio"),g=[];for(let h=0;h<s.length;h++){let v=s[h],z=n[h];g.push({n:v,p:z})}c.subQuantities=g,C.update(c,c.id),C.removeBoxesFromTheScene(),C.loadPacks()});function p(o){let c=$(o),s=[];for(let n=0;n<c.length;n++){let g=c[n];s.push(parseInt(g.value))}return s}$("#deletePack").click(function(o){o.preventDefault();let c=$("#pack_Detail_Id").val();C.remove(c),C.removeBoxesFromTheScene(),C.loadPacks()}),$("#actual-btn").change(function(o){var c=$("#actual-btn").val().split(".").pop().toLowerCase();if($.inArray(c,["csv"])==-1)return u("Upload CSV file"),!1;if(o.target.files!=null){$("#file-chosen").html(o.target.files[0].name);var s=new FileReader;s.onload=function(n){var g=n.target.result.split(`\r
`);m(g)},s.readAsText(o.target.files.item(0))}return!1});function m(o){let c=[];for(let s=6;s<o.length;s++)if(o[s].length>0){console.log(o[s]);let n=o[s].split(",");if(n[0]=="container"&&(new _(n[1],n[2],n[3],n[4]),t=!0),n[0]=="colis"){let g=[];for(let h=6;h<=8;h++)n[h]!=null&&g.push(n[h].replace('"',""));new C(n[1],n[2],n[3],n[4],n[5],n[6],[...g]).add()}n[0]=="route"&&(c.push({id:n[1],from:n[2],to:n[3],type:n[4]}),a=!0)}new U(c.length,c).addOrUpdate(),i(c,"csv")}$("#numberBox").on("input",function(o){if(o.target.value!=null&&P.getObjectByName("All_Packs")){let c=P.getObjectByName("All_Packs").children;o.target.max=c.length;for(let s=o.target.value-1;s>=0;s--){let n=c[s].children,g=n[0],h=n[1];g.visible=!0,h.visible=!0}for(let s=c.length-1;s>=o.target.value;s--){let n=c[s].children,g=n[0],h=n[1];g.visible=!1,h.visible=!1}}}),$("#loadApi").click(async function(){let o=$("#apiUrl").val();await fetch(o).then(c=>{if(c.ok)return c.json()}).then(c=>{console.log(c),d(c)}).catch(c=>console.log(c))});function d(o){console.log(o);let c=o.container,s=o.colis,n=o.routes;new U(n.length,n).addOrUpdate(),i(n,"api"),a=!0,new _(c.w,c.h,c.l,c.capacity,c.unloading),t=!0,s.map(h=>{new C(h.label,h.w,h.h,h.l,h.q,h.stackingCapacity,h.rotations,h.priority).add()}),new B("Load Data",.01).dispatchMessage()}$("#random").click(function(){$("#packLabel").val("colis "+Math.floor(Math.random()*100)),$("#packWidth").val(Math.floor((Math.random()*(2-.1+1)+.1)*100)/100),$("#packHeight").val(Math.floor((Math.random()*(2-.1+1)+.1)*100)/100),$("#packLenght").val(Math.floor((Math.random()*(2-.1+1)+.1)*100)/100),$("#packQuantity").val(Math.floor(Math.random()*20+1))})});
