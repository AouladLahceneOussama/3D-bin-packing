var ye=Object.defineProperty,we=Object.defineProperties;var ve=Object.getOwnPropertyDescriptors;var ue=Object.getOwnPropertySymbols;var ze=Object.prototype.hasOwnProperty,Pe=Object.prototype.propertyIsEnumerable;var Z=(m,t,e)=>t in m?ye(m,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):m[t]=e,B=(m,t)=>{for(var e in t||(t={}))ze.call(t,e)&&Z(m,e,t[e]);if(ue)for(var e of ue(t))Pe.call(t,e)&&Z(m,e,t[e]);return m},Q=(m,t)=>we(m,ve(t));var O=(m,t,e)=>(Z(m,typeof t!="symbol"?t+"":t,e),e);import*as x from"https://threejsfundamentals.org/threejs/resources/threejs/r122/build/three.module.js";import{OrbitControls as be}from"https://threejsfundamentals.org/threejs/resources/threejs/r122/examples/jsm/controls/OrbitControls.js";import{GLTFLoader as $e}from"https://threejsfundamentals.org/threejs/resources/threejs/r122/examples/jsm/loaders/GLTFLoader.js";import{TransformControls as ke}from"https://threejsfundamentals.org/threejs/resources/threejs/r122/examples/jsm/controls/TransformControls.js";const Ie=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))o(i);new MutationObserver(i=>{for(const a of i)if(a.type==="childList")for(const c of a.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&o(c)}).observe(document,{childList:!0,subtree:!0});function e(i){const a={};return i.integrity&&(a.integrity=i.integrity),i.referrerpolicy&&(a.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?a.credentials="include":i.crossorigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function o(i){if(i.ep)return;i.ep=!0;const a=e(i);fetch(i.href,a)}};Ie();const b=100,P=new x.Scene,F=document.getElementById("3D-container"),de=document.getElementById("exampleModalfat");let De=0;const oe=class{constructor(t,e){this.id=De++,this.action=t,this.executionTime=e,oe.allMessages.push(this.getMessageDetail)}get getMessageDetail(){return{id:this.id,action:this.action,executionTime:this.executionTime}}dateTime(){var t=new Date,e=t.getFullYear()+"-"+(t.getMonth()+1)+"-"+t.getDate(),o=t.getHours()+":"+t.getMinutes()+":"+t.getSeconds();return e+" - "+o}dispatchMessage(){let t="<div class='logTime'><p>"+this.dateTime()+"</p><p>Execution Time : "+this.executionTime.toFixed(2)+"s</p></div>",e=" <div class='logDetail'><h3>"+this.action+"</h3>"+t+"</div>";$(".logMsg").append(e),$(".logMsg").animate({scrollTop:$(".logMsg").prop("scrollHeight")},250)}};let N=oe;O(N,"allMessages",[]);let Se=0;const E=class{constructor(t=0,e=[]){this.id=Se++,this.routeNumber=parseInt(t),console.log(e),this.routes=e,E.allRoutes=this.getRoute}get getRoute(){return console.log(this.routes),{routeNumber:this.routeNumber,routes:this.routes}}get getRouteToLocalStorage(){return{routeNumber:this.routeNumber,routes:this.routes}}static getRouteNumber(t){return E.allRoutes.routes.filter(o=>(console.log(o.type,t),o.type==t)).length}static initialisePriorityFields(){$("#packPriority option").remove(),$("#pack_Detail_Priority option").remove();for(let t=1;t<=E.getRouteNumber("dechargement");t++)$("#packPriority").append('<option value="'+t+'">'+t+"</option>"),$("#pack_Detail_Priority").append('<option value="'+t+'">'+t+"</option>")}static init(){localStorage.getItem("routes")!==null&&(JSON.parse(localStorage.getItem("routes")).forEach(e=>{new E(e.routeNumber,e.from,e.to,e.type)}),E.allRoutes.routes.forEach(e=>{var o=e.from+" - "+e.to+"("+e.type+")",i="p : "+e.id;$("#routesDetails").append('<div class="packInfo"><div>'+o+'</div><div class="packInfo-numbers">'+i+" </div></div>")}),E.initialisePriorityFields())}add(){var t=[];localStorage.getItem("routes")!==null&&(t=JSON.parse(localStorage.getItem("routes"))),t.push(this.getRouteToLocalStorage),localStorage.setItem("routes",JSON.stringify(t)),E.allRoutes.routes.forEach(o=>{var i=o.from+" - "+o.to+"("+o.type+")",a="p : "+o.id;$("#routesDetails").append('<div class="packInfo"><div>'+i+'</div><div class="packInfo-numbers">'+a+" </div></div>")}),E.initialisePriorityFields(),new N("Adding route",.01).dispatchMessage()}};let ee=E;O(ee,"allRoutes");let Ce=0;const S=class{constructor(t,e,o,i,a,c,r,n,u=[]){this.id=Ce++,this.label=t,this.w=parseInt(e*b),this.h=parseInt(o*b),this.l=parseInt(i*b),this.q=parseInt(a),this.v=this.w*this.h*this.l,this.stackingCapacity=parseInt(c),this.rotations=r,this.dimensions=this.setDimensions(r),this.priority=parseInt(n),this.color=Math.random(),this.multiplePrio=u.length>0,this.subQuantities=u,S.allInstances.push(this.getPack)}get getPack(){return{id:this.id,label:this.label,w:this.w,h:this.h,l:this.l,q:this.q,v:this.v,priority:this.priority,stackC:this.stackingCapacity,rotations:this.dimensions,rotateDirections:this.rotations,multiplePrio:this.multiplePrio,subQuantities:this.subQuantities,color:this.color}}get getPackToLocalStorage(){return{label:this.label,w:this.w/b,h:this.h/b,l:this.l/b,q:this.q,priority:this.priority,stackC:this.stackingCapacity,rotations:this.rotations,subQuantities:this.subQuantities}}setDimensions(t){let e=[];for(let i=0;i<t.length;i++){let a=t[i];a=="base"&&e.push({w:this.w,h:this.h,l:this.l,type:[a,0],surface:this.w*this.l},{w:this.l,h:this.h,l:this.w,type:[a,90],surface:this.w*this.l}),a=="right-side"&&e.push({w:this.w,h:this.l,l:this.h,type:[a,0],surface:this.w*this.h},{w:this.h,h:this.l,l:this.w,type:[a,90],surface:this.w*this.h}),a=="front-side"&&e.push({w:this.h,h:this.w,l:this.l,type:[a,0],surface:this.h*this.l},{w:this.l,h:this.w,l:this.h,type:[a,90],surface:this.h*this.l})}e.sort((i,a)=>a.surface-i.surface);for(let i=0;i<e.length;i+=2)if(e[i].l>e[i].w){var o=e[i+1];e[i+1]=e[i],e[i]=o}return e}static init(){localStorage.getItem("packages")!==null&&(JSON.parse(localStorage.getItem("packages")).forEach(e=>{new S(e.label,e.w,e.h,e.l,e.q,e.stackC,e.rotations,e.priority,e.subQuantities)}),S.allInstances.forEach(e=>{var o=e.w/b+" , "+e.h/b+" , "+e.l/b+" ( "+e.q+" ) ";$("#packageDetails").append('<div class="packInfo"><div>'+e.label+'</div><div class="packInfo-numbers">'+o+" </div></div>")}))}add(){var t=[];localStorage.getItem("packages")!==null&&(t=JSON.parse(localStorage.getItem("packages"))),t.push(this.getPackToLocalStorage),localStorage.setItem("packages",JSON.stringify(t)),S.loadPacks(),new N("Adding Pack",.01).dispatchMessage()}static updatePackLocalstorage(){localStorage.removeItem("packages");let t=[];S.allInstances.map(e=>{t.push({label:e.label,w:parseFloat(e.w/b),h:parseFloat(e.h/b),l:parseFloat(e.l/b),q:parseInt(e.q),priority:e.priority,stackC:parseInt(e.stackC),rotations:e.rotateDirections,multiplePrio:e.subQuantities.length>0,subQuantities:e.subQuantities})}),localStorage.setItem("packages",JSON.stringify(t))}static update(t,e){function o(u,s,l,h){let d=[];for(let y=0;y<u.length;y++){let p=u[y];p=="base"&&d.push({w:s,h:l,l:h,type:[p,0],surface:s*h},{w:h,h:l,l:s,type:[p,90],surface:s*h}),p=="right-side"&&d.push({w:s,h,l,type:[p,0],surface:s*l},{w:l,h,l:s,type:[p,90],surface:s*l}),p=="front-side"&&d.push({w:l,h:s,l:h,type:[p,0],surface:l*h},{w:h,h:s,l,type:[p,90],surface:l*h})}d.sort((y,p)=>p.surface-y.surface);for(let y=0;y<d.length;y+=2)if(d[y].l>d[y].w){var g=d[y+1];d[y+1]=d[y],d[y]=g}return d}let i=S.allInstances.findIndex(u=>u.id==parseInt(e)),a=S.allInstances[i],c={label:t.label,w:parseInt(t.w),h:parseInt(t.h),l:parseInt(t.l),q:parseInt(t.q),priority:parseInt(t.priority),v:t.w*t.h*t.l,stackC:parseInt(t.stack),rotateDirections:t.r,rotations:o(t.r,parseInt(t.w),parseInt(t.h),parseInt(t.l)),multiplePrio:t.subQuantities.length>0,subQuantities:t.subQuantities},r=B(B({},a),c);S.allInstances[i]=r,S.removePacksFromTheScene(),S.updatePackLocalstorage(),$("#packageDetails").empty(),S.allInstances.forEach(u=>{var s=u.w/b+" , "+u.h/b+" , "+u.l/b+" ( "+u.q+" ) ";$("#packageDetails").append('<div class="packInfo"><div>'+u.label+'</div><div class="packInfo-numbers">'+s+" </div></div>")}),new N("Updating Pack",.01).dispatchMessage()}static remove(t){let e=S.allInstances.findIndex(i=>i.id==parseInt(t));S.allInstances.splice(e,1),S.removePacksFromTheScene(),S.updatePackLocalstorage(),$("#packageDetails").empty(),S.allInstances.forEach(i=>{var a=i.w/b+" , "+i.h/b+" , "+i.l/b+" ( "+i.q+" ) ";$("#packageDetails").append('<div class="packInfo"><div>'+i.label+'</div><div class="packInfo-numbers">'+a+" </div></div>")}),new N("Remove Pack",.01).dispatchMessage()}static loadPacks(){function t(u){var s=u.w/b+" , "+u.h/b+" , "+u.l/b+" ( "+u.q+" ) ";$("#packageDetails").append('<div class="packInfo"><div>'+u.label+'</div><div class="packInfo-numbers">'+s+" </div></div>")}S.removeBoxesFromTheScene(),$("#packageDetails div").remove();let e=S.allInstances,o=new x.Group;o.name="pack_shower",e.sort((u,s)=>s.v-u.v);var i,a,c;let r=-300,n=400;for(let u=0;u<e.length;u++){let s=e[u];a=new x.BoxGeometry(s.w,s.h,s.l),c=new x.MeshLambertMaterial({color:s.color*16715775,side:x.DoubleSide}),i=new x.Mesh(a,c),i.castShadow=!0,i.receiveShadow=!0,i.userData.id=s.id,i.userData.hover=!0,i.userData.dragDrop=!0,i.userData.clickable=!0,i.userData.actif=!1,i.userData.name="Pack",u!=0?i.position.set(r,-110-.1,n):i.position.set(r,-65,n),r+=s.w+20,r>800&&(n+=400,r=-300),a.translate(s.w/2,s.h/2,s.l/2),o.add(i),t(s)}P.add(o)}static loadPacksFromLocalStorage(){S.init(),S.loadPacks()}static removePacksFromTheScene(){P.remove(P.getObjectByName("All_Packs"))}static removeBoxesFromTheScene(){P.remove(P.getObjectByName("pack_shower"))}};let C=S;O(C,"allInstances",[]);let Me=0;const se=class{constructor(t,e,o){this.id=Me++,this.pack=t,this.loaded=e,this.stat=o,se.allMessages.push(this.getMessageDetail)}get getMessageDetail(){return{id:this.id,pack:this.pack,loaded:this.loaded,stat:this.stat}}dispatchMessage(){$(".logger-content div").remove();let t=`
            <div class="logger-detail">
            <span class="pack-title">Label</span>
            <span>${this.pack.label}</span>
            </div>
            <div class="logger-detail">
            <span class="pack-title">Quantity</span>
            <span>${this.pack.q}</span>
            </div>
            <div class="logger-detail">
            <span class="pack-title">Loaded</span>
            <span>${this.loaded}</span>
            </div>
            <div class="logger-detail">
            <span class="pack-title">Stat</span>
            <span>${this.stat}</span>
            </div>
        `;$(".logger-content").append(t)}};let X=se;O(X,"allMessages",[]);const Y=class{constructor(t,e,o){this.width=parseInt(t*b),this.height=parseInt(e*b),this.lenght=parseInt(o*b),Y.dragSurface=this.getDragSurface}get getDragSurface(){return{width:this.width,height:this.height,lenght:this.lenght}}static switch(t){Y.draggerStat=t}};let q=Y;O(q,"draggerStat",!1),O(q,"dragSurface",{});const le=class{constructor(t,e){this.object=t,this.parent_id=e,this.packDetails=C.allInstances.find(o=>o.id==e),this.q=this.packDetails.q,this.stat={dimensions:{w:this.packDetails.w,h:this.packDetails.h,l:this.packDetails.l},position:this.object.position},console.log(this.object.position),le.allDraggableItems.push(this.getItem)}get getItem(){return{object:this.object,parent_id:this.parent_id,packDetails:this.packDetails,q:this.q,stat:this.stat}}bestPosition(){return D.specificOpenPoints[0]}createDragItem(t){let e=this.checkQuantityItem(this.parent_id,this.q);if(console.log(e),new X(this.packDetails,e==-1?this.q:e,e==-1?"All loaded":D.specificOpenPoints.length>0?"On loading":"No left space in the container").dispatchMessage(),e!=-1&&D.specificOpenPoints.length>0){let o=new x.Group;o.name="Box_Border_"+this.parent_id+"-"+e,o.userData.parent_id=this.parent_id,o.userData.id=this.parent_id+"-"+e,o.userData.name="Box_border",console.log(D.specificOpenPoints);let i=D.specificOpenPoints[0].rotations[0],a=new x.MeshLambertMaterial({color:this.packDetails.color*16715775,side:x.DoubleSide}),c=new x.BoxGeometry(i.w,i.h,i.l),r=new x.Mesh(c,a);r.userData.parent_id=this.parent_id,r.userData.id=this.parent_id+"-"+e;let n=new x.EdgesGeometry(c),u=new x.LineSegments(n,new x.LineBasicMaterial({color:16777215}));u.name="Line_"+this.parent_id,u.userData.id=this.parent_id,u.userData.name="Line";let s=this.bestPosition(i);return this.stat.position=s,o.position.set(s.x,s.y,s.z),c.translate(i.w/2,i.h/2,i.l/2),n.translate(i.w/2,i.h/2,i.l/2),o.add(r),o.add(u),P.add(o),t.attach(o),r}return!1}checkQuantityItem(t,e){console.log(D.loadedPack);let o=D.loadedPack.filter(i=>i.box.userData.parent_id==t);return D.loadedPack.length==0?0:e-o.length>0?o.length:-1}};let te=le;O(te,"allDraggableItems",[]);localStorage.setItem("steps",JSON.stringify([{stepNumber:0,loadedPacks:[],openPoint:[{x:0,y:0,z:0}]}]));function ge(m,t){[{rotation:"base",angles:[0,Math.PI/2]},{rotation:"right-side",angles:[0,Math.PI/2]},{rotation:"front-side",angles:[0,Math.PI/2]}].forEach(o=>{$(`#d-${o.rotation} .fa-cube`).toggleClass(m,t),$(`#d-${o.rotation} .fa-arrow-rotate-left`).toggleClass(m,t),$(`#d-${o.rotation} .fa-arrow-rotate-right`).toggleClass(m,t)})}function he(m){ge("d-less-opacity",!0);let t=m.reduce((e,o)=>{let i=o.type[0],a=o.type[1]==0?"fa-arrow-rotate-left":"fa-arrow-rotate-right";return e[i]==null?e[i]=[a]:e[i].push(a),e},{});for(const e in t)$(`#d-${e} .fa-cube`).removeClass("d-less-opacity"),t[e].forEach(o=>{$(`#d-${e} .${o}`).removeClass("d-less-opacity")})}function Oe(m,t){ge("d-current-rotate ",!1);let e=t==0?"fa-arrow-rotate-left":"fa-arrow-rotate-right";$(`#d-${m} .fa-cube`).addClass("d-current-rotate"),$(`#d-${m} .${e}`).addClass("d-current-rotate")}$("#delete-all").click(function(){let m=[];P.traverse(t=>{t.userData.name==="Box_border"&&m.push(t)}),D.currentStep=0,D.loadedPack=[],D.openPoints=[{x:0,y:0,z:0}],m.forEach(t=>P.remove(t))});$("#dragDrop-backward").click(function(){let m=JSON.parse(localStorage.getItem("steps"));if(console.log("backward",D.currentStep),m.length>0&&D.currentStep>0){$("#dragDrop-backward").removeClass("disabled");let t=m.find(i=>i.stepNumber==D.currentStep),e=m.find(i=>i.stepNumber==D.currentStep-1);console.log(t,e),D.loadedPack=D.allLoadedPacks.slice(0,e.loadedPacks.length),D.openPoints=e.openPoint,console.log(D.allLoadedPacks,D.loadedPack,e.loadedPacks.length-1);let o=t.loadedPacks[t.loadedPacks.length-1];P.remove(P.getObjectByName("Box_Border_"+o.id)),D.currentStep=D.currentStep-1}if(D.currentStep==0){$("#dragDrop-backward").addClass("disabled");return}});setInterval(()=>{D.currentStep>0&&$("#dragDrop-backward").removeClass("disabled")},100);$("#openDragger").click(function(){$("#openDragger i").toggleClass("fa-circle-plus fa-circle-minus"),$("#dragDrop").toggleClass("dragDrop-container--close dragDrop-container--open")});$(".guidline-dragdrop-container").click(function(){$($(this)).toggleClass("toggleGuidlines")});$("#dragDrop-shortcuts").click(function(){$(".guidline-dragdrop-container").toggleClass("toggleGuidlines")});const f=class{constructor(){this.transformControl}start(t,e){if(this.transformControl=new ke(R,A.domElement),this.transformControl.setSpace("local"),this.transformControl.setRotationSnap(Math.PI/2),P.add(this.transformControl),this.transformControl.addEventListener("dragging-changed",function(o){j.enabled=!o.value}),console.log(f.item),Object.keys(f.item).length==0){let o=new te(t,e);f.item=o.getItem,f.filterOpenPointByPackage();let i=o.createDragItem(this.transformControl);i!=!1?(f.currentPos=f.item.stat.position,this.dragging(i)):f.item={}}else console.log("Please confirm the position of the current dragged pack [press enter]")}static getNbLoadedPacksById(t,e){console.log(t,e);let o=f.loadedPack.filter(i=>i.box.userData.parent_id==t);return f.loadedPack.length==0?0:e-o.length>=0?o.length:-1}dragging(t){let e=this.transformControl;function o(){if(e!=null){let d=f.item.stat.dimensions,g=f.item.stat.position,y=new x.BoxGeometry(d.w,d.h,d.l),p=new x.EdgesGeometry(y);y.translate(d.w/2,d.h/2,d.l/2),p.translate(d.w/2,d.h/2,d.l/2),e.object.children[0].geometry=y,e.object.children[1].geometry=p,e.object.position.set(g.x,g.y,g.z)}}function i(d){let g=f.loadedPack.filter(p=>(d.y>0?p.y+p.h:p.y)==d.y),y=[];return g.forEach(p=>{y[p.id]==null&&(y[p.id]=[]),y[p.id].push({x:p.x,z:p.z},{x:p.x+p.w,z:p.z},{x:p.x,z:p.z+p.l},{x:p.x+p.w,z:p.z+p.l})}),[g,y]}function a(d,g,y){return y?g.x>d[0].x&&g.x<=d[3].x&&g.z>d[0].z&&g.z<=d[3].z:g.x>=d[0].x&&g.x<=d[3].x&&g.z>=d[0].z&&g.z<=d[3].z}function c(){let d=JSON.parse(localStorage.getItem("steps"));d!=null&&(d.push({stepNumber:++f.currentStep,loadedPacks:f.loadedPack,openPoint:f.openPoints}),localStorage.setItem("steps",JSON.stringify(d)))}function r(){function d(g,y){let p=[{pointOwner:y.id,x:g.x,y:g.y+y.h,z:g.z,type:"T",ignored:!1}],v=[{pointOwner:y.id,x:g.x,y:g.y,z:g.z+y.l,type:"R",ignored:!1},{pointOwner:y.id,x:g.x+y.w,y:g.y,z:g.z,type:"F",ignored:!1}];if(g.x==0&&g.y==0&&g.z==0)return[...p,...v];let z=i(g),w=z[0],M=z[1];if(w.length!=0&&Object.keys(M).length!=0)for(let L=0;L<v.length;L++){let k=v[L],H=0;for(let W=0;W<w.length;W++){let _=w[W],I=M[_.id],ce={x:k.x+1,z:k.z+1};if(k.y==0)a(I,ce,!1)||H++;else if(a(I,ce,!1)){let xe=f.loadedPack.filter(G=>G.x<=k.x+1&&G.x+G.w>k.x+1&&G.z<=k.z+1&&G.z+G.l>k.z+1&&G.y==g.y&&G.id!=k.pointOwner);k.type=="R"&&I[3].z-k.z,k.type=="F"&&I[3].x-k.x,xe.length==0&&(k.type=="R"&&p.push(v[0]),k.type=="F"&&p.push(v[1]))}}H==w.length&&(k.type=="R"&&p.push(v[0]),k.type=="F"&&p.push(v[1]))}return p}if(e!=null){let y=e.object.children[0].geometry.parameters;console.log(e.object),f.loadedPack.push({id:t.userData.id,parent_id:t.userData.parent_id,w:y.width,h:y.height,l:y.depth,x:f.currentPos.x,y:f.currentPos.y,z:f.currentPos.z,color:f.item.packDetails.color,box:t,fullBox:e.object}),f.allLoadedPacks.push({id:t.userData.id,parent_id:t.userData.parent_id,w:y.width,h:y.height,l:y.depth,x:f.currentPos.x,y:f.currentPos.y,z:f.currentPos.z,color:f.item.packDetails.color,box:t,fullBox:e.object});let p=f.getNbLoadedPacksById(f.item.parent_id,f.item.q);new X(f.item.packDetails,p,f.item.q-p==0?"All loaded":"On loading").dispatchMessage(),f.openPoints.push(...d(f.currentPos,f.loadedPack[f.loadedPack.length-1]));let v=f.openPoints.findIndex(w=>w.x==f.currentPos.x&&w.y==f.currentPos.y&&w.z==f.currentPos.z);h(v),f.openPoints.sort((w,M)=>w.x-M.x||w.z-M.z||w.y-M.y);let z=new x.Group;z.name="sphere",f.openPoints.forEach(w=>{const M=new x.SphereGeometry(3,32,16),L=new x.MeshBasicMaterial({color:16776960}),k=new x.Mesh(M,L);k.position.set(w.x,w.y,w.z),z.add(k)}),c(),P.remove(P.getObjectByName("sphere")),P.add(z),e.detach(),e=null,n(t.userData.parent_id)}}function n(d){let g=f.loadedPack.filter(y=>y.box.userData.parent_id==d);if(f.item.q-g.length==0){console.log(g);let p=P.getObjectByName("pack_shower").children.find(v=>v.userData.id==g[0].box.userData.parent_id);p.material.transparent=!0,p.material.opacity=.6}f.item={}}function u(){let d=f.currentPos,g=f.specificOpenPoints.find(p=>p.x==d.x&&p.y==d.y&&p.z==d.z);console.log(g);let y=g.rotations.findIndex(p=>p.type[0]==f.currentRotation.face&&p.type[1]==f.currentRotation.yAxis);if(y!=-1){let p=g.rotations[++y%g.rotations.length],v=new x.BoxGeometry(p.w,p.h,p.l),z=new x.EdgesGeometry(v);v.translate(p.w/2,p.h/2,p.l/2),z.translate(p.w/2,p.h/2,p.l/2),e!=null&&(e.object.children[0].geometry=v,e.object.children[1].geometry=z,f.currentRotation={face:g.rotations[y%g.rotations.length].type[0],yAxis:g.rotations[y%g.rotations.length].type[1]},Oe(f.currentRotation.face,f.currentRotation.yAxis))}}function s(d){let g=f.specificOpenPoints.find(z=>z.x==d.x&&z.y==d.y&&z.z==d.z),y=g.rotations[0],p=new x.BoxGeometry(y.w,y.h,y.l),v=new x.EdgesGeometry(p);return p.translate(y.w/2,y.h/2,y.l/2),v.translate(y.w/2,y.h/2,y.l/2),e!=null&&(e.object.children[0].geometry=p,e.object.children[1].geometry=v,f.currentRotation={face:g.rotations[0].type[0],yAxis:g.rotations[0].type[1]}),g.rotations}function l(d){const g=(p,v)=>Math.sqrt((v.x-p.x)**2+(v.y-p.y)**2+(v.z-p.z)**2),y=(p,v,z=1e-5)=>{const w=v.map(L=>g(p,L)),M=Math.min(...w);return v.find((L,k)=>w[k]-M<z)};return f.openPoints.length==1?y(d,f.openPoints):y(d,f.specificOpenPoints)}function h(d){function g(p){return p.filter((v,z,w)=>w.findIndex(M=>M.x===v.x&&M.y===v.y&&M.z===v.z)===z)}function y(){let p=f.loadedPack[f.loadedPack.length-1];for(let z=f.openPoints.length-1;z>=0;z--){let w=f.openPoints[z];(q.width==w.x||q.height==w.y||q.lenght==w.z)&&f.openPoints.splice(z,1)}let v=[];f.openPoints.map((z,w)=>{z.x+1>=p.x&&z.x+1<=p.x+p.w&&z.z+1>=p.z&&z.z+1<=p.z+p.l&&z.y==p.y&&z.pointOwner!=p.id&&v.push(w)}),v.sort((z,w)=>w-z);for(let z=0;z<v.length;z++)console.log(f.openPoints[v[z]]),f.openPoints.splice(v[z],1);for(let z=0;z<f.openPoints.length;z++){let w=f.openPoints[z],M=w.pointOwner.split("-")[0];for(let L=z+1;L<f.openPoints.length;L++){let k=f.openPoints[L],H=k.pointOwner.split("-")[0];if(w.x==k.x&&w.y==k.y&&w.type!="S"&&M==H){let W=f.loadedPack.filter(I=>w.y==0?I.y==w.y&&I.x>w.x&&I.z<=w.z&&I.z+I.l>=w.z:I.y+I.h==w.y&&I.x<=w.x+1&&I.x+I.w>=w.x+1&&I.z<=w.z+1&&I.z+I.l>=w.z+1),_=f.loadedPack.filter(I=>k.y==0?I.y==k.y&&I.x>k.x&&I.z<=k.z&&I.z+I.l>=k.z:I.y+I.h==k.y&&I.x<=k.x+1&&I.x+I.w>=k.x+1&&I.z<=k.z+1&&I.z+I.l>=k.z+1);W.length!=0&&_.length!=0&&Math.abs(W[0].x-w.x)==Math.abs(_[0].x-k.x)&&f.openPoints.splice(L,1),W.length==0&&_.length==0&&f.openPoints.splice(L,1)}w.x==k.x&&w.z==k.z&&M==H&&f.openPoints.splice(L,1),w.y==k.y&&w.z==k.z&&!w.ignored&&M==H&&k.type!="S"&&f.openPoints.splice(L,1)}}}d!=-1&&f.openPoints.splice(d,1),f.openPoints=g(f.openPoints),f.openPoints.sort((p,v)=>p.x-v.x||p.z-v.z||p.y-v.y),y()}e.addEventListener("mouseUp",function(d){let g=e.object,y=d.target.children[1].position,p=l(y);console.log(p),g.position.set(p.x,p.y,p.z);let v=s(p);f.currentPos=p,f.mouseOnAction=!1,he(v)}),e.addEventListener("mouseDown",function(d){f.mouseOnAction=!0}),document.addEventListener("keydown",function(d){switch(d.key.toUpperCase()){case"DELETE":!f.mouseOnAction&&e!=null&&(f.item={},P.remove(e.object),e.detach(),e=null);break;case"SHIFT":e.setTranslationSnap(100),e.setRotationSnap(Math.PI/2),e.setScaleSnap(.25);break;case"W":e.setMode("translate");break;case"E":e.setMode("rotate");break;case"R":e.setMode("scale");break;case"+":case"=":e.setSize(e.size+.1);break;case"-":case"_":e.setSize(Math.max(e.size-.1,.1));break;case"X":e.showX=!e.showX;break;case"Y":e.showY=!e.showY;break;case"Z":e.showZ=!e.showZ;break;case" ":e.enabled=!e.enabled;break;case"ESCAPE":f.mouseOnAction||o();break;case"ENTER":f.mouseOnAction||r();break;case"F":f.mouseOnAction||u();break;default:console.log("this key don't support any action")}})}static filterOpenPointByPackage(){function t(s){let l=f.loadedPack.filter(d=>(s.y>0?d.y+d.h:d.y)==s.y),h=[];return l.forEach(d=>{h[d.id]==null&&(h[d.id]=[]),h[d.id].push({x:d.x,z:d.z},{x:d.x+d.w,z:d.z},{x:d.x,z:d.z+d.l},{x:d.x+d.w,z:d.z+d.l})}),[l,h]}function e(s,l,h){return h?l.x>s[0].x&&l.x<=s[3].x&&l.z>s[0].z&&l.z<=s[3].z:l.x>=s[0].x&&l.x<=s[3].x&&l.z>=s[0].z&&l.z<=s[3].z}function o(s){s.geometry.computeBoundingBox(),s.updateMatrixWorld();let l=s.geometry.boundingBox.clone();l.applyMatrix4(s.matrixWorld),l.max.x=l.max.x-1,l.max.y=l.max.y-1,l.max.z=l.max.z-1,l.min.x=l.min.x+1,l.min.y=l.min.y+1,l.min.z=l.min.z+1,console.log(f.loadedPack);for(let h=0;h<f.loadedPack.length;h++){let d=f.loadedPack[h].box;d.geometry.computeBoundingBox(),d.updateMatrixWorld();let g=d.geometry.boundingBox.clone();if(g.applyMatrix4(d.matrixWorld),g.max.x=g.max.x-1,g.max.y=g.max.y-1,g.max.z=g.max.z-1,g.min.x=g.min.x+1,g.min.y=g.min.y+1,g.min.z=g.min.z+1,l.intersectsBox(g))return l.intersectsBox(g)}return!1}function i(s,l){let h=new x.MeshLambertMaterial({color:16715775,side:x.DoubleSide}),d=new x.BoxGeometry(s.w,s.h,s.l),g=new x.Mesh(d,h),y=new x.Vector3(l.x,l.y,l.z);return g.position.copy(y),d.translate(s.w/2,s.h/2,s.l/2),g}function a(s,l){let h=[{x:l.x,z:l.z},{x:(3*l.x+(l.x+s.w))/4,z:l.z},{x:(l.x+(l.x+s.w))/2,z:l.z},{x:(l.x+3*(l.x+s.w))/4,z:l.z},{x:l.x+s.w,z:l.z},{x:l.x,z:(l.z+3*(l.z+s.l))/4},{x:l.x,z:(l.z+(l.z+s.l))/2},{x:l.x,z:(3*l.z+(l.z+s.l))/4},{x:l.x,z:l.z+s.l},{x:(l.x+3*(l.x+s.w))/4,z:l.z+s.l},{x:(l.x+(l.x+s.w))/2,z:l.z+s.l},{x:(3*l.x+(l.x+s.w))/4,z:l.z+s.l},{x:l.x+s.w,z:l.z+s.l},{x:l.x+s.w,z:(l.z+3*(l.z+s.l))/4},{x:l.x+s.w,z:(l.z+(l.z+s.l))/2},{x:l.x+s.w,z:(3*l.z+(l.z+s.l))/4}],d=t(l),g=d[0],y=d[1],p=0;for(let v=0;v<h.length;v++)for(let z=0;z<g.length;z++){let w=g[z],M=h[v],L=y[w.id];if(e(L,M,!1)){p++;break}}return p==16}f.specificOpenPoints=[];let c=[],r=q.dragSurface,n;if(f.openPoints.length==1){let s=f.item.packDetails.rotations;n=[];for(let l=0;l<s.length;l++){let h=s[l];h.w<=r.width&&h.h<=r.height&&h.l<=r.lenght&&!o(f.item.object)&&n.push(Q(B({},h),{type:[h.type[0],h.type[1]*(Math.PI/180)]}))}n.length>0&&c.push({id:"c-0",type:"O",x:0,y:0,z:0,rotations:n})}console.log(f.openPoints);for(let s=0;s<f.openPoints.length;s++){let l=f.openPoints[s],h=f.item.packDetails.rotations;n=[];for(let d=0;d<h.length;d++){let g=h[d],y=i(g,l);o(y)||l.y>0&&!a(g,l)||g.w+l.x<=r.width&&g.h+l.y<=r.height&&g.l+l.z<=r.lenght&&n.push(Q(B({},g),{type:[g.type[0],g.type[1]*(Math.PI/180)]}))}n.length>0&&c.push({id:l.pointOwner,type:l.type,x:l.x,y:l.y,z:l.z,rotations:n})}f.specificOpenPoints=c,console.log(f.specificOpenPoints),he(n);let u=new x.Group;u.name="specificOpenPoints",f.specificOpenPoints.forEach(s=>{const l=new x.SphereGeometry(3,32,16),h=new x.MeshBasicMaterial({color:16777215}),d=new x.Mesh(l,h);d.position.set(s.x,s.y,s.z),u.add(d)}),P.remove(P.getObjectByName("specificOpenPoints")),P.add(u)}};let T=f;O(T,"steps",[{stepNumber:0,loadedPacks:[],openPoint:[{x:0,y:0,z:0}]}]),O(T,"currentStep",0),O(T,"allLoadedPacks",[]),O(T,"loadedPack",[]),O(T,"openPoints",[{x:0,y:0,z:0}]),O(T,"specificOpenPoints",[]),O(T,"currentPos",null),O(T,"currentRotation",{face:"base",yAxis:0}),O(T,"item",{}),O(T,"mouseOnAction",!1);var D=T;const pe=new x.Raycaster,K=new x.Vector2;function ae(m){K.x=(m.clientX-F.offsetLeft)/F.offsetWidth*2-1,K.y=-((m.clientY-F.offsetTop)/F.offsetHeight)*2+1,pe.setFromCamera(K,R);var t;return P.getObjectByName("pack_shower")&&(t=pe.intersectObjects(P.getObjectByName("pack_shower").children),t.length>0&&t[0].object.userData.clickable)?t:!1}function Le(m){q.draggerStat?Be(m):Fe(m)}function Fe(m){console.log("clicked");let t=ae(m);if(t!=!1){let o=t[0].object.userData.id;Ne(o),Re(o)}}function Be(m){console.log("mousePressed");let t=ae(m);if(t!=!1){let e=t[0].object,o=e.userData.id;e.userData.dragDrop&&new D().start(e,o)}}function Te(m){let t=ae(m);t!=!1?t[0].object.userData.hover&&(document.body.style.cursor="pointer"):document.body.style.cursor=""}function Ne(m){var t;console.log("changing"),P.traverse(e=>{(e.userData.name==="Pack"||e.userData.name=="Line")&&e.userData.id==m&&(t=e.userData.actif)}),P.traverse(e=>{(e.userData.name==="Pack"||e.userData.name=="Line")&&(t?(e.material.transparent=!1,e.material.opacity=1,e.userData.actif=!1,e.castShadow=!0):(e.userData.id==m&&(e.userData.actif=!0,e.material.transparent=!1,e.material.opacity=1,e.castShadow=!0),e.userData.id!=m&&(e.userData.actif=!1,e.material.transparent=!0,e.material.opacity=.2,e.castShadow=!1)))})}function Re(m){["base","right-side","front-side"].forEach(e=>{$(`#pack_Detail_${e}`).prop("checked",!1)});var t=C.allInstances.find(e=>e.id==m);$("#pack_Detail_Id").val(t.id),$("#pack_Detail_Label").val(t.label),$("#pack_Detail_Width").val(t.w/b),$("#pack_Detail_Height").val(t.h/b),$("#pack_Detail_Lenght").val(t.l/b),$("#pack_Detail_Quantity").val(t.q),$("#pack_Detail_StackingCapacity").val(t.stackC),$("#pack_Detail_Priority").val(t.priority).change(),t.rotateDirections.forEach(e=>{$(`#pack_Detail_${e}`).prop("checked",!0)}),$("#multiple-prio div").remove();for(let e=0;e<t.subQuantities.length;e++){let o=t.subQuantities[e];$("#multiple-prio").append('<div class="sub-content" id="advOptionsPrio'+e+'"><div class="sub-content-inputs"><div><p class="inputLabel">Quantity</p><input type="number" min="1" value="'+o.n+'"class="sub-q input"></div><div><p class="inputLabel">Priority</p><input type="number" min="1" value="'+o.p+'" class="sub-prio input"></div></div><div><i class="fa-solid fa-trash removePrioInput" data="'+e+'"></i></div></div>')}t.loaded!=null&&t.unloaded!=null&&$("#packStatut").html(" ("+t.loaded+" / "+(t.loaded+t.unloaded)+") ")}var R,A,j,ie,ne;const je=new $e;Ee();me();Ae();function Ee(){const t=F.clientWidth/F.clientHeight,e=1,o=1e4;R=new x.PerspectiveCamera(60,t,e,o),R.position.set(1e3,400,800),P.background=new x.Color(16777215),P.fog=new x.FogExp2(9024235,2e-6),Ge(),We(),Qe();let i=new x.DirectionalLight(16777215,.8);i.position.set(120,1e3,-150),i.castShadow=!0,i.shadow.bias=-.001,i.shadow.mapSize.width=4096,i.shadow.mapSize.height=4096,i.shadow.camera.near=.5,i.shadow.camera.far=3e3,i.shadow.camera.left=3e3,i.shadow.camera.right=-3e3,i.shadow.camera.top=1e3,i.shadow.camera.bottom=-1e3,P.add(i),A=new x.WebGLRenderer({antialias:!0}),A.setPixelRatio(window.devicePixelRatio),A.setSize(F.clientWidth,F.clientHeight),A.shadowMap.enabled=!0,F.appendChild(A.domElement),j=new be(R,A.domElement),j.enableDamping=!0,j.minDistance=100,j.maxDistance=3e3,j.enablePan=!1,j.maxPolarAngle=Math.PI/2,j.minPolarAngle=-Math.PI/2,j.update(),window.addEventListener("resize",fe),F.addEventListener("mousemove",Te),F.addEventListener("pointerdown",Le),de!=null&&de.addEventListener("mouseenter",fe)}function fe(){R.aspect=F.clientWidth/F.clientHeight,R.updateProjectionMatrix(),A.setSize(F.clientWidth,F.clientHeight)}function me(){requestAnimationFrame(me),j.update(),qe()}function qe(){A.render(P,R)}function U(m){return new Promise((t,e)=>{je.load(m,o=>t(o),null,e)})}async function Ae(){const m=new Date().getTime(),t=await U("models/lift_truck/scene.gltf"),e=await U("models/pallet_truck/scene.gltf"),o=await U("models/truck/truck-wheels.gltf"),i=await U("models/truck/truck-support.gltf");J(t.scene,{x:300,y:300,z:300},{x:-250,y:-90,z:450},-Math.PI,!0),J(e.scene,{x:1/2,y:1/2,z:1/2},{x:-450,y:-25,z:700},-Math.PI,!0),J(o.scene,{x:3/2,y:2,z:3/2},{},Math.PI/2,!1),J(i.scene,{x:2,y:2.4,z:2},{},Math.PI/2,!1),ie=o.scene,ne=i.scene;const a=new Date().getTime();new N("Chargement des models, styles, ...",(a-m)*Math.pow(10,-3)).dispatchMessage(),$(".threeD-container-loader").toggleClass("threeD-container-loader--show threeD-container-loader--hide")}function J(m,t,e,o,i){let a=m.getObjectByName("holders");(a!=null||a!=null)&&a.translateZ(10),m.scale.set(t.x,t.y,t.z),m.rotation.y=o,m.traverse(function(c){c.isMesh&&(c.castShadow=!0,c.receiveShadow=!0)}),i&&(m.position.set(e.x,e.y,e.z),P.add(m))}function Ge(){const m=new x.TextureLoader,t=m.load("textures/ground/Concrete_019_BaseColor.jpg"),e=m.load("textures/ground/Concrete_019_Normal.jpg"),o=m.load("textures/ground/Concrete_019_Height.png"),i=m.load("textures/ground/Concrete_019_Roughness.jpg"),a=m.load("textures/ground/Concrete_019_AmbientOcclusion.jpg"),c=1800,r=1800,n=6,u=6,s=new x.PlaneGeometry(c,r,10,10),l=new x.MeshStandardMaterial({map:t,normalMap:e,displacementMap:o,displacementScale:.3,roughnessMap:i,roughness:1,aoMap:a});for(let h=0;h<n;h++)for(let d=0;d<u;d++){const g=new x.Mesh(s,l);g.castShadow=!1,g.receiveShadow=!0,g.rotation.x=-Math.PI/2,g.position.y=-110,g.position.x=h*c-n/2*c,g.position.z=d*r-u/2*r,P.add(g)}}function We(){const m=`
  varying vec3 vWorldPosition;
  void main() {
    vec4 worldPosition = modelMatrix * vec4( position, 1.0 );
    vWorldPosition = worldPosition.xyz;
    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
  }`,t=`
  uniform vec3 topColor;
  uniform vec3 bottomColor;
  uniform float offset;
  uniform float exponent;
  varying vec3 vWorldPosition;
  void main() {
    float h = normalize( vWorldPosition + offset ).y;
    gl_FragColor = vec4( mix( bottomColor, topColor, max( pow( max( h , 0.0), exponent ), 0.0 ) ), 1.0 );
  }`,e=new x.HemisphereLight(16777215,268435455,.6);e.color.setHSL(.6,1,.6),e.groundColor.setHSL(.095,1,.75),P.add(e);const o={topColor:{value:new x.Color(30719)},bottomColor:{value:new x.Color(16777215)},offset:{value:33},exponent:{value:.6}};o.topColor.value.copy(e.color),P.fog.color.copy(o.bottomColor.value);const i=new x.SphereBufferGeometry(4e3,32,15),a=new x.ShaderMaterial({uniforms:o,vertexShader:m,fragmentShader:t,side:x.BackSide}),c=new x.Mesh(i,a);P.add(c)}function Qe(){$(".cube__face").click(function(){let m=$(this).attr("role");m=="front"&&gsap.to(R.position,{duration:1,x:2e3,y:100,z:0,ease:"power3.inOut"}),m=="left"&&gsap.to(R.position,{duration:1,x:0,y:200,z:2e3,ease:"power3.inOut"}),m=="top"&&gsap.to(R.position,{duration:1,x:2e3,y:1e3,z:1200,ease:"power3.inOut"})})}function He(){P.remove(P.getObjectByName("Full_Container")),P.remove(P.getObjectByName("All_Packs")),$("#result").empty()}$(document).ready(function(){$(".menuIcon").click(function(){$(".menu").toggleClass("openMenu closeMenu"),$(".menuIcon").toggleClass("openMenuIcon closeMenu")}),$("#closeMenuIcon").click(function(){$(".menu").toggleClass("openMenu closeMenu"),$(".menuIcon").toggleClass("openMenuIcon closeMenu")}),$("#reset").click(function(){localStorage.removeItem("container"),localStorage.removeItem("packages"),location.reload()});let m=!1;$("#switchManuelleMode").click(function(){m=!m,$("#switchManuelleMode i").toggleClass("fa-hand-back-fist fa-hand"),q.switch(m)}),$("#openCSV").click(function(){$("#openCSV").toggleClass("fa-circle-plus fa-circle-minus"),$("#csv").toggleClass("formContainerContentOpen formContainerContentClose")}),$("#openApi").click(function(){$("#openApi").toggleClass("fa-circle-plus fa-circle-minus"),$("#api").toggleClass("formContainerContentOpen formContainerContentClose")}),$("#openRoutes").click(function(){$("#openRoutes").toggleClass("fa-circle-plus fa-circle-minus"),$("#routes").toggleClass("formContainerContentOpen formContainerContentClose")}),$("#openPackages").click(function(){$("#openPackages").toggleClass("fa-circle-plus fa-circle-minus"),$("#packages").toggleClass("formContainerContentOpen formContainerContentClose")}),$("#openVehicule").click(function(){$("#openVehicule").toggleClass("fa-circle-plus fa-circle-minus"),$("#vehicule").toggleClass("formContainerContentOpen formContainerContentClose")}),$("#openResult").click(function(){$("#openResult").toggleClass("fa-circle-plus fa-circle-minus"),$("#result").toggleClass("formContainerContentOpen formContainerContentClose")}),$("#openPackDetail").click(function(){$("#openPackDetail").toggleClass("fa-circle-plus fa-circle-minus"),$("#packDetail").toggleClass("pack-detail-close pack-detail-open")});var t=JSON.parse(localStorage.getItem("container"));if(t!==null){var e=t.w+" , "+t.h+" , "+t.l;$("#containerDetails").append("<span>"+e+"</span>")}$("#toggleAdvParam").click(function(){$(".sub-container").toggleClass("sub-container--close sub-container--open"),$("#toggleAdvParam").toggleClass("toggleAdvParam--close toggleAdvParam--open")});let o=0;$("#addPrioInputs").click(function(){let c=$("#pack_Detail_Quantity").val();if(c!=""&&c>1){let n=i(".sub-q").reduce((s,l)=>s=s+l,0),u=c-n;u>0?(a(".sub-q"),$("#multiple-prio").append('<div class="sub-content" id="advOptionsPrio'+o+'"><div class="sub-content-inputs"><div><p class="inputLabel">Quantity</p><input type="number" min="1" max="'+u+'" value="'+u+'"class="sub-q input"></div><div><p class="inputLabel">Priority</p><input type="number" min="0" class="sub-prio input"></div></div><div><i class="fa-solid fa-trash removePrioInput" data="'+o+++'"></i></div></div>'),$(".sub-container").animate({scrollTop:$(".sub-container").prop("scrollHeight")},500)):alert("the somme is bigger than initial quantity")}else alert("the initial quantity is empty or less than 1 Or the somme is bigger than initial quantity")}),$(document).on("click",".removePrioInput",function(){$("#advOptionsPrio"+$(this).attr("data")).remove()});function i(c){let r=$(c),n=[];for(let u=0;u<r.length;u++){let s=r[u];n.push(parseInt(s.value))}return n}function a(c){let r=$(c);r.length>=1&&(console.log(r[r.length-1],r[r.length-1].disabled),r[r.length-1].disabled="disabled")}});const re=class{constructor(t,e,o,i){this.w=parseInt(t*b),this.h=parseInt(e*b),this.l=parseInt(o*b),this.capacity=parseInt(i),this.loadContainer(),re.instances=this.getContainer}get getContainer(){return{w:this.w,h:this.h,l:this.l,capacity:this.capacity}}get getContainerLocalStorage(){return{w:this.w/b,h:this.h/b,l:this.l/b,capacity:this.capacity}}loadContainer(){var t=new x.MeshLambertMaterial({color:9737364,side:x.DoubleSide}),e=new x.MeshLambertMaterial({color:9737364,side:x.DoubleSide,transparent:!0,opacity:.5}),o,i=new x.Group;i.name="Full_Container";const a=new x.BoxGeometry(this.w+5,5,this.l+5),c=new x.BoxGeometry(this.w+5,this.h,5),r=new x.BoxGeometry(5,this.h,this.l);a.translate(this.w/2-5/2,-5/2-.1,this.l/2-5/2),c.translate(this.w/2-5/2,this.h/2,-5/2-.1),r.translate(-5/2-.1,this.h/2,this.l/2),o=new x.Mesh(a,t),i.add(o),o.castShadow=!0,o.receiveShadow=!0,o=new x.Mesh(c,e),i.add(o),o=new x.Mesh(r,e),i.add(o),this.loadTruck(this.w,this.l,i);var n=this.w/b+" , "+this.h/b+" , "+this.l/b;$("#containerDetails").html("<span>"+n+"</span>"),$("#containerWidth").val(this.w/b),$("#containerHeight").val(this.h/b),$("#containerLenght").val(this.l/b),$("#containerUnloading").val(this.unloading),localStorage.setItem("container",JSON.stringify(this.getContainerLocalStorage)),new N("Loading container",.01).dispatchMessage()}loadTruck(t,e,o){ie.position.set(t-440,-110,e/2),ne.position.set(400,-110,e/2),o.add(ie),o.add(ne),P.add(o)}};let V=re;O(V,"instances");class Ve{constructor(t){O(this,"isPointContainedInSpace",(t,e,o)=>o?e.x>t[0].x&&e.x<=t[3].x&&e.z>t[0].z&&e.z<=t[3].z:e.x>=t[0].x&&e.x<=t[3].x&&e.z>=t[0].z&&e.z<=t[3].z);this.algorithm=t,this.packagesLoaded=[],this.openPoints=[{x:0,y:0,z:0}],this.boxes=[]}initialisePackagesToLoad(){var t,e=[],o=[];C.allInstances.map(a=>{if(a.multiplePrio){let r=0;for(let n=0;n<a.subQuantities.length;n++){let u=a.subQuantities[n];console.log(u);for(let s=0;s<u.n;s++)t=Q(B({},a),{priority:u.p,w:a.rotations[0].w,h:a.rotations[0].h,l:a.rotations[0].l,id:a.id+"-"+r++,parent_id:a.id}),delete t.q,e.push(t)}}else for(var c=0;c<a.q;c++)t=Q(B({},a),{w:a.rotations[0].w,h:a.rotations[0].h,l:a.rotations[0].l,id:a.id+"-"+c,parent_id:a.id}),delete t.q,e.push(t)}),console.log(e);let i=e.reduce((a,c)=>{const r=c.priority;return a[r]==null&&(a[r]=[]),a[r].push(c),a},{});return Object.entries(i).forEach(([a,c])=>{o.push(parseInt(a)),c.sort((r,n)=>n.v-r.v)}),o.sort((a,c)=>a-c),[i,o]}getDownPack(t,e,o){return t==-1||t.parent_id!=o?e:(t=this.getPackByTopCoords({x:t.x,y:t.y,z:t.z}),e++,this.getDownPack(t,e,o))}getPackByTopCoords(t){return this.packagesLoaded.filter(o=>o.openPoint.T.x==t.x&&o.openPoint.T.y==t.y&&o.openPoint.T.z==t.z)[0]||-1}canBeStacked(t,e){let o=this.getPackByOpenPoint(e);return o.parent_id==t.parent_id?this.getDownPack(o,0,t.parent_id)<=t.stackC:!0}create2dSpace(t){let e=this.packagesLoaded.filter(i=>(t.y>0?i.y+i.h:i.y)==t.y),o=[];return e.forEach(i=>{o[i.id]==null&&(o[i.id]=[]),o[i.id].push({x:i.x,z:i.z},{x:i.x+i.w,z:i.z},{x:i.x,z:i.z+i.l},{x:i.x+i.w,z:i.z+i.l})}),[e,o]}canFitAboveTheBoxNewVersion(t,e){let o=[{x:e.x,z:e.z},{x:(3*e.x+(e.x+t.w))/4,z:e.z},{x:(e.x+(e.x+t.w))/2,z:e.z},{x:(e.x+3*(e.x+t.w))/4,z:e.z},{x:e.x+t.w,z:e.z},{x:e.x,z:(e.z+3*(e.z+t.l))/4},{x:e.x,z:(e.z+(e.z+t.l))/2},{x:e.x,z:(3*e.z+(e.z+t.l))/4},{x:e.x,z:e.z+t.l},{x:(e.x+3*(e.x+t.w))/4,z:e.z+t.l},{x:(e.x+(e.x+t.w))/2,z:e.z+t.l},{x:(3*e.x+(e.x+t.w))/4,z:e.z+t.l},{x:e.x+t.w,z:e.z+t.l},{x:e.x+t.w,z:(e.z+3*(e.z+t.l))/4},{x:e.x+t.w,z:(e.z+(e.z+t.l))/2},{x:e.x+t.w,z:(3*e.z+(e.z+t.l))/4}],i=this.create2dSpace(e),a=i[0],c=i[1],r=0;for(let n=0;n<o.length;n++)for(let u=0;u<a.length;u++){let s=a[u],l=o[n],h=c[s.id];if(this.isPointContainedInSpace(h,l,!1)){r++;break}}return r==16}okRotation(t,e){for(let o=0;o<this.openPoints.length;o++){let i=this.openPoints[o],a=B({},e);if(!(i.y>0&&i.type=="T"&&e.stackC!=-1&&!this.canBeStacked(e,i))){for(let c=0;c<e.rotations.length;c++){let r=e.rotations[c];if(r.l+i.z<=t.l&&r.h+i.y<=t.h&&r.w+i.x<=t.w){let n=this.createTemperoryBox(r,i);if(this.checkCollision(n)||i.y>0&&!this.canFitAboveTheBoxNewVersion(r,i))continue;return a.w=r.w,a.l=r.l,a.h=r.h,a.validRotation=r.type,[i,o,a]}}if(o==this.openPoints.length-1)return!1}}}removeNonWorkingOpenPoints(t){let e=this.packagesLoaded[this.packagesLoaded.length-1];for(let i=this.openPoints.length-1;i>=0;i--){let a=this.openPoints[i];(t.w==a.x||t.h==a.y||t.l==a.z)&&this.openPoints.splice(i,1)}let o=[];this.openPoints.map((i,a)=>{i.x+1>=e.x&&i.x+1<=e.x+e.w&&i.z+1>=e.z&&i.z+1<=e.z+e.l&&i.y==e.y&&i.pointOwner!=e.id&&o.push(a)}),o.sort((i,a)=>a-i);for(let i=0;i<o.length;i++)this.openPoints.splice(o[i],1);for(let i=0;i<this.openPoints.length;i++){let a=this.openPoints[i],c=a.pointOwner.split("-")[0];for(let r=i+1;r<this.openPoints.length;r++){let n=this.openPoints[r],u=n.pointOwner.split("-")[0];if(a.x==n.x&&a.y==n.y&&a.type!="S"&&c==u){let s=this.packagesLoaded.filter(h=>a.y==0?h.y==a.y&&h.x>a.x&&h.z<=a.z&&h.z+h.l>=a.z:h.y+h.h==a.y&&h.x<=a.x+1&&h.x+h.w>=a.x+1&&h.z<=a.z+1&&h.z+h.l>=a.z+1),l=this.packagesLoaded.filter(h=>n.y==0?h.y==n.y&&h.x>n.x&&h.z<=n.z&&h.z+h.l>=n.z:h.y+h.h==n.y&&h.x<=n.x+1&&h.x+h.w>=n.x+1&&h.z<=n.z+1&&h.z+h.l>=n.z+1);s.length!=0&&l.length!=0&&Math.abs(s[0].x-a.x)==Math.abs(l[0].x-n.x)&&this.openPoints.splice(r,1),s.length==0&&l.length==0&&this.openPoints.splice(r,1)}a.x==n.x&&a.z==n.z&&c==u&&this.openPoints.splice(r,1),a.y==n.y&&a.z==n.z&&!a.ignored&&c==u&&n.type!="S"&&this.openPoints.splice(r,1)}}}refreshOpenPoints(t,e){this.openPoints.splice(t,1),this.openPoints=this.removeDuplicatesObjectFromArray(this.openPoints),this.sortOpenPoints(),this.removeNonWorkingOpenPoints(e)}removeDuplicatesObjectFromArray(t){return t.filter((e,o,i)=>i.findIndex(a=>a.x===e.x&&a.y===e.y&&a.z===e.z)===o)}removeOpenPointForNextPriority(){let t=[];if(this.openPoints.map((e,o)=>{e.type=="T"&&t.push({data:e,index:o})}),t.length>0){t.sort((o,i)=>i.data.y-o.data.y);let e=t[0].data.y;t.sort((o,i)=>i.index-o.index);for(let o=t.length-1;o>=0;o--){let i=t[o];console.log(i,e),i.data.y==e&&(console.log(this.openPoints[i.index]),this.openPoints.splice(i.index,1))}}}removePointForNextPriority(t,e){let o=t[e-1]||t[0],i=t[e];console.log(t[e],o);let a=this.openPoints.filter(r=>r.prio>=o&&r.prio<=i&&r.type!="T");console.log(a);let c=[...a];this.openPoints=c}removePointsNextPriority(){this.openPoints=this.openPoints.filter(t=>t.y==0)}getIndexes(t){let e=[];return this.openPoints.map((o,i)=>{parseInt(o.type!=null&&o.type=="T"&&o.pointOwner.split("-")[0])==t.parent_id&&e.push({index:i,data:o})}),e}removeDiagonalPoints(t){let e=this.getIndexes(t),o=[];if(e.length>=2){for(let a=0;a<e.length;a++){let c=e[a];for(let r=a+1;r<e.length;r++){let n=e[r];Math.abs(n.data.z-c.data.z)%t.l==0&&Math.abs(n.data.x-c.data.x)%t.w==0&&c.data.y==n.data.y&&n.data.z>c.data.z&&n.data.x>c.data.x&&o.push(n.index)}}let i=[...new Set(o)];i.sort((a,c)=>c-a),i.map(a=>{this.openPoints.splice(a,1)})}}sortOpenPoints(){this.openPoints.sort((t,e)=>t.x-e.x||t.z-e.z||t.y-e.y)}solve(t,e,o){for(let i=0;i<o.length;i++){let a=e[o[i]];for(let c=0;c<a.length;c++){let r=a[c],n=this.okRotation(t,r);n!==!1&&(this.createPack(n[2],n[0]),this.refreshOpenPoints(n[1],t),this.openPoints.push(...this.createSidePoints()),this.sortOpenPoints(),this.packagesLoaded.length>=2&&this.packagesLoaded[this.packagesLoaded.length-1].parent_id!=this.packagesLoaded[this.packagesLoaded.length-2].parent_id&&this.removeDiagonalPoints(this.packagesLoaded[this.packagesLoaded.length-2]))}this.removePointsNextPriority()}return console.log("packagesLoaded => "),console.log(this.packagesLoaded),console.log("openPoints => "),console.log(this.openPoints),[this.openPoints,this.packagesLoaded]}checkCollision(t){t.geometry.computeBoundingBox(),t.updateMatrixWorld();let e=t.geometry.boundingBox.clone();e.applyMatrix4(t.matrixWorld),e.max.x=e.max.x-1,e.max.y=e.max.y-1,e.max.z=e.max.z-1,e.min.x=e.min.x+1,e.min.y=e.min.y+1,e.min.z=e.min.z+1;for(let o=0;o<this.boxes.length;o++){let i=this.boxes[o];i.geometry.computeBoundingBox(),i.updateMatrixWorld();let a=i.geometry.boundingBox.clone();if(a.applyMatrix4(i.matrixWorld),a.max.x=a.max.x-1,a.max.y=a.max.y-1,a.max.z=a.max.z-1,a.min.x=a.min.x+1,a.min.y=a.min.y+1,a.min.z=a.min.z+1,e.intersectsBox(a))return e.intersectsBox(a)}return!1}createTemperoryBox(t,e){let o=new x.MeshLambertMaterial({color:t.color*16715775,side:x.DoubleSide}),i=new x.BoxGeometry(t.w,t.h,t.l),a=new x.Mesh(i,o),c=new x.Vector3(e.x,e.y,e.z);return a.position.copy(c),i.translate(t.w/2,t.h/2,t.l/2),a}getPackByOpenPoint(t){return this.packagesLoaded.filter(o=>o.id===t.pointOwner)[0]}getPackById(t){return this.packagesLoaded.filter(o=>o.parent_id===t)[0]}createSidePoints(){let t=this.packagesLoaded[this.packagesLoaded.length-1],e=[],o=this.openPoints.filter(a=>a.y==t.y&&a.x<t.x+t.w&&a.pointOwner!=t.id&&a.type!="S"&&!a.ignored);o.sort((a,c)=>a.z-c.z);var i=null;if(o.length>0){if(t.z+t.l-o[0].z>0){let a=t.openPoint.F,c=o[0];if(this.packagesLoaded.filter(n=>n.x>a.x&&n.x<=c.x&&n.z>a.z&&n.z<=c.z&&n.y==a.y).length==0){let n={pointOwner:t.id,x:t.x+t.w,y:t.y,z:o[0].z,type:"S",ignored:!1,prio:t.priority},u=this.packagesLoaded.filter(s=>{if(n.y>0)return s.y+s.h==n.y&&s.x<=n.x+1&&s.x+s.w>=n.x+1&&s.z<=n.z+1&&s.z+s.l>=n.z+1});if(t.y==0){let s=this.packagesLoaded.filter(l=>l.x<=n.x&&l.x+l.w>=n.x&&l.z<=n.z&&l.z+l.l>=n.z);(n.z==0||s.length!=0)&&(e.push(n),i=this.openPoints.findIndex(l=>l.x==o[0].x&&l.y==t.y&&l.z==o[0].z))}else u.length>0&&(e.push(n),i=this.openPoints.findIndex(s=>s.x==o[0].x&&s.y==t.y&&s.z==o[0].z))}}if(t.z+t.l-o[0].z<0){let a=t.openPoint.F,c=o[0];if(this.packagesLoaded.filter(n=>n.x>=c.x&&n.x<=a.x&&n.z+1>a.z&&n.z+1<=c.z&&n.y==a.y).length==0){let n={pointOwner:t.id,x:o[0].x,y:t.y,z:t.z+t.l,type:"S",ignored:!1,prio:t.priority},u=this.packagesLoaded.filter(s=>{if(n.y>0)return s.y+s.h==n.y&&s.x<=n.x+1&&s.x+s.w>=n.x+1&&s.z<=n.z+1&&s.z+s.l>=n.z+1});if(t.y==0){let s=this.packagesLoaded.filter(l=>l.x<=n.x&&l.x+l.w>=n.x&&l.z<=n.z&&l.z+l.l>=n.z);(n.z==0||s.length!=0)&&(e.push(n),i=this.openPoints.findIndex(l=>l.x==t.x&&l.y==t.y&&l.z==t.z+t.l))}else u.length>0&&(e.push(n),i=this.openPoints.findIndex(s=>s.x==t.x&&s.y==t.y&&s.z==t.z+t.l))}}i!=-1&&i!=null&&(this.openPoints[i].ignored=!0)}return e}createOpenPoints(t,e){let o=[{pointOwner:e.id,x:t.x,y:t.y+e.h,z:t.z,type:"T",ignored:!1,prio:e.priority}],i=[{pointOwner:e.id,x:t.x,y:t.y,z:t.z+e.l,type:"R",ignored:!1,prio:e.priority},{pointOwner:e.id,x:t.x+e.w,y:t.y,z:t.z,type:"F",ignored:!1,prio:e.priority}];if(t.x==0&&t.y==0&&t.z==0)return[...o,...i];let a=this.create2dSpace(t),c=a[0],r=a[1];if(c.length!=0&&Object.keys(r).length!=0)for(let n=0;n<i.length;n++){let u=i[n],s=0;for(let l=0;l<c.length;l++){let h=c[l],d=r[h.id],g={x:u.x+1,z:u.z+1};if(u.y==0)this.isPointContainedInSpace(d,g,!1)||s++;else if(this.isPointContainedInSpace(d,g,!1)){let y=this.packagesLoaded.filter(p=>p.x<=u.x+1&&p.x+p.w>u.x+1&&p.z<=u.z+1&&p.z+p.l>u.z+1&&p.y==t.y&&p.id!=u.pointOwner);u.type=="R"&&d[3].z-u.z,u.type=="F"&&d[3].x-u.x,y.length==0&&(u.type=="R"&&o.push(i[0]),u.type=="F"&&o.push(i[1]))}}s==c.length&&(u.type=="R"&&o.push(i[0]),u.type=="F"&&o.push(i[1]))}return o}createPack(t,e){this.packagesLoaded.push(Q(B(B({},t),e),{openPoint:{R:{x:e.x,y:e.y,z:e.z+t.l},T:{x:e.x,y:e.y+t.h,z:e.z},F:{x:e.x+t.w,y:e.y,z:e.z}}})),this.openPoints.push(...this.createOpenPoints(e,t)),this.boxes.push(this.createTemperoryBox(t,e))}}function _e(m,t){let e=new x.Group;e.name="All_Packs",t.forEach(a=>{let c=new x.BoxGeometry(a.w,a.h,a.l),r=new x.MeshLambertMaterial({color:a.color*16715775,side:x.DoubleSide}),n=new x.Vector3(a.x,a.y,a.z),u=new x.Group;u.name="Box_Border_"+a.parent_id;let s=new x.Mesh(c,r);s.castShadow=!0,s.receiveShadow=!0,s.name="Pack",s.userData.id=a.parent_id,s.userData.clickable=!1,s.userData.actif=!1,s.userData.name="Pack";let l=new x.EdgesGeometry(c),h=new x.LineSegments(l,new x.LineBasicMaterial({color:16777215}));h.name="Line_"+a.id,h.position.copy(n),h.userData.id=a.parent_id,h.userData.name="Line",h.translateX(a.w/2),h.translateY(a.h/2),h.translateZ(a.l/2),s.position.copy(n),c.translate(a.w/2,a.h/2,a.l/2),u.add(s),u.add(h),e.add(u)});var o=gsap.timeline();for(let a=0;a<e.children.length;a++)o.from(e.children[a].position,{x:2e3,y:0,z:0,ease:Bounce.easeOut,duration:.02,onUpdate:()=>e.children[0].position.needsUpdate=!0});let i=new x.Group;i.name="sphere",m.forEach(a=>{const c=new x.SphereGeometry(3,32,16),r=new x.MeshBasicMaterial({color:16776960}),n=new x.Mesh(c,r);n.position.set(a.x,a.y,a.z),i.add(n)}),P.add(i),P.add(e)}function Ue(m,t){return m.filter(e=>!t.some(o=>e.id===o.parent_id))}function Je(m,t){$("#result").empty(),Xe(t);let e=t.reduce((c,r)=>{let n=r.parent_id,u=m.filter(s=>s.id==n)[0].q;return c[n]==null&&(c[n]={id:r.parent_id,label:r.label,loaded:0,unloaded:0}),c[n].loaded=c[n].loaded+1,c[n].unloaded=u-c[n].loaded,c},{}),i=Ue(m,t).reduce((c,r)=>(c[r.id]==null&&(c[r.id]={id:r.id,label:r.label,loaded:0,unloaded:r.q}),c),{}),a=B(B({},e),i);for(let c=0;c<C.allInstances.length;c++){let r=C.allInstances[c].id;C.allInstances[c]=Q(B({},C.allInstances[c]),{loaded:a[r].loaded,unloaded:a[r].unloaded})}for(const c in a){let r="<span class='result-text'><b>Id</b><span>"+a[c].id+"</span></span>",n="<span class='result-text'><b>Label</b><span>"+a[c].label+"</span></span>",u="<span class='result-text'><b>Loaded</b><span>"+a[c].loaded+"</span></span>",s="<span class='result-text'><b>Unloaded</b><span>"+a[c].unloaded+"</span></span>";$("#result").append("<div class='result-detail'>"+r+n+u+s+"</div>")}}function Xe(m){const t="data:text/csv;charset=utf-8,"+[["Id","Label","Width","Height","Lenght","X","Y","Z","RotationFace","RotationAngle"],...m.map(i=>[i.id,i.label,i.w,i.h,i.l,i.x,i.y,i.z,i.validRotation])].map(i=>i.join(",")).join(`
`);var e=encodeURI(t);let o="result_"+new Date().getTime()+".csv";$("#result").append("<a class='download-result' href="+e+" download="+o+"> Download <b>"+o+"</b> </div>")}$(document).ready(function(){const m=new Worker("src/worker.js",{type:"module"});var t=!1,e=JSON.parse(localStorage.getItem("container"));e!==null&&($("#containerWidth").val(e.w),$("#containerHeight").val(e.h),$("#containerLenght").val(e.l),$("#containerUnloading").val(e.unloading)),$("#routeIncrement").click(function(){let r=parseInt($("#routesNumber").val());$("#routesNumber").val(r+1),o()}),$("#routeDecrement").click(function(){let r=parseInt($("#routesNumber").val());r>1&&($("#routesNumber").val(r-1),$("#routeInputs .inputs").last().remove())});function o(){$("#routeInputs").append(`
            <div class="inputs">
                <div>
                    <p class="inputLabel">From</p>
                    <input type="text" class="input routeFrom" required>
                </div>
                <div>
                    <p class="inputLabel">To</p>
                    <input type="text" class="input routeTo" required>
                </div>
                <div>
                    <p class="inputLabel">Type</p>
                    <select class="input routeType" required>
                        <option value="dechargement">D</option>
                        <option value="chargement">C</option>
                        <option value="dechargement">D et C</option>
                    </select>
                </div>
            </div>`)}$("#routesForm").submit(function(r){r.preventDefault();var n={},u;n.routesNumber=$("#routesNumber").val(),n.from=$(".routeFrom").map(function(){return $(this).val()}).get(),n.to=$(".routeTo").map(function(){return $(this).val()}).get(),n.type=$(".routeType").map(function(){return $(this).val()}).get(),n.routes=[];for(let s=0;s<n.routesNumber;s++){let l={id:s+1,from:n.from[s],to:n.to[s],type:n.type[s]};n.routes.push(l)}u=new ee(n.routesNumber,n.routes),u.add()}),$("#containerForm").submit(function(r){r.preventDefault();var n={};n.w=$("#containerWidth").val(),n.h=$("#containerHeight").val(),n.l=$("#containerLenght").val(),n.capacity=0,He(),new V(n.w,n.h,n.l,n.capacity),new q(n.w,n.h,n.l),t=!0}),$("#packForm").submit(function(r){if(r.preventDefault(),!t){alert("create the container");return}var n={},u;n.label=$("#packLabel").val(),n.w=$("#packWidth").val(),n.h=$("#packHeight").val(),n.l=$("#packLenght").val(),n.q=$("#packQuantity").val(),n.stack=$("#packStackingCapacity").val(),n.priority=$("#packPriority").val(),n.r=["base"],$("#rightSide").is(":checked")&&n.r.push("right-side"),$("#frontSide").is(":checked")&&n.r.push("front-side"),u=new C(n.label,n.w,n.h,n.l,n.q,n.stack,n.r,n.priority,[]),u.add();var s=n.w+" , "+n.h+" , "+n.l+" ( "+n.q+" ) ";$("#packageDetails").append('<div class="packInfo"><div>'+n.label+'</div><div class="packInfo-numbers">'+s+" </div></div>")}),$("#solve").click(function(){if(!t){alert("create the container");return}C.removePacksFromTheScene(),P.remove(P.getObjectByName("sphere"));var r=new Ve("cub"),n=r.initialisePackagesToLoad();new N("Loading",.01).dispatchMessage(),m.postMessage([V.instances,n]),m.onmessage=s=>{_e(s.data.packer[0],s.data.packer[1]),Je(C.allInstances,s.data.packer[1]),$("#numberBox").val(s.data.packer[1].length),new N("Loaded",s.data.executionTime).dispatchMessage()}}),C.loadPacksFromLocalStorage(),$("#updatePack").click(function(r){r.preventDefault();var n={};n.id=$("#pack_Detail_Id").val(),n.label=$("#pack_Detail_Label").val(),n.w=$("#pack_Detail_Width").val()*b,n.h=$("#pack_Detail_Height").val()*b,n.l=$("#pack_Detail_Lenght").val()*b,n.q=$("#pack_Detail_Quantity").val(),n.stack=$("#pack_Detail_StackingCapacity").val(),n.priority=$("#pack_Detail_Priority").val(),n.r=["base"],$("#pack_Detail_right-side").is(":checked")&&n.r.push("right-side"),$("#pack_Detail_front-side").is(":checked")&&n.r.push("front-side");let u=i(".sub-q"),s=i(".sub-prio"),l=[];for(let h=0;h<u.length;h++){let d=u[h],g=s[h];l.push({n:d,p:g})}n.subQuantities=l,C.update(n,n.id),C.removeBoxesFromTheScene(),C.loadPacks()});function i(r){let n=$(r),u=[];for(let s=0;s<n.length;s++){let l=n[s];u.push(parseInt(l.value))}return u}$("#deletePack").click(function(r){r.preventDefault();let n=$("#pack_Detail_Id").val();C.remove(n),C.removeBoxesFromTheScene(),C.loadPacks()}),$("#actual-btn").change(function(r){var n=$("#actual-btn").val().split(".").pop().toLowerCase();if($.inArray(n,["csv"])==-1)return alert("Upload CSV"),!1;if(r.target.files!=null){$("#file-chosen").html(r.target.files[0].name);var u=new FileReader;u.onload=function(s){var l=s.target.result.split(`\r
`);a(l)},u.readAsText(r.target.files.item(0))}return!1});function a(r){for(let s=1;s<r.length;s++)if(r[s].length>0){let l=r[s].split(",");if(l[0]=="container")new V(l[1],l[2],l[3],l[4]),t=!0;else{let h=[];for(let d=6;d<=8;d++)l[d]!=null&&h.push(l[d].replace('"',""));var n=new C(l[0],l[1],l[2],l[3],l[4],l[5],[...h]);n.add();var u=l[1]+" , "+l[2]+" , "+l[3]+" ( "+l[4]+" ) ";$("#packageDetails").append('<div class="packInfo"><div>'+l[0]+'</div><div class="packInfo-numbers">'+u+" </div></div>")}}}$("#numberBox").on("input",function(r){if(r.target.value!=null&&P.getObjectByName("All_Packs")){let n=P.getObjectByName("All_Packs").children;r.target.max=n.length;for(let u=r.target.value-1;u>=0;u--){let s=n[u].children,l=s[0],h=s[1];l.visible=!0,h.visible=!0}for(let u=n.length-1;u>=r.target.value;u--){let s=n[u].children,l=s[0],h=s[1];l.visible=!1,h.visible=!1}}}),$("#loadApi").click(async function(){let r=$("#apiUrl").val();await fetch(r).then(n=>{if(n.ok)return n.json()}).then(n=>{console.log(n),c(n)}).catch(n=>console.log(n))});function c(r){console.log(r);let n=r.container,u=r.colis;new V(n.w,n.h,n.l,n.capacity,n.unloading),t=!0,u.map(h=>{var h=new C(h.label,h.w,h.h,h.l,h.q,h.stackingCapacity,h.rotations,h.priority);h.add()}),new N("Load Data",.01).dispatchMessage()}$("#random").click(function(){$("#packLabel").val("colis "+Math.floor(Math.random()*100)),$("#packWidth").val(Math.floor((Math.random()*(2-.1+1)+.1)*100)/100),$("#packHeight").val(Math.floor((Math.random()*(2-.1+1)+.1)*100)/100),$("#packLenght").val(Math.floor((Math.random()*(2-.1+1)+.1)*100)/100),$("#packQuantity").val(Math.floor(Math.random()*20+1))})});
