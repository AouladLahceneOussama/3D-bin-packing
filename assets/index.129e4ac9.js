var Pe=Object.defineProperty,ze=Object.defineProperties;var be=Object.getOwnPropertyDescriptors;var ue=Object.getOwnPropertySymbols;var $e=Object.prototype.hasOwnProperty,ke=Object.prototype.propertyIsEnumerable;var ee=(m,t,e)=>t in m?Pe(m,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):m[t]=e,B=(m,t)=>{for(var e in t||(t={}))$e.call(t,e)&&ee(m,e,t[e]);if(ue)for(var e of ue(t))ke.call(t,e)&&ee(m,e,t[e]);return m},Q=(m,t)=>ze(m,be(t));var O=(m,t,e)=>(ee(m,typeof t!="symbol"?t+"":t,e),e);import*as x from"https://threejsfundamentals.org/threejs/resources/threejs/r122/build/three.module.js";import{OrbitControls as Ie}from"https://threejsfundamentals.org/threejs/resources/threejs/r122/examples/jsm/controls/OrbitControls.js";import{GLTFLoader as De}from"https://threejsfundamentals.org/threejs/resources/threejs/r122/examples/jsm/loaders/GLTFLoader.js";import{TransformControls as Se}from"https://threejsfundamentals.org/threejs/resources/threejs/r122/examples/jsm/controls/TransformControls.js";const Ce=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))a(i);new MutationObserver(i=>{for(const n of i)if(n.type==="childList")for(const d of n.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&a(d)}).observe(document,{childList:!0,subtree:!0});function e(i){const n={};return i.integrity&&(n.integrity=i.integrity),i.referrerpolicy&&(n.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?n.credentials="include":i.crossorigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function a(i){if(i.ep)return;i.ep=!0;const n=e(i);fetch(i.href,n)}};Ce();const b=100,z=new x.Scene,F=document.getElementById("3D-container"),he=document.getElementById("exampleModalfat");let Me=0;const oe=class{constructor(t,e){this.id=Me++,this.action=t,this.executionTime=e,oe.allMessages.push(this.getMessageDetail)}get getMessageDetail(){return{id:this.id,action:this.action,executionTime:this.executionTime}}dateTime(){var t=new Date,e=t.getFullYear()+"-"+(t.getMonth()+1)+"-"+t.getDate(),a=t.getHours()+":"+t.getMinutes()+":"+t.getSeconds();return e+" - "+a}dispatchMessage(){let t="<div class='logTime'><p>"+this.dateTime()+"</p><p>Execution Time : "+this.executionTime.toFixed(2)+"s</p></div>",e=" <div class='logDetail'><h3>"+this.action+"</h3>"+t+"</div>";$(".logMsg").append(e),$(".logMsg").animate({scrollTop:$(".logMsg").prop("scrollHeight")},250)}};let T=oe;O(T,"allMessages",[]);let Oe=0;const q=class{constructor(t=0,e=[]){this.id=Oe++,this.routeNumber=parseInt(t),console.log(e),this.routes=e,q.allRoutes=this.getRoute}get getRoute(){return{routeNumber:this.routeNumber,routes:this.routes}}get getRouteToLocalStorage(){return{routeNumber:this.routeNumber,routes:this.routes}}static getRouteNumber(t){return q.allRoutes.routes.filter(a=>(console.log(a.type,t),a.type==t)).length}static initialisePriorityFields(){$(".pack_priorities option").remove();for(let t=1;t<=q.getRouteNumber("dechargement");t++)$(".pack_priorities").append('<option value="'+t+'">'+t+"</option>")}static init(){localStorage.getItem("routes")!==null&&(JSON.parse(localStorage.getItem("routes")).forEach(e=>{new q(e.routeNumber,e.from,e.to,e.type)}),q.allRoutes.routes.forEach(e=>{var a=e.from+" - "+e.to+"("+e.type+")",i="p : "+e.id;$("#routesDetails").append('<div class="packInfo"><div>'+a+'</div><div class="packInfo-numbers">'+i+" </div></div>")}),q.initialisePriorityFields())}add(){var t=[];localStorage.getItem("routes")!==null&&(t=JSON.parse(localStorage.getItem("routes"))),t.push(this.getRouteToLocalStorage),localStorage.setItem("routes",JSON.stringify(t)),q.allRoutes.routes.forEach(a=>{var i=a.from+" - "+a.to+"("+a.type+")",n="p : "+a.id;$("#routesDetails").append('<div class="packInfo"><div>'+i+'</div><div class="packInfo-numbers">'+n+" </div></div>")}),q.initialisePriorityFields(),new T("Adding route",.01).dispatchMessage()}};let Y=q;O(Y,"allRoutes");let Le=0;const S=class{constructor(t,e,a,i,n,d,g,l,o=[]){this.id=Le++,this.label=t,this.w=parseInt(e*b),this.h=parseInt(a*b),this.l=parseInt(i*b),this.q=parseInt(n),this.v=this.w*this.h*this.l,this.stackingCapacity=parseInt(d),this.rotations=g,this.dimensions=this.setDimensions(g),this.priority=parseInt(l),this.color=Math.random(),this.multiplePrio=o.length>0,this.subQuantities=o,S.allInstances.push(this.getPack)}get getPack(){return{id:this.id,label:this.label,w:this.w,h:this.h,l:this.l,q:this.q,v:this.v,priority:this.priority,stackC:this.stackingCapacity,rotations:this.dimensions,rotateDirections:this.rotations,multiplePrio:this.multiplePrio,subQuantities:this.subQuantities,color:this.color}}get getPackToLocalStorage(){return{label:this.label,w:this.w/b,h:this.h/b,l:this.l/b,q:this.q,priority:this.priority,stackC:this.stackingCapacity,rotations:this.rotations,subQuantities:this.subQuantities}}setDimensions(t){let e=[];for(let i=0;i<t.length;i++){let n=t[i];n=="base"&&e.push({w:this.w,h:this.h,l:this.l,type:[n,0],surface:this.w*this.l},{w:this.l,h:this.h,l:this.w,type:[n,90],surface:this.w*this.l}),n=="right-side"&&e.push({w:this.w,h:this.l,l:this.h,type:[n,0],surface:this.w*this.h},{w:this.h,h:this.l,l:this.w,type:[n,90],surface:this.w*this.h}),n=="front-side"&&e.push({w:this.h,h:this.w,l:this.l,type:[n,0],surface:this.h*this.l},{w:this.l,h:this.w,l:this.h,type:[n,90],surface:this.h*this.l})}e.sort((i,n)=>n.surface-i.surface);for(let i=0;i<e.length;i+=2)if(e[i].l>e[i].w){var a=e[i+1];e[i+1]=e[i],e[i]=a}return e}static init(){localStorage.getItem("packages")!==null&&(JSON.parse(localStorage.getItem("packages")).forEach(e=>{new S(e.label,e.w,e.h,e.l,e.q,e.stackC,e.rotations,e.priority,e.subQuantities)}),S.allInstances.forEach(e=>{var a=e.w/b+" , "+e.h/b+" , "+e.l/b+" ( "+e.q+" ) ";$("#packageDetails").append('<div class="packInfo"><div>'+e.label+'</div><div class="packInfo-numbers">'+a+" </div></div>")}))}add(){var t=[];localStorage.getItem("packages")!==null&&(t=JSON.parse(localStorage.getItem("packages"))),t.push(this.getPackToLocalStorage),localStorage.setItem("packages",JSON.stringify(t)),S.loadPacks(),new T("Adding Pack",.01).dispatchMessage()}static updatePackLocalstorage(){localStorage.removeItem("packages");let t=[];S.allInstances.map(e=>{t.push({label:e.label,w:parseFloat(e.w/b),h:parseFloat(e.h/b),l:parseFloat(e.l/b),q:parseInt(e.q),priority:e.priority,stackC:parseInt(e.stackC),rotations:e.rotateDirections,multiplePrio:e.subQuantities.length>0,subQuantities:e.subQuantities})}),localStorage.setItem("packages",JSON.stringify(t))}static update(t,e){function a(o,s,r,u){let c=[];for(let y=0;y<o.length;y++){let h=o[y];h=="base"&&c.push({w:s,h:r,l:u,type:[h,0],surface:s*u},{w:u,h:r,l:s,type:[h,90],surface:s*u}),h=="right-side"&&c.push({w:s,h:u,l:r,type:[h,0],surface:s*r},{w:r,h:u,l:s,type:[h,90],surface:s*r}),h=="front-side"&&c.push({w:r,h:s,l:u,type:[h,0],surface:r*u},{w:u,h:s,l:r,type:[h,90],surface:r*u})}c.sort((y,h)=>h.surface-y.surface);for(let y=0;y<c.length;y+=2)if(c[y].l>c[y].w){var p=c[y+1];c[y+1]=c[y],c[y]=p}return c}let i=S.allInstances.findIndex(o=>o.id==parseInt(e)),n=S.allInstances[i],d={label:t.label,w:parseInt(t.w),h:parseInt(t.h),l:parseInt(t.l),q:parseInt(t.q),priority:parseInt(t.priority),v:t.w*t.h*t.l,stackC:parseInt(t.stack),rotateDirections:t.r,rotations:a(t.r,parseInt(t.w),parseInt(t.h),parseInt(t.l)),multiplePrio:t.subQuantities.length>0,subQuantities:t.subQuantities},g=B(B({},n),d);S.allInstances[i]=g,S.removePacksFromTheScene(),S.updatePackLocalstorage(),$("#packageDetails").empty(),S.allInstances.forEach(o=>{var s=o.w/b+" , "+o.h/b+" , "+o.l/b+" ( "+o.q+" ) ";$("#packageDetails").append('<div class="packInfo"><div>'+o.label+'</div><div class="packInfo-numbers">'+s+" </div></div>")}),new T("Updating Pack",.01).dispatchMessage()}static remove(t){let e=S.allInstances.findIndex(i=>i.id==parseInt(t));S.allInstances.splice(e,1),S.removePacksFromTheScene(),S.updatePackLocalstorage(),$("#packageDetails").empty(),S.allInstances.forEach(i=>{var n=i.w/b+" , "+i.h/b+" , "+i.l/b+" ( "+i.q+" ) ";$("#packageDetails").append('<div class="packInfo"><div>'+i.label+'</div><div class="packInfo-numbers">'+n+" </div></div>")}),new T("Remove Pack",.01).dispatchMessage()}static loadPacks(){function t(o){var s=o.w/b+" , "+o.h/b+" , "+o.l/b+" ( "+o.q+" ) ";$("#packageDetails").append('<div class="packInfo"><div>'+o.label+'</div><div class="packInfo-numbers">'+s+" </div></div>")}S.removeBoxesFromTheScene(),$("#packageDetails div").remove();let e=S.allInstances,a=new x.Group;a.name="pack_shower",e.sort((o,s)=>s.v-o.v);var i,n,d;let g=-300,l=400;for(let o=0;o<e.length;o++){let s=e[o];n=new x.BoxGeometry(s.w,s.h,s.l),d=new x.MeshLambertMaterial({color:s.color*16715775,side:x.DoubleSide}),i=new x.Mesh(n,d),i.castShadow=!0,i.receiveShadow=!0,i.userData.id=s.id,i.userData.hover=!0,i.userData.dragDrop=!0,i.userData.clickable=!0,i.userData.actif=!1,i.userData.name="Pack",o!=0?i.position.set(g,-110-.1,l):i.position.set(g,-65,l),g+=s.w+20,g>800&&(l+=400,g=-300),n.translate(s.w/2,s.h/2,s.l/2),a.add(i),t(s)}z.add(a)}static loadPacksFromLocalStorage(){S.init(),S.loadPacks()}static removePacksFromTheScene(){z.remove(z.getObjectByName("All_Packs"))}static removeBoxesFromTheScene(){z.remove(z.getObjectByName("pack_shower"))}static reloadShowPacker(){S.removeBoxesFromTheScene(),S.loadPacks()}};let C=S;O(C,"allInstances",[]);let Fe=0;const le=class{constructor(t,e,a){this.id=Fe++,this.pack=t,this.loaded=e,this.stat=a,le.allMessages.push(this.getMessageDetail)}get getMessageDetail(){return{id:this.id,pack:this.pack,loaded:this.loaded,stat:this.stat}}dispatchMessage(){$(".logger-content div").remove();let t=`
            <div class="logger-detail">
            <span class="pack-title">Label</span>
            <span>${this.pack.label}</span>
            </div>
            <div class="logger-detail">
            <span class="pack-title">Quantity</span>
            <span>${this.pack.q}</span>
            </div>
            <div class="logger-detail">
            <span class="pack-title">Loaded</span>
            <span>${this.loaded}</span>
            </div>
            <div class="logger-detail">
            <span class="pack-title">Stat</span>
            <span>${this.stat}</span>
            </div>
        `;$(".logger-content").append(t)}};let Z=le;O(Z,"allMessages",[]);const K=class{constructor(t,e,a){this.width=parseInt(t*b),this.height=parseInt(e*b),this.lenght=parseInt(a*b),K.dragSurface=this.getDragSurface}get getDragSurface(){return{width:this.width,height:this.height,lenght:this.lenght}}static switch(t){t?new T("Manual mode is activated (start dragging...)",.01).dispatchMessage():new T("Manual mode is deactivated",.01).dispatchMessage(),K.draggerStat=t}};let A=K;O(A,"draggerStat",!1),O(A,"dragSurface",{});localStorage.setItem("steps",JSON.stringify([{stepNumber:0,loadedPacks:[],openPoint:[{x:0,y:0,z:0}]}]));function _(m,t){[{rotation:"base",angles:[0,Math.PI/2]},{rotation:"right-side",angles:[0,Math.PI/2]},{rotation:"front-side",angles:[0,Math.PI/2]}].forEach(a=>{$(`#d-${a.rotation} .fa-cube`).toggleClass(m,t),$(`#d-${a.rotation} .fa-arrow-rotate-left`).toggleClass(m,t),$(`#d-${a.rotation} .fa-arrow-rotate-right`).toggleClass(m,t)})}function pe(m){_("d-less-opacity",!0);let t=m.reduce((e,a)=>{let i=a.type[0],n=a.type[1]==0?"fa-arrow-rotate-left":"fa-arrow-rotate-right";return e[i]==null?e[i]=[n]:e[i].push(n),e},{});for(const e in t)$(`#d-${e} .fa-cube`).removeClass("d-less-opacity"),t[e].forEach(a=>{$(`#d-${e} .${a}`).removeClass("d-less-opacity")})}function xe(m,t){_("d-current-rotate ",!1);let e=t==0?"fa-arrow-rotate-left":"fa-arrow-rotate-right";$(`#d-${m} .fa-cube`).addClass("d-current-rotate"),$(`#d-${m} .${e}`).addClass("d-current-rotate")}function ye(){let m=[];z.traverse(t=>{t.userData.name==="Box_border"&&m.push(t)}),D.currentStep=0,D.loadedPack=[],D.openPoints=[{x:0,y:0,z:0}],m.forEach(t=>z.remove(t))}$("#delete-all").click(()=>ye());$("#dragDrop-backward").click(function(){let m=JSON.parse(localStorage.getItem("steps"));if(console.log("backward",D.currentStep),m.length>0&&D.currentStep>0){$("#dragDrop-backward").removeClass("disabled");let t=m.find(i=>i.stepNumber==D.currentStep),e=m.find(i=>i.stepNumber==D.currentStep-1);console.log(t,e),D.loadedPack=D.allLoadedPacks.slice(0,e.loadedPacks.length),D.openPoints=e.openPoint,console.log(D.allLoadedPacks,D.loadedPack,e.loadedPacks.length-1);let a=t.loadedPacks[t.loadedPacks.length-1];z.remove(z.getObjectByName("Box_Border_"+a.id)),D.currentStep=D.currentStep-1}if(D.currentStep==0){$("#dragDrop-backward").addClass("disabled");return}});setInterval(()=>{D.currentStep>0&&$("#dragDrop-backward").removeClass("disabled")},100);$("#openDragger").click(function(){$("#openDragger i").toggleClass("fa-circle-plus fa-circle-minus"),$("#dragDrop").toggleClass("dragDrop-container--close dragDrop-container--open")});$(".guidline-dragdrop-container").click(function(){$($(this)).toggleClass("toggleGuidlines")});$("#dragDrop-shortcuts").click(function(){$(".guidline-dragdrop-container").toggleClass("toggleGuidlines")});const re=class{constructor(t,e){this.object=t,this.parent_id=e,this.packDetails=C.allInstances.find(a=>a.id==e),this.q=this.packDetails.q,this.stat={dimensions:{w:this.packDetails.w,h:this.packDetails.h,l:this.packDetails.l},position:this.object.position},console.log(this.object.position),re.allDraggableItems.push(this.getItem)}get getItem(){return{object:this.object,parent_id:this.parent_id,packDetails:this.packDetails,q:this.q,stat:this.stat}}bestPosition(){return D.specificOpenPoints[0]}createDragItem(t){let e=this.checkQuantityItem(this.parent_id,this.q);if(console.log(e),new Z(this.packDetails,e==-1?this.q:e,e==-1?"All loaded":D.specificOpenPoints.length>0?"On loading":"No left space in the container").dispatchMessage(),e!=-1&&D.specificOpenPoints.length>0){let a=new x.Group;a.name="Box_Border_"+this.parent_id+"-"+e,a.userData.parent_id=this.parent_id,a.userData.id=this.parent_id+"-"+e,a.userData.name="Box_border",console.log(D.specificOpenPoints);let i=D.specificOpenPoints[0].rotations[0],n=new x.MeshLambertMaterial({color:this.packDetails.color*16715775,side:x.DoubleSide}),d=new x.BoxGeometry(i.w,i.h,i.l),g=new x.Mesh(d,n);g.userData.parent_id=this.parent_id,g.userData.id=this.parent_id+"-"+e;let l=new x.EdgesGeometry(d),o=new x.LineSegments(l,new x.LineBasicMaterial({color:16777215}));o.name="Line_"+this.parent_id,o.userData.id=this.parent_id,o.userData.name="Line";let s=this.bestPosition();return this.stat.position=s,a.position.set(s.x,s.y,s.z),d.translate(i.w/2,i.h/2,i.l/2),l.translate(i.w/2,i.h/2,i.l/2),a.add(g),a.add(o),z.add(a),t.attach(a),xe(i.type[0],i.type[1]),g}return!1}checkQuantityItem(t,e){console.log(D.loadedPack);let a=D.loadedPack.filter(i=>i.box.userData.parent_id==t);return D.loadedPack.length==0?0:e-a.length>0?a.length:-1}};let ie=re;O(ie,"allDraggableItems",[]);const f=class{constructor(){this.transformControl}start(t,e){if(this.transformControl=new Se(R,E.domElement),this.transformControl.setSpace("local"),this.transformControl.setRotationSnap(Math.PI/2),z.add(this.transformControl),this.transformControl.addEventListener("dragging-changed",function(a){j.enabled=!a.value}),console.log(f.item),Object.keys(f.item).length==0){let a=new ie(t,e);f.item=a.getItem,f.filterOpenPointByPackage();let i=a.createDragItem(this.transformControl);i!=!1?(f.currentPos=f.item.stat.position,this.dragging(i)):f.item={}}else console.log("Please confirm the position of the current dragged pack [press enter]")}static getNbLoadedPacksById(t,e){console.log(t,e);let a=f.loadedPack.filter(i=>i.box.userData.parent_id==t);return f.loadedPack.length==0?0:e-a.length>=0?a.length:-1}dragging(t){let e=this.transformControl;function a(){if(e!=null){let c=f.item.stat.dimensions,p=f.item.stat.position,y=new x.BoxGeometry(c.w,c.h,c.l),h=new x.EdgesGeometry(y);y.translate(c.w/2,c.h/2,c.l/2),h.translate(c.w/2,c.h/2,c.l/2),e.object.children[0].geometry=y,e.object.children[1].geometry=h,e.object.position.set(p.x,p.y,p.z)}}function i(c){let p=f.loadedPack.filter(h=>(c.y>0?h.y+h.h:h.y)==c.y),y=[];return p.forEach(h=>{y[h.id]==null&&(y[h.id]=[]),y[h.id].push({x:h.x,z:h.z},{x:h.x+h.w,z:h.z},{x:h.x,z:h.z+h.l},{x:h.x+h.w,z:h.z+h.l})}),[p,y]}function n(c,p,y){return y?p.x>c[0].x&&p.x<=c[3].x&&p.z>c[0].z&&p.z<=c[3].z:p.x>=c[0].x&&p.x<=c[3].x&&p.z>=c[0].z&&p.z<=c[3].z}function d(){let c=JSON.parse(localStorage.getItem("steps"));c!=null&&(c.push({stepNumber:++f.currentStep,loadedPacks:f.loadedPack,openPoint:f.openPoints}),localStorage.setItem("steps",JSON.stringify(c)))}function g(){function c(p,y){let h=[{pointOwner:y.id,x:p.x,y:p.y+y.h,z:p.z,type:"T",ignored:!1}],v=[{pointOwner:y.id,x:p.x,y:p.y,z:p.z+y.l,type:"R",ignored:!1},{pointOwner:y.id,x:p.x+y.w,y:p.y,z:p.z,type:"F",ignored:!1}];if(p.x==0&&p.y==0&&p.z==0)return[...h,...v];let P=i(p),w=P[0],M=P[1];if(w.length!=0&&Object.keys(M).length!=0)for(let L=0;L<v.length;L++){let k=v[L],H=0;for(let W=0;W<w.length;W++){let U=w[W],I=M[U.id],de={x:k.x+1,z:k.z+1};if(k.y==0)n(I,de,!1)||H++;else if(n(I,de,!1)){let ve=f.loadedPack.filter(G=>G.x<=k.x+1&&G.x+G.w>k.x+1&&G.z<=k.z+1&&G.z+G.l>k.z+1&&G.y==p.y&&G.id!=k.pointOwner);k.type=="R"&&I[3].z-k.z,k.type=="F"&&I[3].x-k.x,ve.length==0&&(k.type=="R"&&h.push(v[0]),k.type=="F"&&h.push(v[1]))}}H==w.length&&(k.type=="R"&&h.push(v[0]),k.type=="F"&&h.push(v[1]))}return h}if(e!=null){let y=e.object.children[0].geometry.parameters;console.log(e.object),f.loadedPack.push({id:t.userData.id,parent_id:t.userData.parent_id,w:y.width,h:y.height,l:y.depth,x:f.currentPos.x,y:f.currentPos.y,z:f.currentPos.z,color:f.item.packDetails.color,box:t,fullBox:e.object}),f.allLoadedPacks.push({id:t.userData.id,parent_id:t.userData.parent_id,w:y.width,h:y.height,l:y.depth,x:f.currentPos.x,y:f.currentPos.y,z:f.currentPos.z,color:f.item.packDetails.color,box:t,fullBox:e.object});let h=f.getNbLoadedPacksById(f.item.parent_id,f.item.q);new Z(f.item.packDetails,h,f.item.q-h==0?"All loaded":"On loading").dispatchMessage(),f.openPoints.push(...c(f.currentPos,f.loadedPack[f.loadedPack.length-1]));let v=f.openPoints.findIndex(w=>w.x==f.currentPos.x&&w.y==f.currentPos.y&&w.z==f.currentPos.z);u(v),f.openPoints.sort((w,M)=>w.x-M.x||w.z-M.z||w.y-M.y);let P=new x.Group;P.name="sphere",f.openPoints.forEach(w=>{const M=new x.SphereGeometry(3,32,16),L=new x.MeshBasicMaterial({color:16776960}),k=new x.Mesh(M,L);k.position.set(w.x,w.y,w.z),P.add(k)}),d(),z.remove(z.getObjectByName("sphere")),z.add(P),e.detach(),e=null,l(t.userData.parent_id),_("d-less-opacity",!0),_("d-current-rotate",!1)}}function l(c){let p=f.loadedPack.filter(y=>y.box.userData.parent_id==c);if(f.item.q-p.length==0){console.log(p);let h=z.getObjectByName("pack_shower").children.find(v=>v.userData.id==p[0].box.userData.parent_id);h.material.transparent=!0,h.material.opacity=.6}f.item={}}function o(){let c=f.currentPos,p=f.specificOpenPoints.find(h=>h.x==c.x&&h.y==c.y&&h.z==c.z);console.log(p);let y=p.rotations.findIndex(h=>h.type[0]==f.currentRotation.face&&h.type[1]==f.currentRotation.yAxis);if(y!=-1){let h=p.rotations[++y%p.rotations.length],v=new x.BoxGeometry(h.w,h.h,h.l),P=new x.EdgesGeometry(v);v.translate(h.w/2,h.h/2,h.l/2),P.translate(h.w/2,h.h/2,h.l/2),e!=null&&(e.object.children[0].geometry=v,e.object.children[1].geometry=P,f.currentRotation={face:p.rotations[y%p.rotations.length].type[0],yAxis:p.rotations[y%p.rotations.length].type[1]},xe(f.currentRotation.face,f.currentRotation.yAxis))}}function s(c){let p=f.specificOpenPoints.find(P=>P.x==c.x&&P.y==c.y&&P.z==c.z),y=p.rotations[0],h=new x.BoxGeometry(y.w,y.h,y.l),v=new x.EdgesGeometry(h);return h.translate(y.w/2,y.h/2,y.l/2),v.translate(y.w/2,y.h/2,y.l/2),e!=null&&(e.object.children[0].geometry=h,e.object.children[1].geometry=v,f.currentRotation={face:p.rotations[0].type[0],yAxis:p.rotations[0].type[1]}),p.rotations}function r(c){const p=(h,v)=>Math.sqrt((v.x-h.x)**2+(v.y-h.y)**2+(v.z-h.z)**2),y=(h,v,P=1e-5)=>{const w=v.map(L=>p(h,L)),M=Math.min(...w);return v.find((L,k)=>w[k]-M<P)};return f.openPoints.length==1?y(c,f.openPoints):y(c,f.specificOpenPoints)}function u(c){function p(h){return h.filter((v,P,w)=>w.findIndex(M=>M.x===v.x&&M.y===v.y&&M.z===v.z)===P)}function y(){let h=f.loadedPack[f.loadedPack.length-1];for(let P=f.openPoints.length-1;P>=0;P--){let w=f.openPoints[P];(A.width==w.x||A.height==w.y||A.lenght==w.z)&&f.openPoints.splice(P,1)}let v=[];f.openPoints.map((P,w)=>{P.x+1>=h.x&&P.x+1<=h.x+h.w&&P.z+1>=h.z&&P.z+1<=h.z+h.l&&P.y==h.y&&P.pointOwner!=h.id&&v.push(w)}),v.sort((P,w)=>w-P);for(let P=0;P<v.length;P++)console.log(f.openPoints[v[P]]),f.openPoints.splice(v[P],1);for(let P=0;P<f.openPoints.length;P++){let w=f.openPoints[P],M=w.pointOwner.split("-")[0];for(let L=P+1;L<f.openPoints.length;L++){let k=f.openPoints[L],H=k.pointOwner.split("-")[0];if(w.x==k.x&&w.y==k.y&&w.type!="S"&&M==H){let W=f.loadedPack.filter(I=>w.y==0?I.y==w.y&&I.x>w.x&&I.z<=w.z&&I.z+I.l>=w.z:I.y+I.h==w.y&&I.x<=w.x+1&&I.x+I.w>=w.x+1&&I.z<=w.z+1&&I.z+I.l>=w.z+1),U=f.loadedPack.filter(I=>k.y==0?I.y==k.y&&I.x>k.x&&I.z<=k.z&&I.z+I.l>=k.z:I.y+I.h==k.y&&I.x<=k.x+1&&I.x+I.w>=k.x+1&&I.z<=k.z+1&&I.z+I.l>=k.z+1);W.length!=0&&U.length!=0&&Math.abs(W[0].x-w.x)==Math.abs(U[0].x-k.x)&&f.openPoints.splice(L,1),W.length==0&&U.length==0&&f.openPoints.splice(L,1)}w.x==k.x&&w.z==k.z&&M==H&&f.openPoints.splice(L,1),w.y==k.y&&w.z==k.z&&!w.ignored&&M==H&&k.type!="S"&&f.openPoints.splice(L,1)}}}c!=-1&&f.openPoints.splice(c,1),f.openPoints=p(f.openPoints),f.openPoints.sort((h,v)=>h.x-v.x||h.z-v.z||h.y-v.y),y()}e.addEventListener("mouseUp",function(c){let p=e.object,y=c.target.children[1].position,h=r(y);console.log(h),p.position.set(h.x,h.y,h.z);let v=s(h);f.currentPos=h,f.mouseOnAction=!1,pe(v)}),e.addEventListener("mouseDown",function(c){f.mouseOnAction=!0}),document.addEventListener("keydown",function(c){switch(c.key.toUpperCase()){case"DELETE":!f.mouseOnAction&&e!=null&&(f.item={},z.remove(e.object),e.detach(),e=null,_("d-less-opacity",!0),_("d-current-rotate",!1));break;case"SHIFT":e.setTranslationSnap(100),e.setRotationSnap(Math.PI/2),e.setScaleSnap(.25);break;case"W":e.setMode("translate");break;case"+":case"=":e.setSize(e.size+.1);break;case"-":case"_":e.setSize(Math.max(e.size-.1,.1));break;case"X":e.showX=!e.showX;break;case"Y":e.showY=!e.showY;break;case"Z":e.showZ=!e.showZ;break;case" ":e.enabled=!e.enabled;break;case"ESCAPE":f.mouseOnAction||a();break;case"ENTER":f.mouseOnAction||g();break;case"R":f.mouseOnAction||o();break;default:console.log("this key don't support any action")}})}static confirmDragDropSolution(){}static filterOpenPointByPackage(){function t(s){let r=f.loadedPack.filter(c=>(s.y>0?c.y+c.h:c.y)==s.y),u=[];return r.forEach(c=>{u[c.id]==null&&(u[c.id]=[]),u[c.id].push({x:c.x,z:c.z},{x:c.x+c.w,z:c.z},{x:c.x,z:c.z+c.l},{x:c.x+c.w,z:c.z+c.l})}),[r,u]}function e(s,r,u){return u?r.x>s[0].x&&r.x<=s[3].x&&r.z>s[0].z&&r.z<=s[3].z:r.x>=s[0].x&&r.x<=s[3].x&&r.z>=s[0].z&&r.z<=s[3].z}function a(s){s.geometry.computeBoundingBox(),s.updateMatrixWorld();let r=s.geometry.boundingBox.clone();r.applyMatrix4(s.matrixWorld),r.max.x=r.max.x-1,r.max.y=r.max.y-1,r.max.z=r.max.z-1,r.min.x=r.min.x+1,r.min.y=r.min.y+1,r.min.z=r.min.z+1,console.log(f.loadedPack);for(let u=0;u<f.loadedPack.length;u++){let c=f.loadedPack[u].box;c.geometry.computeBoundingBox(),c.updateMatrixWorld();let p=c.geometry.boundingBox.clone();if(p.applyMatrix4(c.matrixWorld),p.max.x=p.max.x-1,p.max.y=p.max.y-1,p.max.z=p.max.z-1,p.min.x=p.min.x+1,p.min.y=p.min.y+1,p.min.z=p.min.z+1,r.intersectsBox(p))return r.intersectsBox(p)}return!1}function i(s,r){let u=new x.MeshLambertMaterial({color:16715775,side:x.DoubleSide}),c=new x.BoxGeometry(s.w,s.h,s.l),p=new x.Mesh(c,u),y=new x.Vector3(r.x,r.y,r.z);return p.position.copy(y),c.translate(s.w/2,s.h/2,s.l/2),p}function n(s,r){let u=[{x:r.x,z:r.z},{x:(3*r.x+(r.x+s.w))/4,z:r.z},{x:(r.x+(r.x+s.w))/2,z:r.z},{x:(r.x+3*(r.x+s.w))/4,z:r.z},{x:r.x+s.w,z:r.z},{x:r.x,z:(r.z+3*(r.z+s.l))/4},{x:r.x,z:(r.z+(r.z+s.l))/2},{x:r.x,z:(3*r.z+(r.z+s.l))/4},{x:r.x,z:r.z+s.l},{x:(r.x+3*(r.x+s.w))/4,z:r.z+s.l},{x:(r.x+(r.x+s.w))/2,z:r.z+s.l},{x:(3*r.x+(r.x+s.w))/4,z:r.z+s.l},{x:r.x+s.w,z:r.z+s.l},{x:r.x+s.w,z:(r.z+3*(r.z+s.l))/4},{x:r.x+s.w,z:(r.z+(r.z+s.l))/2},{x:r.x+s.w,z:(3*r.z+(r.z+s.l))/4}],c=t(r),p=c[0],y=c[1],h=0;for(let v=0;v<u.length;v++)for(let P=0;P<p.length;P++){let w=p[P],M=u[v],L=y[w.id];if(e(L,M,!1)){h++;break}}return h==16}f.specificOpenPoints=[];let d=[],g=A.dragSurface,l;if(f.openPoints.length==1){let s=f.item.packDetails.rotations;l=[];for(let r=0;r<s.length;r++){let u=s[r];u.w<=g.width&&u.h<=g.height&&u.l<=g.lenght&&!a(f.item.object)&&l.push(Q(B({},u),{type:[u.type[0],u.type[1]*(Math.PI/180)]}))}l.length>0&&d.push({id:"c-0",type:"O",x:0,y:0,z:0,rotations:l})}console.log(f.openPoints);for(let s=0;s<f.openPoints.length;s++){let r=f.openPoints[s],u=f.item.packDetails.rotations;l=[];for(let c=0;c<u.length;c++){let p=u[c],y=i(p,r);a(y)||r.y>0&&!n(p,r)||p.w+r.x<=g.width&&p.h+r.y<=g.height&&p.l+r.z<=g.lenght&&l.push(Q(B({},p),{type:[p.type[0],p.type[1]*(Math.PI/180)]}))}l.length>0&&d.push({id:r.pointOwner,type:r.type,x:r.x,y:r.y,z:r.z,rotations:l})}f.specificOpenPoints=d,console.log(f.specificOpenPoints),pe(l);let o=new x.Group;o.name="specificOpenPoints",f.specificOpenPoints.forEach(s=>{const r=new x.SphereGeometry(3,32,16),u=new x.MeshBasicMaterial({color:16777215}),c=new x.Mesh(r,u);c.position.set(s.x,s.y,s.z),o.add(c)}),z.remove(z.getObjectByName("specificOpenPoints")),z.add(o)}};let N=f;O(N,"steps",[{stepNumber:0,loadedPacks:[],openPoint:[{x:0,y:0,z:0}]}]),O(N,"currentStep",0),O(N,"allLoadedPacks",[]),O(N,"loadedPack",[]),O(N,"openPoints",[{x:0,y:0,z:0}]),O(N,"specificOpenPoints",[]),O(N,"currentPos",null),O(N,"currentRotation",{face:"base",yAxis:0}),O(N,"item",{}),O(N,"mouseOnAction",!1);var D=N;const fe=new x.Raycaster,te=new x.Vector2;function se(m){te.x=(m.clientX-F.offsetLeft)/F.offsetWidth*2-1,te.y=-((m.clientY-F.offsetTop)/F.offsetHeight)*2+1,fe.setFromCamera(te,R);var t;return z.getObjectByName("pack_shower")&&(t=fe.intersectObjects(z.getObjectByName("pack_shower").children),t.length>0&&t[0].object.userData.clickable)?t:!1}function Be(m){A.draggerStat?Ne(m):Te(m)}function Te(m){console.log("clicked");let t=se(m);if(t!=!1){let a=t[0].object.userData.id;je(a),qe(a)}}function Ne(m){console.log("mousePressed");let t=se(m);if(t!=!1){let e=t[0].object,a=e.userData.id;e.userData.dragDrop&&new D().start(e,a)}}function Re(m){let t=se(m);t!=!1?t[0].object.userData.hover&&(document.body.style.cursor="pointer"):document.body.style.cursor=""}function je(m){var t;console.log("changing"),z.traverse(e=>{(e.userData.name==="Pack"||e.userData.name=="Line")&&e.userData.id==m&&(t=e.userData.actif)}),z.traverse(e=>{(e.userData.name==="Pack"||e.userData.name=="Line")&&(t?(e.material.transparent=!1,e.material.opacity=1,e.userData.actif=!1,e.castShadow=!0):(e.userData.id==m&&(e.userData.actif=!0,e.material.transparent=!1,e.material.opacity=1,e.castShadow=!0),e.userData.id!=m&&(e.userData.actif=!1,e.material.transparent=!0,e.material.opacity=.2,e.castShadow=!1)))})}function qe(m){["base","right-side","front-side"].forEach(e=>{$(`#pack_Detail_${e}`).prop("checked",!1)});var t=C.allInstances.find(e=>e.id==m);$("#pack_Detail_Id").val(t.id),$("#pack_Detail_Label").val(t.label),$("#pack_Detail_Width").val(t.w/b),$("#pack_Detail_Height").val(t.h/b),$("#pack_Detail_Lenght").val(t.l/b),$("#pack_Detail_Quantity").val(t.q),$("#pack_Detail_StackingCapacity").val(t.stackC),$("#pack_Detail_Priority").val(t.priority).change(),t.rotateDirections.forEach(e=>{$(`#pack_Detail_${e}`).prop("checked",!0)}),$("#multiple-prio div").remove();for(let e=0;e<t.subQuantities.length;e++){let a=t.subQuantities[e];$("#multiple-prio").append('<div class="sub-content" id="advOptionsPrio'+e+'"><div class="sub-content-inputs"><div><p class="inputLabel">Quantity</p><input type="number" min="1" value="'+a.n+'"class="sub-q input"></div><div><p class="inputLabel">Priority</p><input type="number" min="1" value="'+a.p+'" class="sub-prio input"></div></div><div><i class="fa-solid fa-trash removePrioInput" data="'+e+'"></i></div></div>')}t.loaded!=null&&t.unloaded!=null&&$("#packStatut").html(" ("+t.loaded+" / "+(t.loaded+t.unloaded)+") ")}var R,E,j,ne,ae;const Ae=new De;Ee();we();We();function Ee(){const t=F.clientWidth/F.clientHeight,e=1,a=1e4;R=new x.PerspectiveCamera(60,t,e,a),R.position.set(1e3,400,800),z.background=new x.Color(16777215),z.fog=new x.FogExp2(9024235,2e-6),Qe(),He(),_e();let i=new x.DirectionalLight(16777215,.8);i.position.set(120,1e3,-150),i.castShadow=!0,i.shadow.bias=-.001,i.shadow.mapSize.width=4096,i.shadow.mapSize.height=4096,i.shadow.camera.near=.5,i.shadow.camera.far=3e3,i.shadow.camera.left=3e3,i.shadow.camera.right=-3e3,i.shadow.camera.top=1e3,i.shadow.camera.bottom=-1e3,z.add(i),E=new x.WebGLRenderer({antialias:!0}),E.setPixelRatio(window.devicePixelRatio),E.setSize(F.clientWidth,F.clientHeight),E.shadowMap.enabled=!0,F.appendChild(E.domElement),j=new Ie(R,E.domElement),j.enableDamping=!0,j.minDistance=100,j.maxDistance=3e3,j.enablePan=!1,j.maxPolarAngle=Math.PI/2,j.minPolarAngle=-Math.PI/2,j.update(),window.addEventListener("resize",ge),F.addEventListener("mousemove",Re),F.addEventListener("pointerdown",Be),he!=null&&he.addEventListener("mouseenter",ge)}function ge(){R.aspect=F.clientWidth/F.clientHeight,R.updateProjectionMatrix(),E.setSize(F.clientWidth,F.clientHeight)}function we(){requestAnimationFrame(we),j.update(),Ge()}function Ge(){E.render(z,R)}function J(m){return new Promise((t,e)=>{Ae.load(m,a=>t(a),null,e)})}async function We(){const m=new Date().getTime(),t=await J("models/lift_truck/scene.gltf"),e=await J("models/pallet_truck/scene.gltf"),a=await J("models/truck/truck-wheels.gltf"),i=await J("models/truck/truck-support.gltf");X(t.scene,{x:300,y:300,z:300},{x:-250,y:-90,z:450},-Math.PI,!0),X(e.scene,{x:1/2,y:1/2,z:1/2},{x:-450,y:-25,z:700},-Math.PI,!0),X(a.scene,{x:3/2,y:2,z:3/2},{},Math.PI/2,!1),X(i.scene,{x:2,y:2.4,z:2},{},Math.PI/2,!1),ne=a.scene,ae=i.scene;const n=new Date().getTime();new T("Chargement des models, styles, ...",(n-m)*Math.pow(10,-3)).dispatchMessage(),$(".threeD-container-loader").toggleClass("threeD-container-loader--show threeD-container-loader--hide")}function X(m,t,e,a,i){let n=m.getObjectByName("holders");(n!=null||n!=null)&&n.translateZ(10),m.scale.set(t.x,t.y,t.z),m.rotation.y=a,m.traverse(function(d){d.isMesh&&(d.castShadow=!0,d.receiveShadow=!0)}),i&&(m.position.set(e.x,e.y,e.z),z.add(m))}function Qe(){const m=new x.TextureLoader,t=m.load("textures/ground/Concrete_019_BaseColor.jpg"),e=m.load("textures/ground/Concrete_019_Normal.jpg"),a=m.load("textures/ground/Concrete_019_Height.png"),i=m.load("textures/ground/Concrete_019_Roughness.jpg"),n=m.load("textures/ground/Concrete_019_AmbientOcclusion.jpg"),d=1800,g=1800,l=6,o=6,s=new x.PlaneGeometry(d,g,10,10),r=new x.MeshStandardMaterial({map:t,normalMap:e,displacementMap:a,displacementScale:.3,roughnessMap:i,roughness:1,aoMap:n});for(let u=0;u<l;u++)for(let c=0;c<o;c++){const p=new x.Mesh(s,r);p.castShadow=!1,p.receiveShadow=!0,p.rotation.x=-Math.PI/2,p.position.y=-110,p.position.x=u*d-l/2*d,p.position.z=c*g-o/2*g,z.add(p)}}function He(){const m=`
  varying vec3 vWorldPosition;
  void main() {
    vec4 worldPosition = modelMatrix * vec4( position, 1.0 );
    vWorldPosition = worldPosition.xyz;
    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
  }`,t=`
  uniform vec3 topColor;
  uniform vec3 bottomColor;
  uniform float offset;
  uniform float exponent;
  varying vec3 vWorldPosition;
  void main() {
    float h = normalize( vWorldPosition + offset ).y;
    gl_FragColor = vec4( mix( bottomColor, topColor, max( pow( max( h , 0.0), exponent ), 0.0 ) ), 1.0 );
  }`,e=new x.HemisphereLight(16777215,268435455,.6);e.color.setHSL(.6,1,.6),e.groundColor.setHSL(.095,1,.75),z.add(e);const a={topColor:{value:new x.Color(30719)},bottomColor:{value:new x.Color(16777215)},offset:{value:33},exponent:{value:.6}};a.topColor.value.copy(e.color),z.fog.color.copy(a.bottomColor.value);const i=new x.SphereBufferGeometry(4e3,32,15),n=new x.ShaderMaterial({uniforms:a,vertexShader:m,fragmentShader:t,side:x.BackSide}),d=new x.Mesh(i,n);z.add(d)}function _e(){$(".cube__face").click(function(){let m=$(this).attr("role");m=="front"&&gsap.to(R.position,{duration:1,x:2e3,y:100,z:0,ease:"power3.inOut"}),m=="left"&&gsap.to(R.position,{duration:1,x:0,y:200,z:2e3,ease:"power3.inOut"}),m=="top"&&gsap.to(R.position,{duration:1,x:2e3,y:1e3,z:1200,ease:"power3.inOut"})})}function me(m){m=="loadedPacks"&&z.remove(z.getObjectByName("All_Packs")),m=="all"&&(z.remove(z.getObjectByName("All_Packs")),z.remove(z.getObjectByName("Full_Container"))),$("#result").empty(),$("#result").append(`
  <div class="empty-result">
    Not solved yet
  </div>`)}$(document).ready(function(){$(".menuIcon").click(function(){$(".menu").toggleClass("openMenu closeMenu"),$(".menuIcon").toggleClass("openMenuIcon closeMenu")}),$("#closeMenuIcon").click(function(){$(".menu").toggleClass("openMenu closeMenu"),$(".menuIcon").toggleClass("openMenuIcon closeMenu")}),$("#reset").click(function(){localStorage.removeItem("container"),localStorage.removeItem("packages"),location.reload()}),$("#openCSV").click(function(){$("#openCSV").toggleClass("fa-circle-plus fa-circle-minus"),$("#csv").toggleClass("formContainerContentOpen formContainerContentClose")}),$("#openApi").click(function(){$("#openApi").toggleClass("fa-circle-plus fa-circle-minus"),$("#api").toggleClass("formContainerContentOpen formContainerContentClose")}),$("#openRoutes").click(function(){$("#openRoutes").toggleClass("fa-circle-plus fa-circle-minus"),$("#routes").toggleClass("formContainerContentOpen formContainerContentClose")}),$("#openPackages").click(function(){$("#openPackages").toggleClass("fa-circle-plus fa-circle-minus"),$("#packages").toggleClass("formContainerContentOpen formContainerContentClose")}),$("#openVehicule").click(function(){$("#openVehicule").toggleClass("fa-circle-plus fa-circle-minus"),$("#vehicule").toggleClass("formContainerContentOpen formContainerContentClose")}),$("#openResult").click(function(){$("#openResult").toggleClass("fa-circle-plus fa-circle-minus"),$("#result").toggleClass("formContainerContentOpen formContainerContentClose")}),$("#openPackDetail").click(function(){$("#openPackDetail").toggleClass("fa-circle-plus fa-circle-minus"),$("#packDetail").toggleClass("pack-detail-close pack-detail-open")});var m=JSON.parse(localStorage.getItem("container"));if(m!==null){var t=m.w+" , "+m.h+" , "+m.l;$("#containerDetails").append("<span>"+t+"</span>")}$("#toggleAdvParam").click(function(){$(".sub-container").toggleClass("sub-container--close sub-container--open"),$("#toggleAdvParam").toggleClass("toggleAdvParam--close toggleAdvParam--open")});let e=0;$("#addPrioInputs").click(function(){let n=$("#pack_Detail_Quantity").val();if(n!=""&&n>1){let g=a(".sub-q").reduce((o,s)=>o=o+s,0),l=n-g;l>0?($("#pack_Detail_Priority").addClass("disabled"),i(".sub-q"),$("#multiple-prio").append(`
                        <div class="sub-content" id="advOptionsPrio${e}">
                            <div class="sub-content-inputs">
                                <div>
                                    <p class="inputLabel">Quantity</p>
                                    <input type="number" min="1" max="${l}" value="${l}" class="sub-q input">
                                </div>
                                <div>
                                    <p class="inputLabel">Priority</p>
                                    <select class="pack_priorities sub-prio input" required></select>
                                </div>
                            </div>
                            <div>
                                <i class="fa-solid fa-trash removePrioInput" data="${e++}"></i>
                            </div>
                        </div>`),$(".sub-container").animate({scrollTop:$(".sub-container").prop("scrollHeight")},500),Y.initialisePriorityFields()):alert("the somme is bigger than initial quantity")}else alert("the initial quantity is empty or less than 1 Or the somme is bigger than initial quantity")}),$(document).on("click",".removePrioInput",function(){$("#advOptionsPrio"+$(this).attr("data")).remove(),$(".sub-content").length==0&&$("#pack_Detail_Priority").removeClass("disabled")});function a(n){let d=$(n),g=[];for(let l=0;l<d.length;l++){let o=d[l];g.push(parseInt(o.value))}return g}function i(n){let d=$(n);d.length>=1&&(console.log(d[d.length-1],d[d.length-1].disabled),d[d.length-1].disabled="disabled")}});const ce=class{constructor(t,e,a,i){this.w=parseInt(t*b),this.h=parseInt(e*b),this.l=parseInt(a*b),this.capacity=parseInt(i),this.loadContainer(),ce.instances=this.getContainer}get getContainer(){return{w:this.w,h:this.h,l:this.l,capacity:this.capacity}}get getContainerLocalStorage(){return{w:this.w/b,h:this.h/b,l:this.l/b,capacity:this.capacity}}loadContainer(){var t=new x.MeshLambertMaterial({color:9737364,side:x.DoubleSide}),e=new x.MeshLambertMaterial({color:9737364,side:x.DoubleSide,transparent:!0,opacity:.5}),a,i=new x.Group;i.name="Full_Container";const n=new x.BoxGeometry(this.w+5,5,this.l+5),d=new x.BoxGeometry(this.w+5,this.h,5),g=new x.BoxGeometry(5,this.h,this.l);n.translate(this.w/2-5/2,-5/2-.1,this.l/2-5/2),d.translate(this.w/2-5/2,this.h/2,-5/2-.1),g.translate(-5/2-.1,this.h/2,this.l/2),a=new x.Mesh(n,t),i.add(a),a.castShadow=!0,a.receiveShadow=!0,a=new x.Mesh(d,e),i.add(a),a=new x.Mesh(g,e),i.add(a),this.loadTruck(this.w,this.l,i);var l=this.w/b+" , "+this.h/b+" , "+this.l/b;$("#containerDetails").html("<span>"+l+"</span>"),$("#containerWidth").val(this.w/b),$("#containerHeight").val(this.h/b),$("#containerLenght").val(this.l/b),$("#containerUnloading").val(this.unloading),localStorage.setItem("container",JSON.stringify(this.getContainerLocalStorage)),new T("Loading container",.01).dispatchMessage()}loadTruck(t,e,a){ne.position.set(t-440,-110,e/2),ae.position.set(400,-110,e/2),a.add(ne),a.add(ae),z.add(a)}};let V=ce;O(V,"instances");class Ve{constructor(t){O(this,"isPointContainedInSpace",(t,e,a)=>a?e.x>t[0].x&&e.x<=t[3].x&&e.z>t[0].z&&e.z<=t[3].z:e.x>=t[0].x&&e.x<=t[3].x&&e.z>=t[0].z&&e.z<=t[3].z);this.algorithm=t,this.packagesLoaded=[],this.openPoints=[{x:0,y:0,z:0}],this.boxes=[]}initialisePackagesToLoad(){var t,e=[],a=[];C.allInstances.map(n=>{if(n.multiplePrio){let g=0;for(let l=0;l<n.subQuantities.length;l++){let o=n.subQuantities[l];console.log(o);for(let s=0;s<o.n;s++)t=Q(B({},n),{priority:o.p,w:n.rotations[0].w,h:n.rotations[0].h,l:n.rotations[0].l,id:n.id+"-"+g++,parent_id:n.id}),delete t.q,e.push(t)}}else for(var d=0;d<n.q;d++)t=Q(B({},n),{w:n.rotations[0].w,h:n.rotations[0].h,l:n.rotations[0].l,id:n.id+"-"+d,parent_id:n.id}),delete t.q,e.push(t)}),console.log(e);let i=e.reduce((n,d)=>{const g=d.priority;return n[g]==null&&(n[g]=[]),n[g].push(d),n},{});return Object.entries(i).forEach(([n,d])=>{a.push(parseInt(n)),d.sort((g,l)=>l.v-g.v)}),a.sort((n,d)=>d-n),[i,a]}getDownPack(t,e,a){return t==-1||t.parent_id!=a?e:(t=this.getPackByTopCoords({x:t.x,y:t.y,z:t.z}),e++,this.getDownPack(t,e,a))}getPackByTopCoords(t){return this.packagesLoaded.filter(a=>a.openPoint.T.x==t.x&&a.openPoint.T.y==t.y&&a.openPoint.T.z==t.z)[0]||-1}canBeStacked(t,e){let a=this.getPackByOpenPoint(e);return a.parent_id==t.parent_id?this.getDownPack(a,0,t.parent_id)<=t.stackC:!0}create2dSpace(t){let e=this.packagesLoaded.filter(i=>(t.y>0?i.y+i.h:i.y)==t.y),a=[];return e.forEach(i=>{a[i.id]==null&&(a[i.id]=[]),a[i.id].push({x:i.x,z:i.z},{x:i.x+i.w,z:i.z},{x:i.x,z:i.z+i.l},{x:i.x+i.w,z:i.z+i.l})}),[e,a]}canFitAboveTheBoxNewVersion(t,e){let a=[{x:e.x,z:e.z},{x:(3*e.x+(e.x+t.w))/4,z:e.z},{x:(e.x+(e.x+t.w))/2,z:e.z},{x:(e.x+3*(e.x+t.w))/4,z:e.z},{x:e.x+t.w,z:e.z},{x:e.x,z:(e.z+3*(e.z+t.l))/4},{x:e.x,z:(e.z+(e.z+t.l))/2},{x:e.x,z:(3*e.z+(e.z+t.l))/4},{x:e.x,z:e.z+t.l},{x:(e.x+3*(e.x+t.w))/4,z:e.z+t.l},{x:(e.x+(e.x+t.w))/2,z:e.z+t.l},{x:(3*e.x+(e.x+t.w))/4,z:e.z+t.l},{x:e.x+t.w,z:e.z+t.l},{x:e.x+t.w,z:(e.z+3*(e.z+t.l))/4},{x:e.x+t.w,z:(e.z+(e.z+t.l))/2},{x:e.x+t.w,z:(3*e.z+(e.z+t.l))/4}],i=this.create2dSpace(e),n=i[0],d=i[1],g=0;for(let l=0;l<a.length;l++)for(let o=0;o<n.length;o++){let s=n[o],r=a[l],u=d[s.id];if(this.isPointContainedInSpace(u,r,!1)){g++;break}}return g==16}okRotation(t,e){for(let a=0;a<this.openPoints.length;a++){let i=this.openPoints[a],n=B({},e);if(!(i.y>0&&i.type=="T"&&e.stackC!=-1&&!this.canBeStacked(e,i))){for(let d=0;d<e.rotations.length;d++){let g=e.rotations[d];if(g.l+i.z<=t.l&&g.h+i.y<=t.h&&g.w+i.x<=t.w){let l=this.createTemperoryBox(g,i);if(this.checkCollision(l)||i.y>0&&!this.canFitAboveTheBoxNewVersion(g,i))continue;return n.w=g.w,n.l=g.l,n.h=g.h,n.validRotation=g.type,[i,a,n]}}if(a==this.openPoints.length-1)return!1}}}removeNonWorkingOpenPoints(t){let e=this.packagesLoaded[this.packagesLoaded.length-1];for(let i=this.openPoints.length-1;i>=0;i--){let n=this.openPoints[i];(t.w==n.x||t.h==n.y||t.l==n.z)&&this.openPoints.splice(i,1)}let a=[];this.openPoints.map((i,n)=>{i.x+1>=e.x&&i.x+1<=e.x+e.w&&i.z+1>=e.z&&i.z+1<=e.z+e.l&&i.y==e.y&&i.pointOwner!=e.id&&a.push(n)}),a.sort((i,n)=>n-i);for(let i=0;i<a.length;i++)this.openPoints.splice(a[i],1);for(let i=0;i<this.openPoints.length;i++){let n=this.openPoints[i],d=n.pointOwner.split("-")[0];for(let g=i+1;g<this.openPoints.length;g++){let l=this.openPoints[g],o=l.pointOwner.split("-")[0];if(n.x==l.x&&n.y==l.y&&n.type!="S"&&d==o){let s=this.packagesLoaded.filter(u=>n.y==0?u.y==n.y&&u.x>n.x&&u.z<=n.z&&u.z+u.l>=n.z:u.y+u.h==n.y&&u.x<=n.x+1&&u.x+u.w>=n.x+1&&u.z<=n.z+1&&u.z+u.l>=n.z+1),r=this.packagesLoaded.filter(u=>l.y==0?u.y==l.y&&u.x>l.x&&u.z<=l.z&&u.z+u.l>=l.z:u.y+u.h==l.y&&u.x<=l.x+1&&u.x+u.w>=l.x+1&&u.z<=l.z+1&&u.z+u.l>=l.z+1);s.length!=0&&r.length!=0&&Math.abs(s[0].x-n.x)==Math.abs(r[0].x-l.x)&&this.openPoints.splice(g,1),s.length==0&&r.length==0&&this.openPoints.splice(g,1)}n.x==l.x&&n.z==l.z&&d==o&&this.openPoints.splice(g,1),n.y==l.y&&n.z==l.z&&!n.ignored&&d==o&&l.type!="S"&&this.openPoints.splice(g,1)}}}refreshOpenPoints(t,e){this.openPoints.splice(t,1),this.openPoints=this.removeDuplicatesObjectFromArray(this.openPoints),this.sortOpenPoints(),this.removeNonWorkingOpenPoints(e)}removeDuplicatesObjectFromArray(t){return t.filter((e,a,i)=>i.findIndex(n=>n.x===e.x&&n.y===e.y&&n.z===e.z)===a)}removeOpenPointForNextPriority(){let t=[];if(this.openPoints.map((e,a)=>{e.type=="T"&&t.push({data:e,index:a})}),t.length>0){t.sort((a,i)=>i.data.y-a.data.y);let e=t[0].data.y;t.sort((a,i)=>i.index-a.index);for(let a=t.length-1;a>=0;a--){let i=t[a];console.log(i,e),i.data.y==e&&(console.log(this.openPoints[i.index]),this.openPoints.splice(i.index,1))}}}removePointForNextPriority(t,e){let a=t[e-1]||t[0],i=t[e];console.log(t[e],a);let n=this.openPoints.filter(g=>g.prio>=a&&g.prio<=i&&g.type!="T");console.log(n);let d=[...n];this.openPoints=d}removePointsNextPriority(){this.openPoints=this.openPoints.filter(t=>t.y==0)}getIndexes(t){let e=[];return this.openPoints.map((a,i)=>{parseInt(a.type!=null&&a.type=="T"&&a.pointOwner.split("-")[0])==t.parent_id&&e.push({index:i,data:a})}),e}removeDiagonalPoints(t){let e=this.getIndexes(t),a=[];if(e.length>=2){for(let n=0;n<e.length;n++){let d=e[n];for(let g=n+1;g<e.length;g++){let l=e[g];Math.abs(l.data.z-d.data.z)%t.l==0&&Math.abs(l.data.x-d.data.x)%t.w==0&&d.data.y==l.data.y&&l.data.z>d.data.z&&l.data.x>d.data.x&&a.push(l.index)}}let i=[...new Set(a)];i.sort((n,d)=>d-n),i.map(n=>{this.openPoints.splice(n,1)})}}sortOpenPoints(){this.openPoints.sort((t,e)=>t.x-e.x||t.z-e.z||t.y-e.y)}solve(t,e,a){for(let i=0;i<a.length;i++){let n=e[a[i]];for(let d=0;d<n.length;d++){let g=n[d],l=this.okRotation(t,g);l!==!1&&(this.createPack(l[2],l[0]),this.refreshOpenPoints(l[1],t),this.openPoints.push(...this.createSidePoints()),this.sortOpenPoints(),this.packagesLoaded.length>=2&&this.packagesLoaded[this.packagesLoaded.length-1].parent_id!=this.packagesLoaded[this.packagesLoaded.length-2].parent_id&&this.removeDiagonalPoints(this.packagesLoaded[this.packagesLoaded.length-2]))}this.removePointsNextPriority()}return console.log("packagesLoaded => "),console.log(this.packagesLoaded),console.log("openPoints => "),console.log(this.openPoints),[this.openPoints,this.packagesLoaded]}checkCollision(t){t.geometry.computeBoundingBox(),t.updateMatrixWorld();let e=t.geometry.boundingBox.clone();e.applyMatrix4(t.matrixWorld),e.max.x=e.max.x-1,e.max.y=e.max.y-1,e.max.z=e.max.z-1,e.min.x=e.min.x+1,e.min.y=e.min.y+1,e.min.z=e.min.z+1;for(let a=0;a<this.boxes.length;a++){let i=this.boxes[a];i.geometry.computeBoundingBox(),i.updateMatrixWorld();let n=i.geometry.boundingBox.clone();if(n.applyMatrix4(i.matrixWorld),n.max.x=n.max.x-1,n.max.y=n.max.y-1,n.max.z=n.max.z-1,n.min.x=n.min.x+1,n.min.y=n.min.y+1,n.min.z=n.min.z+1,e.intersectsBox(n))return e.intersectsBox(n)}return!1}createTemperoryBox(t,e){let a=new x.MeshLambertMaterial({color:t.color*16715775,side:x.DoubleSide}),i=new x.BoxGeometry(t.w,t.h,t.l),n=new x.Mesh(i,a),d=new x.Vector3(e.x,e.y,e.z);return n.position.copy(d),i.translate(t.w/2,t.h/2,t.l/2),n}getPackByOpenPoint(t){return this.packagesLoaded.filter(a=>a.id===t.pointOwner)[0]}getPackById(t){return this.packagesLoaded.filter(a=>a.parent_id===t)[0]}createSidePoints(){let t=this.packagesLoaded[this.packagesLoaded.length-1],e=[],a=this.openPoints.filter(n=>n.y==t.y&&n.x<t.x+t.w&&n.pointOwner!=t.id&&n.type!="S"&&!n.ignored);a.sort((n,d)=>n.z-d.z);var i=null;if(a.length>0){if(t.z+t.l-a[0].z>0){let n=t.openPoint.F,d=a[0];if(this.packagesLoaded.filter(l=>l.x>n.x&&l.x<=d.x&&l.z>n.z&&l.z<=d.z&&l.y==n.y).length==0){let l={pointOwner:t.id,x:t.x+t.w,y:t.y,z:a[0].z,type:"S",ignored:!1,prio:t.priority},o=this.packagesLoaded.filter(s=>{if(l.y>0)return s.y+s.h==l.y&&s.x<=l.x+1&&s.x+s.w>=l.x+1&&s.z<=l.z+1&&s.z+s.l>=l.z+1});if(t.y==0){let s=this.packagesLoaded.filter(r=>r.x<=l.x&&r.x+r.w>=l.x&&r.z<=l.z&&r.z+r.l>=l.z);(l.z==0||s.length!=0)&&(e.push(l),i=this.openPoints.findIndex(r=>r.x==a[0].x&&r.y==t.y&&r.z==a[0].z))}else o.length>0&&(e.push(l),i=this.openPoints.findIndex(s=>s.x==a[0].x&&s.y==t.y&&s.z==a[0].z))}}if(t.z+t.l-a[0].z<0){let n=t.openPoint.F,d=a[0];if(this.packagesLoaded.filter(l=>l.x>=d.x&&l.x<=n.x&&l.z+1>n.z&&l.z+1<=d.z&&l.y==n.y).length==0){let l={pointOwner:t.id,x:a[0].x,y:t.y,z:t.z+t.l,type:"S",ignored:!1,prio:t.priority},o=this.packagesLoaded.filter(s=>{if(l.y>0)return s.y+s.h==l.y&&s.x<=l.x+1&&s.x+s.w>=l.x+1&&s.z<=l.z+1&&s.z+s.l>=l.z+1});if(t.y==0){let s=this.packagesLoaded.filter(r=>r.x<=l.x&&r.x+r.w>=l.x&&r.z<=l.z&&r.z+r.l>=l.z);(l.z==0||s.length!=0)&&(e.push(l),i=this.openPoints.findIndex(r=>r.x==t.x&&r.y==t.y&&r.z==t.z+t.l))}else o.length>0&&(e.push(l),i=this.openPoints.findIndex(s=>s.x==t.x&&s.y==t.y&&s.z==t.z+t.l))}}i!=-1&&i!=null&&(this.openPoints[i].ignored=!0)}return e}createOpenPoints(t,e){let a=[{pointOwner:e.id,x:t.x,y:t.y+e.h,z:t.z,type:"T",ignored:!1,prio:e.priority}],i=[{pointOwner:e.id,x:t.x,y:t.y,z:t.z+e.l,type:"R",ignored:!1,prio:e.priority},{pointOwner:e.id,x:t.x+e.w,y:t.y,z:t.z,type:"F",ignored:!1,prio:e.priority}];if(t.x==0&&t.y==0&&t.z==0)return[...a,...i];let n=this.create2dSpace(t),d=n[0],g=n[1];if(d.length!=0&&Object.keys(g).length!=0)for(let l=0;l<i.length;l++){let o=i[l],s=0;for(let r=0;r<d.length;r++){let u=d[r],c=g[u.id],p={x:o.x+1,z:o.z+1};if(o.y==0)this.isPointContainedInSpace(c,p,!1)||s++;else if(this.isPointContainedInSpace(c,p,!1)){let y=this.packagesLoaded.filter(h=>h.x<=o.x+1&&h.x+h.w>o.x+1&&h.z<=o.z+1&&h.z+h.l>o.z+1&&h.y==t.y&&h.id!=o.pointOwner);o.type=="R"&&c[3].z-o.z,o.type=="F"&&c[3].x-o.x,y.length==0&&(o.type=="R"&&a.push(i[0]),o.type=="F"&&a.push(i[1]))}}s==d.length&&(o.type=="R"&&a.push(i[0]),o.type=="F"&&a.push(i[1]))}return a}createPack(t,e){this.packagesLoaded.push(Q(B(B({},t),e),{openPoint:{R:{x:e.x,y:e.y,z:e.z+t.l},T:{x:e.x,y:e.y+t.h,z:e.z},F:{x:e.x+t.w,y:e.y,z:e.z}}})),this.openPoints.push(...this.createOpenPoints(e,t)),this.boxes.push(this.createTemperoryBox(t,e))}}function Ue(m,t){let e=new x.Group;e.name="All_Packs",t.forEach(n=>{let d=new x.BoxGeometry(n.w,n.h,n.l),g=new x.MeshLambertMaterial({color:n.color*16715775,side:x.DoubleSide}),l=new x.Vector3(n.x,n.y,n.z),o=new x.Group;o.name="Box_Border_"+n.parent_id;let s=new x.Mesh(d,g);s.castShadow=!0,s.receiveShadow=!0,s.name="Pack",s.userData.id=n.parent_id,s.userData.clickable=!1,s.userData.actif=!1,s.userData.name="Pack";let r=new x.EdgesGeometry(d),u=new x.LineSegments(r,new x.LineBasicMaterial({color:16777215}));u.name="Line_"+n.id,u.position.copy(l),u.userData.id=n.parent_id,u.userData.name="Line",u.translateX(n.w/2),u.translateY(n.h/2),u.translateZ(n.l/2),s.position.copy(l),d.translate(n.w/2,n.h/2,n.l/2),o.add(s),o.add(u),e.add(o)});var a=gsap.timeline();for(let n=0;n<e.children.length;n++)a.from(e.children[n].position,{x:2e3,y:0,z:0,ease:Bounce.easeOut,duration:.02,onUpdate:()=>e.children[0].position.needsUpdate=!0});let i=new x.Group;i.name="sphere",m.forEach(n=>{const d=new x.SphereGeometry(3,32,16),g=new x.MeshBasicMaterial({color:16776960}),l=new x.Mesh(d,g);l.position.set(n.x,n.y,n.z),i.add(l)}),z.add(i),z.add(e)}function Je(m,t){return m.filter(e=>!t.some(a=>e.id===a.parent_id))}function Xe(m,t){$("#result").empty(),Ye(t);let e=t.reduce((d,g)=>{let l=g.parent_id,o=m.filter(s=>s.id==l)[0].q;return d[l]==null&&(d[l]={id:g.parent_id,label:g.label,loaded:0,unloaded:0}),d[l].loaded=d[l].loaded+1,d[l].unloaded=o-d[l].loaded,d},{}),i=Je(m,t).reduce((d,g)=>(d[g.id]==null&&(d[g.id]={id:g.id,label:g.label,loaded:0,unloaded:g.q}),d),{}),n=B(B({},e),i);for(let d=0;d<C.allInstances.length;d++){let g=C.allInstances[d].id;C.allInstances[d]=Q(B({},C.allInstances[d]),{loaded:n[g].loaded,unloaded:n[g].unloaded})}for(const d in n){let g="<span class='result-text'><b>Id</b><span>"+n[d].id+"</span></span>",l="<span class='result-text'><b>Label</b><span>"+n[d].label+"</span></span>",o="<span class='result-text'><b>Loaded</b><span>"+n[d].loaded+"</span></span>",s="<span class='result-text'><b>Unloaded</b><span>"+n[d].unloaded+"</span></span>";$("#result").append("<div class='result-detail'>"+g+l+o+s+"</div>")}}function Ye(m){const t="data:text/csv;charset=utf-8,"+[["Id","Label","Width","Height","Lenght","X","Y","Z","RotationFace","RotationAngle"],...m.map(i=>[i.id,i.label,i.w,i.h,i.l,i.x,i.y,i.z,i.validRotation])].map(i=>i.join(",")).join(`
`);var e=encodeURI(t);let a="result_"+new Date().getTime()+".csv";$("#result").append("<a class='download-result' href="+e+" download="+a+"> Download <b>"+a+"</b> </div>")}$(document).ready(function(){const m=new Worker("src/worker.js",{type:"module"});var t=!1,e=JSON.parse(localStorage.getItem("container"));e!==null&&($("#containerWidth").val(e.w),$("#containerHeight").val(e.h),$("#containerLenght").val(e.l),$("#containerUnloading").val(e.unloading)),$("#routeIncrement").click(function(){let l=parseInt($("#routesNumber").val());$("#routesNumber").val(l+1),a()}),$("#routeDecrement").click(function(){let l=parseInt($("#routesNumber").val());l>1&&($("#routesNumber").val(l-1),$("#routeInputs .inputs").last().remove())});function a(){$("#routeInputs").append(`
            <div class="inputs">
                <div>
                    <p class="inputLabel">From</p>
                    <input type="text" class="input routeFrom" required>
                </div>
                <div>
                    <p class="inputLabel">To</p>
                    <input type="text" class="input routeTo" required>
                </div>
                <div>
                    <p class="inputLabel">Type</p>
                    <select class="input routeType" required>
                        <option value="dechargement">D</option>
                        <option value="chargement">C</option>
                        <option value="dechargement">D et C</option>
                    </select>
                </div>
            </div>`)}$("#routesForm").submit(function(l){l.preventDefault();var o={},s;o.routesNumber=$("#routesNumber").val(),o.from=$(".routeFrom").map(function(){return $(this).val()}).get(),o.to=$(".routeTo").map(function(){return $(this).val()}).get(),o.type=$(".routeType").map(function(){return $(this).val()}).get(),o.routes=[];for(let r=0;r<o.routesNumber;r++){let u={id:r+1,from:o.from[r],to:o.to[r],type:o.type[r]};o.routes.push(u)}s=new Y(o.routesNumber,o.routes),s.add()}),$("#containerForm").submit(function(l){l.preventDefault();var o={};o.w=$("#containerWidth").val(),o.h=$("#containerHeight").val(),o.l=$("#containerLenght").val(),o.capacity=0,me("all"),new V(o.w,o.h,o.l,o.capacity),new A(o.w,o.h,o.l),t=!0}),$("#packForm").submit(function(l){if(l.preventDefault(),!t){alert("create the container");return}var o={},s;o.label=$("#packLabel").val(),o.w=$("#packWidth").val(),o.h=$("#packHeight").val(),o.l=$("#packLenght").val(),o.q=$("#packQuantity").val(),o.stack=$("#packStackingCapacity").val(),o.priority=$("#packPriority").val(),o.r=["base"],$("#rightSide").is(":checked")&&o.r.push("right-side"),$("#frontSide").is(":checked")&&o.r.push("front-side"),s=new C(o.label,o.w,o.h,o.l,o.q,o.stack,o.r,o.priority,[]),s.add();var r=o.w+" , "+o.h+" , "+o.l+" ( "+o.q+" ) ";$("#packageDetails").append('<div class="packInfo"><div>'+o.label+'</div><div class="packInfo-numbers">'+r+" </div></div>")}),$("#solve").click(function(){if(!t){alert("create the container");return}$(".menu").toggleClass("openMenu closeMenu"),$(".menuIcon").toggleClass("openMenuIcon closeMenu"),ye(),C.removePacksFromTheScene(),z.remove(z.getObjectByName("sphere"));var l=new Ve("cub"),o=l.initialisePackagesToLoad();new T("Loading",.01).dispatchMessage(),m.postMessage([V.instances,o]),m.onmessage=s=>{Ue(s.data.packer[0],s.data.packer[1]),Xe(C.allInstances,s.data.packer[1]),$("#numberBox").val(s.data.packer[1].length),new T("Loaded",s.data.executionTime).dispatchMessage()}});let i=!1;$("#switchManuelleMode").click(function(){if(!t){alert("create the container");return}me("loadedPacks"),$(".menu").toggleClass("openMenu closeMenu"),$(".menuIcon").toggleClass("openMenuIcon closeMenu"),$(".dragDrop-container").toggleClass("hidden"),C.reloadShowPacker(),i=!i,$("#solve").toggleClass("disabled"),A.switch(i)}),C.loadPacksFromLocalStorage(),$("#updatePack").click(function(l){l.preventDefault();var o={};o.id=$("#pack_Detail_Id").val(),o.label=$("#pack_Detail_Label").val(),o.w=$("#pack_Detail_Width").val()*b,o.h=$("#pack_Detail_Height").val()*b,o.l=$("#pack_Detail_Lenght").val()*b,o.q=$("#pack_Detail_Quantity").val(),o.stack=$("#pack_Detail_StackingCapacity").val(),o.priority=$("#pack_Detail_Priority").val(),o.r=["base"],$("#pack_Detail_right-side").is(":checked")&&o.r.push("right-side"),$("#pack_Detail_front-side").is(":checked")&&o.r.push("front-side");let s=n(".sub-q"),r=n(".sub-prio"),u=[];for(let c=0;c<s.length;c++){let p=s[c],y=r[c];u.push({n:p,p:y})}o.subQuantities=u,C.update(o,o.id),C.removeBoxesFromTheScene(),C.loadPacks()});function n(l){let o=$(l),s=[];for(let r=0;r<o.length;r++){let u=o[r];s.push(parseInt(u.value))}return s}$("#deletePack").click(function(l){l.preventDefault();let o=$("#pack_Detail_Id").val();C.remove(o),C.removeBoxesFromTheScene(),C.loadPacks()}),$("#actual-btn").change(function(l){var o=$("#actual-btn").val().split(".").pop().toLowerCase();if($.inArray(o,["csv"])==-1)return alert("Upload CSV"),!1;if(l.target.files!=null){$("#file-chosen").html(l.target.files[0].name);var s=new FileReader;s.onload=function(r){var u=r.target.result.split(`\r
`);d(u)},s.readAsText(l.target.files.item(0))}return!1});function d(l){for(let r=1;r<l.length;r++)if(l[r].length>0){let u=l[r].split(",");if(u[0]=="container")new V(u[1],u[2],u[3],u[4]),t=!0;else{let c=[];for(let p=6;p<=8;p++)u[p]!=null&&c.push(u[p].replace('"',""));var o=new C(u[0],u[1],u[2],u[3],u[4],u[5],[...c]);o.add();var s=u[1]+" , "+u[2]+" , "+u[3]+" ( "+u[4]+" ) ";$("#packageDetails").append('<div class="packInfo"><div>'+u[0]+'</div><div class="packInfo-numbers">'+s+" </div></div>")}}}$("#numberBox").on("input",function(l){if(l.target.value!=null&&z.getObjectByName("All_Packs")){let o=z.getObjectByName("All_Packs").children;l.target.max=o.length;for(let s=l.target.value-1;s>=0;s--){let r=o[s].children,u=r[0],c=r[1];u.visible=!0,c.visible=!0}for(let s=o.length-1;s>=l.target.value;s--){let r=o[s].children,u=r[0],c=r[1];u.visible=!1,c.visible=!1}}}),$("#loadApi").click(async function(){let l=$("#apiUrl").val();await fetch(l).then(o=>{if(o.ok)return o.json()}).then(o=>{console.log(o),g(o)}).catch(o=>console.log(o))});function g(l){console.log(l);let o=l.container,s=l.colis;new V(o.w,o.h,o.l,o.capacity,o.unloading),t=!0,s.map(c=>{var c=new C(c.label,c.w,c.h,c.l,c.q,c.stackingCapacity,c.rotations,c.priority);c.add()}),new T("Load Data",.01).dispatchMessage()}$("#random").click(function(){$("#packLabel").val("colis "+Math.floor(Math.random()*100)),$("#packWidth").val(Math.floor((Math.random()*(2-.1+1)+.1)*100)/100),$("#packHeight").val(Math.floor((Math.random()*(2-.1+1)+.1)*100)/100),$("#packLenght").val(Math.floor((Math.random()*(2-.1+1)+.1)*100)/100),$("#packQuantity").val(Math.floor(Math.random()*20+1))})});
